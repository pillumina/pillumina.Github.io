<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=63119&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Kubernetes Handbook (Start & Pod) | CctoctoFX</title><meta name=keywords content><meta name=description content="使用minikube构建本地单节点k8s集群

minikube ssh
kubectl cluster-info
kubectl get nodes #查看节点信息
kubectl describe node minikube #详细信息

多节点k8s集群，使用Google K8s Engine
构建方式看GKE官网即可
k8s初步使用
kubectl run kubia &ndash;image=derios/kubia &ndash;port=8080 &ndash;generator=run/v1

--image=derios/kubia代表要运行的容器镜像
这里的--generator会被废弃，其含义指代的是创建一个ReplicationController而不是Deployment。
kubectl apply -f  更常用
kubectl get pods
kubectl get pods -o wide 显示pod ip和pod的节点
如果使用GWE，可以访问集群的dashborad:
kubectl clusert-info获取地址
gcloud container clusters describe kubia | grep -E &ldquo;(username|password):&ldquo;获取用户名和密码
如果仅仅使用minikube，则如下不需要任何凭证即可访问:



1


minikube dashboard


Namespace相关操作


1


kubectl config set-context --current --namespace=my-namespace


创建服务对象，访问Web应用
如果使用minikube或者kubeadm等自定义k8s，loadbalancer是没有集成的，需要AWS或者Google Cloud。最好使用NodePort或者Ingress Controller。如果真要用minikube, 可以使用minikube tunnel解决, 或者minikube service kubia-http"><meta name=author content="Me"><link rel=canonical href=http://localhost:63119/posts/programming/cloud-computing/k8s-basic/><link crossorigin=anonymous href=/assets/css/stylesheet.9d388901283682bb45dd422fcaa0d0a2054a3c8ff47c9cc6b2baab15508b1b90.css integrity="sha256-nTiJASg2grtF3UIvyqDQogVKPI/0fJzGsrqrFVCLG5A=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:63119/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:63119/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:63119/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:63119/apple-touch-icon.png><link rel=mask-icon href=http://localhost:63119/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:63119/posts/programming/cloud-computing/k8s-basic/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=renderMathInElement(document.body)></script>>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script><script>const config={startOnLoad:!0,theme:"neutral",themeVariables:{lineColor:"#0f0f0f"},flowchart:{useMaxWidth:!1,htmlLabels:!0}};mermaid.initialize(config),window.onload=()=>{window.mermaid.init(0[0],document.querySelectorAll(".language-mermaid"))}</script><link rel=stylesheet href=/css/custom.min.0cd022c201cf32c1ca234e0006f6a9496f2ce66a67438333297d130ca223981f.css integrity="sha256-DNAiwgHPMsHKI04ABvapSW8s5mpnQ4MzKX0TDKIjmB8="><script>document.addEventListener("DOMContentLoaded",function(){const t=document.querySelectorAll("h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]"),n=document.querySelectorAll(".toc a");if(t.length===0||n.length===0)return;const s={};t.forEach(e=>{s[e.id]=e.offsetTop});function i(){const t=window.scrollY+100;let e="";for(const[n,o]of Object.entries(s))if(t>=o)e=n;else break;return e}function o(){const e=i();if(n.forEach(e=>{e.classList.remove("active")}),e){const t=document.querySelector(`.toc a[href="#${e}"]`);t&&t.classList.add("active")}}let e=!1;window.addEventListener("scroll",function(){e||(window.requestAnimationFrame(function(){o(),e=!1}),e=!0)}),o()})</script><meta property="og:url" content="http://localhost:63119/posts/programming/cloud-computing/k8s-basic/"><meta property="og:site_name" content="CctoctoFX"><meta property="og:title" content="Kubernetes Handbook (Start & Pod)"><meta property="og:description" content="使用minikube构建本地单节点k8s集群 minikube ssh kubectl cluster-info kubectl get nodes #查看节点信息 kubectl describe node minikube #详细信息 多节点k8s集群，使用Google K8s Engine 构建方式看GKE官网即可
k8s初步使用 kubectl run kubia –image=derios/kubia –port=8080 –generator=run/v1
--image=derios/kubia代表要运行的容器镜像 这里的--generator会被废弃，其含义指代的是创建一个ReplicationController而不是Deployment。 kubectl apply -f 更常用 kubectl get pods kubectl get pods -o wide 显示pod ip和pod的节点 如果使用GWE，可以访问集群的dashborad: kubectl clusert-info获取地址 gcloud container clusters describe kubia | grep -E “(username|password):“获取用户名和密码
如果仅仅使用minikube，则如下不需要任何凭证即可访问: 1 minikube dashboard Namespace相关操作 1 kubectl config set-context --current --namespace=my-namespace 创建服务对象，访问Web应用 如果使用minikube或者kubeadm等自定义k8s，loadbalancer是没有集成的，需要AWS或者Google Cloud。最好使用NodePort或者Ingress Controller。如果真要用minikube, 可以使用minikube tunnel解决, 或者minikube service kubia-http"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-03-31T11:22:18+08:00"><meta property="article:modified_time" content="2021-03-31T11:22:18+08:00"><meta property="og:image" content="http://localhost:63119/imgs/icon_head.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:63119/imgs/icon_head.png"><meta name=twitter:title content="Kubernetes Handbook (Start & Pod)"><meta name=twitter:description content="使用minikube构建本地单节点k8s集群

minikube ssh
kubectl cluster-info
kubectl get nodes #查看节点信息
kubectl describe node minikube #详细信息

多节点k8s集群，使用Google K8s Engine
构建方式看GKE官网即可
k8s初步使用
kubectl run kubia &ndash;image=derios/kubia &ndash;port=8080 &ndash;generator=run/v1

--image=derios/kubia代表要运行的容器镜像
这里的--generator会被废弃，其含义指代的是创建一个ReplicationController而不是Deployment。
kubectl apply -f  更常用
kubectl get pods
kubectl get pods -o wide 显示pod ip和pod的节点
如果使用GWE，可以访问集群的dashborad:
kubectl clusert-info获取地址
gcloud container clusters describe kubia | grep -E &ldquo;(username|password):&ldquo;获取用户名和密码
如果仅仅使用minikube，则如下不需要任何凭证即可访问:



1


minikube dashboard


Namespace相关操作


1


kubectl config set-context --current --namespace=my-namespace


创建服务对象，访问Web应用
如果使用minikube或者kubeadm等自定义k8s，loadbalancer是没有集成的，需要AWS或者Google Cloud。最好使用NodePort或者Ingress Controller。如果真要用minikube, 可以使用minikube tunnel解决, 或者minikube service kubia-http"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:63119/posts/"},{"@type":"ListItem","position":2,"name":"Programming","item":"http://localhost:63119/posts/programming/"},{"@type":"ListItem","position":3,"name":"Kubernetes \u0026 Docker","item":"http://localhost:63119/posts/programming/cloud-computing/"},{"@type":"ListItem","position":4,"name":"Kubernetes Handbook (Start \u0026 Pod)","item":"http://localhost:63119/posts/programming/cloud-computing/k8s-basic/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Kubernetes Handbook (Start \u0026 Pod)","name":"Kubernetes Handbook (Start \u0026 Pod)","description":"使用minikube构建本地单节点k8s集群 minikube ssh kubectl cluster-info kubectl get nodes #查看节点信息 kubectl describe node minikube #详细信息 多节点k8s集群，使用Google K8s Engine 构建方式看GKE官网即可\nk8s初步使用 kubectl run kubia \u0026ndash;image=derios/kubia \u0026ndash;port=8080 \u0026ndash;generator=run/v1\n--image=derios/kubia代表要运行的容器镜像 这里的--generator会被废弃，其含义指代的是创建一个ReplicationController而不是Deployment。 kubectl apply -f 更常用 kubectl get pods kubectl get pods -o wide 显示pod ip和pod的节点 如果使用GWE，可以访问集群的dashborad: kubectl clusert-info获取地址 gcloud container clusters describe kubia | grep -E \u0026ldquo;(username|password):\u0026ldquo;获取用户名和密码\n如果仅仅使用minikube，则如下不需要任何凭证即可访问: 1 minikube dashboard Namespace相关操作 1 kubectl config set-context --current --namespace=my-namespace 创建服务对象，访问Web应用 如果使用minikube或者kubeadm等自定义k8s，loadbalancer是没有集成的，需要AWS或者Google Cloud。最好使用NodePort或者Ingress Controller。如果真要用minikube, 可以使用minikube tunnel解决, 或者minikube service kubia-http\n","keywords":[],"articleBody":"使用minikube构建本地单节点k8s集群 minikube ssh kubectl cluster-info kubectl get nodes #查看节点信息 kubectl describe node minikube #详细信息 多节点k8s集群，使用Google K8s Engine 构建方式看GKE官网即可\nk8s初步使用 kubectl run kubia –image=derios/kubia –port=8080 –generator=run/v1\n--image=derios/kubia代表要运行的容器镜像 这里的--generator会被废弃，其含义指代的是创建一个ReplicationController而不是Deployment。 kubectl apply -f 更常用 kubectl get pods kubectl get pods -o wide 显示pod ip和pod的节点 如果使用GWE，可以访问集群的dashborad: kubectl clusert-info获取地址 gcloud container clusters describe kubia | grep -E “(username|password):“获取用户名和密码\n如果仅仅使用minikube，则如下不需要任何凭证即可访问: 1 minikube dashboard Namespace相关操作 1 kubectl config set-context --current --namespace=my-namespace 创建服务对象，访问Web应用 如果使用minikube或者kubeadm等自定义k8s，loadbalancer是没有集成的，需要AWS或者Google Cloud。最好使用NodePort或者Ingress Controller。如果真要用minikube, 可以使用minikube tunnel解决, 或者minikube service kubia-http\nkubectl expose rc/po/svc kubia –type=LoadBalancer –name kubia-http创建出的service介于pod和node之间, kubectl get services可以查看\n如果没有外部IP地址，因为k8s运行的云基础设施新建lb需要一段时间，lb启动以后应该会显示\nReplicationController的角色 复制pod，replica扩缩 kubectl scale rc kubia --replicas=3 可以将rc下的pods方便进行扩缩容 为何需要service 解决不断变化的pod IP问题，以及在一个固定的IP和端口上对外暴露多个pod。\n当一个service被创建，会得到一个静态IP，在service的生命周期这个IP不会被改变，service会确保其中提个pod接受连接，而非关注这个pod运行在何处.\nk8s的pod pod不一定要包含多个容器，单独容器的pod也是很常见的。如果pod包含多个容器，那么这些容器都工作在同一个工作节点上，pod是不能跨多个工作节点工作的。\npod概念的提出，是因为我们不能把多个进程聚集在一个单独的容器中，我们需要另一种更为高级的结构将容器绑定在一起，并把他们欧威一个单元进行管理。\n一个Pod下的所有容器都在相同的额network和UTS命名空间下运行，所以共享相同的主机名和网络接口，也能够通过IPC进行通信，甚至在最新的k8s和docker版本下，能共享相同的PID命名空间。\n容器如何共享相同IP和端口空间 由于pod中的容器运行于相同Namespace命名空间，所以他们共享相同的IP地址和端口空间。这意味着在同一个pod中的容器运行的多个线程不能绑定到相同的端口号，否则会冲突。此外，他们还有相同的loopback网络几口，所以容器可以通过localhost和同一个pod中的其他容器进行通信。\n平坦网络 k8s集群中所有pod都在同一个共享网络地址空间中，也就是说每个pod都可以通过其他pod的IP地址来实现相互访问，表示他们之间没有NAT(网络地址转换)网管。当两个pod彼此之间发送网络数据包时，都把对方的实际IP地址看作数据包中的源IP。\n因此可以看到，pod就是逻辑主机，行为和非容器世界中的物理主机或者虚拟机相似。运行在同一个pod中的进程和运行在同一物理机或者虚拟机上的进程类似，只是每个进程封装在一个容器里。\n通过pod合理管理容器 一个由前端应用服务器和后端数据库组成的多层应用程序，应该讲其配置为单个pod还是两个pod呢？\n把多层应用分散到多个pod中 一个pod下的所有容器运行在一起，而web服务器和数据库真的要在同一台计算机上运行吗？明显是否定的。而且如何k8s集群节点多了，如果只有一个单独的pod，其资源利用率也很低。\n基于扩缩容考虑而分隔到多个pod中 pod是扩缩容的基本单位，k8s不能横向扩缩单个容器，而只能扩缩整个pod，所以明显web服务器和数据库放在一起是不对的。\n而且数据库这种有状态的服务器，比无状态的web服务器更加难扩展，所以如果要单独扩缩容器，这个容器必须明确地部署在单独的pod当中\n在pod中使用多个容器的时机 一般来说，常见场景是应用由一个主进程和多个辅助进程组成，也就是这个容器组是紧密耦合的。举例就是，pod中的主容器是仅仅服务于每个目录中文件的Web服务器，另一个sidecar容器定期从外部资源下载内容并将其存储在Web服务器目录里。这种情形需要使用k8s的Volume，把其挂在到两个容器里。\nsidecar容器包括：日志轮转器、收集器、数据处理器、通信适配器等等\n因此容器如何分组到pod这个问题，我们需要问以下的问题：\n它们是否需要一起运行还是可以在不同的主机上运行？ 它们代表的是一个整体还是相互独立的组件？ 它们必须一起扩缩容还是可以分别单独进行？ 以YAML或者JSON创建pod 好处：kubectl run局限性很多，比如属性配置很有限，而资源配置的方式除了更方便定义k8s资源对象，还能把它们存储在版本控制系统中。\n注意参考: k8s api reference\n检查现有pod的YAML描述 kubectl get po kubia-zxzij -o yaml\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 apiVersion: v1 kind: Pod metadata: creationTimestamp: \"2021-03-31T03:00:40Z\" generateName: kubia- labels: app: kubia managedFields: - apiVersion: v1 fieldsType: FieldsV1 fieldsV1: f:metadata: f:generateName: {} f:labels: .: {} f:app: {} f:ownerReferences: .: {} k:{\"uid\":\"4b78e019-3753-40a1-998c-0d0ec4af9f29\"}: .: {} f:apiVersion: {} f:blockOwnerDeletion: {} f:controller: {} f:kind: {} f:name: {} f:uid: {} f:spec: f:containers: k:{\"name\":\"kubia\"}: .: {} f:image: {} f:imagePullPolicy: {} f:name: {} f:ports: .: {} k:{\"containerPort\":90,\"protocol\":\"TCP\"}: .: {} f:containerPort: {} f:protocol: {} f:resources: {} f:terminationMessagePath: {} f:terminationMessagePolicy: {} f:dnsPolicy: {} f:enableServiceLinks: {} f:restartPolicy: {} f:schedulerName: {} f:securityContext: {} f:terminationGracePeriodSeconds: {} manager: kube-controller-manager operation: Update time: \"2021-03-31T03:00:40Z\" - apiVersion: v1 fieldsType: FieldsV1 fieldsV1: f:status: f:conditions: k:{\"type\":\"ContainersReady\"}: .: {} f:lastProbeTime: {} f:lastTransitionTime: {} f:status: {} f:type: {} k:{\"type\":\"Initialized\"}: .: {} f:lastProbeTime: {} f:lastTransitionTime: {} f:status: {} f:type: {} k:{\"type\":\"Ready\"}: .: {} f:lastProbeTime: {} f:lastTransitionTime: {} f:status: {} f:type: {} f:containerStatuses: {} f:hostIP: {} f:phase: {} f:podIP: {} f:podIPs: .: {} k:{\"ip\":\"172.17.0.7\"}: .: {} f:ip: {} f:startTime: {} manager: kubelet operation: Update time: \"2021-03-31T03:00:47Z\" name: kubia-2r2pb namespace: default ownerReferences: - apiVersion: v1 blockOwnerDeletion: true controller: true kind: ReplicationController name: kubia uid: 4b78e019-3753-40a1-998c-0d0ec4af9f29 resourceVersion: \"11025\" selfLink: /api/v1/namespaces/default/pods/kubia-2r2pb uid: 342307fe-f6d8-4201-ba02-0210cd75d0a8 spec: containers: - image: derios/kubia imagePullPolicy: Always name: kubia ports: - containerPort: 90 protocol: TCP resources: {} terminationMessagePath: /dev/termination-log terminationMessagePolicy: File volumeMounts: - mountPath: /var/run/secrets/kubernetes.io/serviceaccount name: default-token-whxzx readOnly: true dnsPolicy: ClusterFirst enableServiceLinks: true nodeName: minikube preemptionPolicy: PreemptLowerPriority priority: 0 restartPolicy: Always schedulerName: default-scheduler securityContext: {} serviceAccount: default serviceAccountName: default terminationGracePeriodSeconds: 30 tolerations: - effect: NoExecute key: node.kubernetes.io/not-ready operator: Exists tolerationSeconds: 300 - effect: NoExecute key: node.kubernetes.io/unreachable operator: Exists tolerationSeconds: 300 volumes: - name: default-token-whxzx secret: defaultMode: 420 secretName: default-token-whxzx status: conditions: - lastProbeTime: null lastTransitionTime: \"2021-03-31T03:00:40Z\" status: \"True\" type: Initialized - lastProbeTime: null lastTransitionTime: \"2021-03-31T03:00:47Z\" status: \"True\" type: Ready - lastProbeTime: null lastTransitionTime: \"2021-03-31T03:00:47Z\" status: \"True\" type: ContainersReady - lastProbeTime: null lastTransitionTime: \"2021-03-31T03:00:40Z\" status: \"True\" type: PodScheduled containerStatuses: - containerID: docker://1cce1d07039838f1f4d825d088fca52b54b15808efebf20d1f38cc2952a65ebd image: derios/kubia:latest imageID: docker-pullable://derios/kubia@sha256:7aa603e50514206f8d40126520409a6814001c1bae68b9f286cca9c1ca271f7a lastState: {} name: kubia ready: true restartCount: 0 started: true state: running: startedAt: \"2021-03-31T03:00:46Z\" hostIP: 192.168.49.2 phase: Running podIP: 172.17.0.7 podIPs: - ip: 172.17.0.7 qosClass: BestEffort startTime: \"2021-03-31T03:00:40Z\" 虽然看着比较复杂，主要包含了k8s对象/资源类型、k8s API版本、pod元数据、pod规格和内容、pod和内部容器的详细状态等。\npod定义的主要部分 metadata: 名称、命名空间、标签和关于该容器的其他信息 spec：包含pod内容的实际说明，例如pod的容器、卷和其他数据 status: 包含运行中的pod的当前信息，比如pod所处的条件、每个容器的描述和状态，以及内部IP和其他基本信息 创建新的pod的时候，不需要提供status部分，这只是运行时数据。实际上深究每个属性的意义不是很大，我们需要关注创建pod的最基本信息。\n创建一个简单的YAML描述 1 2 3 4 5 6 7 8 9 10 11 apiVersion: v1 kind: Pod metadata: name: kubia-manual spec: containers: - image: derios/kubia name: kubia ports: - containerPort: 8080 protocol: TCP 可以用kubectl explain pods、kubectl explain pod.spec之类去看资源定义\n用kubectl create来创建pod 1 $ kubectl create -f kubia-manual.yaml 1 $ kubectl get pods 查看应用程序日志 小型node.js应用把日志记录到进程的标准输出，容器化的应用程序通常把日志记录到标准输出和标准错误流，而不是写入文件。所以这就允许user通过标准的方式查看不同应用程序的日志。\nDocker(或者广义的container runtime)把这些流重定向到文件，可以用以下命令获取容器的日志：\n1 $ docker logs 一般可以ssh到pod运行节点然后这样查看，不过k8s提供了更为简单的方式。\n使用kubectl logs命令获取pod日志：\n1 $ kubectl logs kubia-manual 如果一个pod只包含一个容器，那么查看k8s应用程序的日志会变得很简单。\n获取多容器pod的日志时指定容器名称\n1 $ kubectl logs kubia-manual -c kubia 请注意，如果pod被删了，那么pod里的日志也会被删。如果希望在pod删除之后仍然可以获取其日志，需要设置中心化、集群范围的日志系统，把所有日志存储到中心存储中，这个在后续会讨论。\n向pod发送请求 通过端口转发连接到pod以进行测试和调试。\n将本地网络端口转发到pod中的端口 如果不想通过service情形下对某个特定的pod进行通信(debug)，可以通过kubectl port-forward命令完成端口转发:\n1 $kubectl port-forward kubia-munual 8888:8080 这样就能通过本地端口连接到我们的pod。\n通过端口转发连接到pod 另一个终端curl localhost:8888即可调试。实际上述指令起了一个线程进行对调试请求的处理。\n使用Tag组织pod 对于微服务架构，部署数量能很轻松膨胀：多副本、不同版本等等。所以需要进行Pod分组去管理对象。Tag标签不仅仅可以组织pod，还包括了其他k8s资源。\n标签的定义：可以附加到资源的任意键值对。只要标签的key在资源内唯一，那么一个资源便可以拥有多个标签，一般我们在创建资源的时候回把标签附加到资源上，当然后续可以新增、修改标签。举个例子：\napp: 指定pod属于哪个应用、组件或者微服务 rel：显示在pod中运行的应用程序版本是stable、beta还是canary 利用这种组织形式，访问集群的开发或者运维能通过查看pod标签轻松看到系统结构以及每个pod的角色。\n创建pod的时候指定标签 1 2 3 4 5 6 7 8 9 10 11 12 13 14 apiVersion: v1 kind: Pod metadata: name: kubia-manual-v2 labels: creation_method: manual env: prod spec: containers: - image: derios/kubia name: kubia ports: - containerPort: 91 protocol: TCP 可以通过以下查看标签\n1 $ kubectl get po --show-labels 如果只对某些标签的pod感兴趣，可以使用-L选项把tag放在列上：\n1 $ kubectl get po -L creation_method,env 1 2 3 4 5 6 7 NAME READY STATUS RESTARTS AGE CREATION_METHOD ENV kubia-2r2pb 1/1 Running 0 5h7m kubia-kt6gz 1/1 Running 0 5h7m kubia-manual-v2 1/1 Running 0 2m24s manual prod kubia-tqt52 1/1 Running 0 5h7m nginx-r4hdr 1/1 Running 0 18h nginx-rg76b 1/1 Running 0 18h 修改现有pod标签 新增的话，用kubectl label即可:\n1 kubectl label po kubia-manual creation_method=manual 更改的话，需要使用--overwrite选项:\nkubectl label po kubia-manual-v2 env=debug --overwrite 通过标签选择器列出pod子集 标签的强大功能体现在这里。\n标签选择器根据资源的以下条件来筛选资源:\n包含(or not)使用特定key的标签 包含具有特定key和value的标签 包含具有特定key的标签，但值和我们指定的不同 使用标签选择器列出pod 1 2 3 $ kubectl get po -l creation_method=manual NAME READY STATUS RESTARTS AGE kubia-manual-v2 1/1 Running 0 9m5s 列出包含env标签的所有pod，无论其值多少：\n1 2 3 $ kubectl get po -l env NAME READY STATUS RESTARTS AGE kubia-manual-v2 1/1 Running 0 10m 列出没有env标签的pod：\n1 2 3 4 5 6 7 $ kubectl get po -l '!env' NAME READY STATUS RESTARTS AGE kubia-2r2pb 1/1 Running 0 5h17m kubia-kt6gz 1/1 Running 0 5h17m kubia-tqt52 1/1 Running 0 5h17m nginx-r4hdr 1/1 Running 0 18h nginx-rg76b 1/1 Running 0 18h 其他的选择器语法解释：\ncreation_method!=manual：选择带有creation_method标签，但其值不为manual的pod env in (prod, devel): 选择带有env标签且值为prod或者devel的pod env notin (prod, devel): 差不多自己理解 在标签选择器中使用多个条件 精确匹配：app=pc,rel=beta\n这种列出pod子集的做法能够让我们能够进行子集的操作，简单的例如删除自己的pod\n使用标签和选择器约束pod调度 pod的随机调度是k8s集群的工作方式，但如果我们希望对将pod调度到何处有一定的发言权，比如我们的硬件是异构或者非同质的：cpu架构区别、节点磁盘种类区别、GPU密集型运算加速特定节点等。\n当然，我们不是说明pod应该调度到哪个节点，因为基础架构和应用程序的强耦合不是k8s的玩法。我们通过用某种方式描述对节点的需求，使得k8s选择一个符合这个需求的节点，也就是用节点标签和节点标签选择器完成。\n用标签分类工作节点 假设集群中的一个节点刚添加完成，其包含一个用于通用GPU计算的GPU，我们希望加标签去展现这个节点特性:\n1 $ kubectl label node gpu=true 1 2 3 $ kubectl get nodes -l gpu=true NAME STATUS ROLES AGE VERSION minikube Ready master 20h v1.19.2 将pod调度到特定节点 假设已经给节点打上了标签，为了让调度器只在提供了确定标签的节点中进行选择，需要在pod的YAML文件中添加一个节点选择器(这里是deploy:test标签的节点):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 apiVersion: v1 kind: Pod metadata: name: kubia-manual-v2 labels: creation_method: manual env: prod spec: nodeSelector: deploy: \"test\" containers: - image: derios/kubia name: kubia ports: - containerPort: 91 protocol: TCP 调度到特定一个节点(不推荐) 每个node有自己的一个唯一标签: kubernetes.io/hostname，但是如果节点离线了，就会导致pod无法调度，因此用标签选择器比较符合工作流程。当讨论Replication-Controllers和Service的时候，标签选择器的重要性也会彰显。\n注解pod 这块暂时不想深究，知道用法就行\n使用命名空间对资源进行分组 待研究\n停止和移除pod 按名称删除 1 \u0026 kubectl delete po kubia 注意删除pod的时候，是k8s向进程发送SIGTERM信号并等待一定的秒数(30s默认)，如果还没有正常关闭，则发送SIGKILL终止线程。因此，为了保证线程可以正常关闭，需要正确处理SIGTERM信号。\n使用标签选择器删除 1 $ kubectl delete po -l creation_method=manual 即删除带有此标签的所有pod。\n通过删除整个命名空间来删除pod 1 $ kubectl delete ns custom-namespace 删除命名空间的所有pod，但保留命名空间 1 $ kubectl delete po --all 删除当前命名空间的所有pod。\n注意如果空间内创建了replication controllers，删除所有还会新增新的pod出来，所以还需要删除rc。\n删除命名空间中(几乎)所有资源 1 kubectl delete all --all 使用all并不意味着会删除所有的内容，比如secret还是会被保留，这些是要明确指定删除的。\n注意：该命令会删除名为kubernetes的service，不过在几分钟之内会被重新创建。\n","wordCount":"1100","inLanguage":"en","image":"http://localhost:63119/imgs/icon_head.png","datePublished":"2021-03-31T11:22:18+08:00","dateModified":"2021-03-31T11:22:18+08:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:63119/posts/programming/cloud-computing/k8s-basic/"},"publisher":{"@type":"Organization","name":"CctoctoFX","logo":{"@type":"ImageObject","url":"http://localhost:63119/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:63119/ accesskey=h title="CctoctoFX (Alt + H)"><img src=http://localhost:63119/apple-touch-icon.png alt aria-label=logo height=30>CctoctoFX</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:63119/archives title=Archive><span>Archive</span></a></li><li><a href=http://localhost:63119/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=http://localhost:63119/posts/aiinfra title="AI Infra"><span>AI Infra</span></a></li><li><a href=http://localhost:63119/posts/programming title=Programming><span>Programming</span></a></li><li><a href=http://localhost:63119/social title=Social><span>Social</span></a></li><li><a href=http://localhost:63119/open_courses title=Study><span>Study</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:63119/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:63119/posts/>Posts</a>&nbsp;»&nbsp;<a href=http://localhost:63119/posts/programming/>Programming</a>&nbsp;»&nbsp;<a href=http://localhost:63119/posts/programming/cloud-computing/>Kubernetes & Docker</a></div><h1 class="post-title entry-hint-parent">Kubernetes Handbook (Start & Pod)</h1><div class=post-meta><span title='2021-03-31 11:22:18 +0800 CST'>March 31, 2021</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1100 words&nbsp;·&nbsp;Me</div></header><div class=tocsideleft><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#使用minikube构建本地单节点k8s集群>使用minikube构建本地单节点k8s集群</a></li><li><a href=#多节点k8s集群使用google-k8s-engine>多节点k8s集群，使用Google K8s Engine</a></li><li><a href=#k8s初步使用>k8s初步使用</a><ul><li><a href=#namespace相关操作>Namespace相关操作</a></li><li><a href=#创建服务对象访问web应用>创建服务对象，访问Web应用</a></li><li><a href=#replicationcontroller的角色>ReplicationController的角色</a></li><li><a href=#为何需要service>为何需要service</a></li></ul></li><li><a href=#k8s的pod>k8s的pod</a><ul><li><a href=#容器如何共享相同ip和端口空间>容器如何共享相同IP和端口空间</a></li><li><a href=#平坦网络>平坦网络</a></li></ul></li><li><a href=#通过pod合理管理容器>通过pod合理管理容器</a><ul><li><a href=#把多层应用分散到多个pod中>把多层应用分散到多个pod中</a></li><li><a href=#基于扩缩容考虑而分隔到多个pod中>基于扩缩容考虑而分隔到多个pod中</a></li><li><a href=#在pod中使用多个容器的时机>在pod中使用多个容器的时机</a></li></ul></li><li><a href=#以yaml或者json创建pod>以<code>YAML</code>或者<code>JSON</code>创建pod</a><ul><li><a href=#检查现有pod的yaml描述>检查现有pod的<code>YAML</code>描述</a></li><li><a href=#pod定义的主要部分>pod定义的主要部分</a></li><li><a href=#创建一个简单的yaml描述>创建一个简单的<code>YAML</code>描述</a></li><li><a href=#用kubectl-create来创建pod>用<code>kubectl create</code>来创建pod</a></li></ul></li><li><a href=#查看应用程序日志>查看应用程序日志</a></li><li><a href=#向pod发送请求>向pod发送请求</a><ul><li><a href=#将本地网络端口转发到pod中的端口>将本地网络端口转发到pod中的端口</a></li><li><a href=#通过端口转发连接到pod>通过端口转发连接到pod</a></li></ul></li><li><a href=#使用tag组织pod>使用Tag组织pod</a><ul><li><a href=#创建pod的时候指定标签>创建pod的时候指定标签</a></li><li><a href=#修改现有pod标签>修改现有pod标签</a></li></ul></li><li><a href=#通过标签选择器列出pod子集>通过<code>标签选择器</code>列出pod子集</a><ul><li><a href=#使用标签选择器列出pod>使用<code>标签选择器</code>列出pod</a></li><li><a href=#在标签选择器中使用多个条件>在<code>标签选择器</code>中使用多个条件</a></li></ul></li><li><a href=#使用标签和选择器约束pod调度>使用<code>标签</code>和<code>选择器</code>约束pod调度</a><ul><li><a href=#用标签分类工作节点>用标签分类工作节点</a></li><li><a href=#将pod调度到特定节点>将pod调度到特定节点</a></li><li><a href=#调度到特定一个节点不推荐>调度到特定一个节点(不推荐)</a></li></ul></li><li><a href=#注解pod>注解pod</a></li><li><a href=#使用命名空间对资源进行分组>使用命名空间对资源进行分组</a></li><li><a href=#停止和移除pod>停止和移除pod</a><ul><li><a href=#按名称删除>按名称删除</a></li><li><a href=#使用标签选择器删除>使用<code>标签选择器</code>删除</a></li><li><a href=#通过删除整个命名空间来删除pod>通过删除整个命名空间来删除pod</a></li><li><a href=#删除命名空间的所有pod但保留命名空间>删除命名空间的所有pod，但保留命名空间</a></li><li><a href=#删除命名空间中几乎所有资源>删除命名空间中(几乎)所有资源</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h2 id=使用minikube构建本地单节点k8s集群>使用minikube构建本地单节点k8s集群<a hidden class=anchor aria-hidden=true href=#使用minikube构建本地单节点k8s集群>#</a></h2><ul><li>minikube ssh</li><li>kubectl cluster-info</li><li>kubectl get nodes #查看节点信息</li><li>kubectl describe node minikube #详细信息</li></ul><h2 id=多节点k8s集群使用google-k8s-engine>多节点k8s集群，使用Google K8s Engine<a hidden class=anchor aria-hidden=true href=#多节点k8s集群使用google-k8s-engine>#</a></h2><p>构建方式看GKE官网即可</p><h2 id=k8s初步使用>k8s初步使用<a hidden class=anchor aria-hidden=true href=#k8s初步使用>#</a></h2><p>kubectl run kubia &ndash;image=derios/kubia &ndash;port=8080 &ndash;generator=run/v1</p><ul><li><code>--image=derios/kubia</code>代表要运行的容器镜像</li><li>这里的<code>--generator</code>会被废弃，其含义指代的是创建一个<code>ReplicationController</code>而不是<code>Deployment</code>。</li><li>kubectl apply -f <yaml name>更常用</li><li>kubectl get pods</li><li>kubectl get pods -o wide 显示pod ip和pod的节点</li><li>如果使用GWE，可以访问集群的dashborad:</li><li>kubectl clusert-info获取地址</li><li>gcloud container clusters describe kubia | grep -E &ldquo;(username|password):&ldquo;获取用户名和密码<br>如果仅仅使用minikube，则如下不需要任何凭证即可访问:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>minikube dashboard
</span></span></code></pre></td></tr></table></div></div><h3 id=namespace相关操作>Namespace相关操作<a hidden class=anchor aria-hidden=true href=#namespace相关操作>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=l>kubectl config set-context --current --namespace=my-namespace</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=创建服务对象访问web应用>创建服务对象，访问Web应用<a hidden class=anchor aria-hidden=true href=#创建服务对象访问web应用>#</a></h3><p><code>如果使用minikube或者kubeadm等自定义k8s，loadbalancer是没有集成的，需要AWS或者Google Cloud。最好使用NodePort或者Ingress Controller。如果真要用minikube, 可以使用minikube tunnel解决, 或者minikube service kubia-http</code></p><ul><li><p>kubectl expose rc/po/svc kubia &ndash;type=LoadBalancer &ndash;name kubia-http创建出的service介于pod和node之间, kubectl get services可以查看</p></li><li><p>如果没有外部IP地址，因为k8s运行的云基础设施新建lb需要一段时间，lb启动以后应该会显示</p></li></ul><h3 id=replicationcontroller的角色>ReplicationController的角色<a hidden class=anchor aria-hidden=true href=#replicationcontroller的角色>#</a></h3><ul><li>复制pod，replica扩缩</li><li><code>kubectl scale rc kubia --replicas=3</code> 可以将rc下的pods方便进行扩缩容</li></ul><h3 id=为何需要service>为何需要service<a hidden class=anchor aria-hidden=true href=#为何需要service>#</a></h3><p>解决不断变化的pod IP问题，以及在一个固定的IP和端口上对外暴露多个pod。</p><p>当一个service被创建，会得到一个静态IP，在service的生命周期这个IP不会被改变，service会确保其中提个pod接受连接，而非关注这个pod运行在何处.</p><h2 id=k8s的pod>k8s的pod<a hidden class=anchor aria-hidden=true href=#k8s的pod>#</a></h2><p>pod不一定要包含多个容器，单独容器的pod也是很常见的。如果pod包含多个容器，那么这些容器都工作在同一个工作节点上，pod是不能跨多个工作节点工作的。</p><p>pod概念的提出，是因为我们不能把多个进程聚集在一个单独的容器中，我们需要另一种更为高级的结构将容器绑定在一起，并把他们欧威一个单元进行管理。</p><p>一个Pod下的所有容器都在相同的额network和UTS命名空间下运行，所以共享相同的主机名和网络接口，也能够通过IPC进行通信，甚至在最新的k8s和docker版本下，能共享相同的PID命名空间。</p><h3 id=容器如何共享相同ip和端口空间>容器如何共享相同IP和端口空间<a hidden class=anchor aria-hidden=true href=#容器如何共享相同ip和端口空间>#</a></h3><p>由于pod中的容器运行于相同Namespace命名空间，所以他们共享相同的IP地址和端口空间。这意味着在同一个pod中的容器运行的多个线程不能绑定到相同的端口号，否则会冲突。此外，他们还有相同的loopback网络几口，所以容器可以通过localhost和同一个pod中的其他容器进行通信。</p><h3 id=平坦网络>平坦网络<a hidden class=anchor aria-hidden=true href=#平坦网络>#</a></h3><p>k8s集群中所有pod都在同一个共享网络地址空间中，也就是说每个pod都可以通过其他pod的IP地址来实现相互访问，表示他们之间没有NAT(网络地址转换)网管。当两个pod彼此之间发送网络数据包时，都把对方的实际IP地址看作数据包中的源IP。</p><p>因此可以看到，pod就是逻辑主机，行为和非容器世界中的物理主机或者虚拟机相似。运行在同一个pod中的进程和运行在同一物理机或者虚拟机上的进程类似，只是每个进程封装在一个容器里。</p><h2 id=通过pod合理管理容器>通过pod合理管理容器<a hidden class=anchor aria-hidden=true href=#通过pod合理管理容器>#</a></h2><p><code>一个由前端应用服务器和后端数据库组成的多层应用程序，应该讲其配置为单个pod还是两个pod呢？</code></p><h3 id=把多层应用分散到多个pod中>把多层应用分散到多个pod中<a hidden class=anchor aria-hidden=true href=#把多层应用分散到多个pod中>#</a></h3><p>一个pod下的所有容器运行在一起，而web服务器和数据库真的要在同一台计算机上运行吗？明显是否定的。而且如何k8s集群节点多了，如果只有一个单独的pod，其资源利用率也很低。</p><h3 id=基于扩缩容考虑而分隔到多个pod中>基于扩缩容考虑而分隔到多个pod中<a hidden class=anchor aria-hidden=true href=#基于扩缩容考虑而分隔到多个pod中>#</a></h3><p>pod是扩缩容的基本单位，k8s不能横向扩缩单个容器，而只能扩缩整个pod，所以明显web服务器和数据库放在一起是不对的。<br>而且数据库这种有状态的服务器，比无状态的web服务器更加难扩展，所以如果要单独扩缩容器，这个容器必须明确地部署在单独的pod当中</p><h3 id=在pod中使用多个容器的时机>在pod中使用多个容器的时机<a hidden class=anchor aria-hidden=true href=#在pod中使用多个容器的时机>#</a></h3><p>一般来说，常见场景是应用由一个主进程和多个辅助进程组成，也就是这个容器组是紧密耦合的。举例就是，pod中的主容器是仅仅服务于每个目录中文件的Web服务器，另一个sidecar容器定期从外部资源下载内容并将其存储在Web服务器目录里。这种情形需要使用k8s的Volume，把其挂在到两个容器里。<br>sidecar容器包括：日志轮转器、收集器、数据处理器、通信适配器等等</p><p>因此容器如何分组到pod这个问题，我们需要问以下的问题：</p><ol><li>它们是否需要一起运行还是可以在不同的主机上运行？</li><li>它们代表的是一个整体还是相互独立的组件？</li><li>它们必须一起扩缩容还是可以分别单独进行？</li></ol><h2 id=以yaml或者json创建pod>以<code>YAML</code>或者<code>JSON</code>创建pod<a hidden class=anchor aria-hidden=true href=#以yaml或者json创建pod>#</a></h2><p>好处：<code>kubectl run</code>局限性很多，比如属性配置很有限，而资源配置的方式除了更方便定义k8s资源对象，还能把它们存储在版本控制系统中。<br>注意参考: <a href=https://kubernetes.io/docs/reference/>k8s api reference</a></p><h3 id=检查现有pod的yaml描述>检查现有pod的<code>YAML</code>描述<a hidden class=anchor aria-hidden=true href=#检查现有pod的yaml描述>#</a></h3><p><code>kubectl get po kubia-zxzij -o yaml</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2021-03-31T03:00:40Z&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>generateName</span><span class=p>:</span><span class=w> </span><span class=l>kubia-</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>kubia</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>managedFields</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>fieldsType</span><span class=p>:</span><span class=w> </span><span class=l>FieldsV1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>fieldsV1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>f:metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>f:generateName</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>f:labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>.</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>f:app</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>f:ownerReferences</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>.</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=l>k:{&#34;uid&#34;:&#34;4b78e019-3753-40a1-998c-0d0ec4af9f29&#34;}:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>.</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:apiVersion</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:blockOwnerDeletion</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:controller</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:kind</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:name</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:uid</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>f:spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>f:containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=l>k:{&#34;name&#34;:&#34;kubia&#34;}:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>.</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:image</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:imagePullPolicy</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:name</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>.</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=l>k:{&#34;containerPort&#34;:90,&#34;protocol&#34;:&#34;TCP&#34;}:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>.</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>f:containerPort</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>f:protocol</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:resources</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:terminationMessagePath</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:terminationMessagePolicy</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>f:dnsPolicy</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>f:enableServiceLinks</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>f:restartPolicy</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>f:schedulerName</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>f:securityContext</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>f:terminationGracePeriodSeconds</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>manager</span><span class=p>:</span><span class=w> </span><span class=l>kube-controller-manager</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>operation</span><span class=p>:</span><span class=w> </span><span class=l>Update</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>time</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2021-03-31T03:00:40Z&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>fieldsType</span><span class=p>:</span><span class=w> </span><span class=l>FieldsV1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>fieldsV1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>f:status</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>f:conditions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=l>k:{&#34;type&#34;:&#34;ContainersReady&#34;}:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>.</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:lastProbeTime</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:lastTransitionTime</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:status</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:type</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=l>k:{&#34;type&#34;:&#34;Initialized&#34;}:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>.</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:lastProbeTime</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:lastTransitionTime</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:status</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:type</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=l>k:{&#34;type&#34;:&#34;Ready&#34;}:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>.</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:lastProbeTime</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:lastTransitionTime</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:status</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:type</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>f:containerStatuses</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>f:hostIP</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>f:phase</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>f:podIP</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>f:podIPs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>.</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=l>k:{&#34;ip&#34;:&#34;172.17.0.7&#34;}:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>.</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>f:ip</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>f:startTime</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>manager</span><span class=p>:</span><span class=w> </span><span class=l>kubelet</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>operation</span><span class=p>:</span><span class=w> </span><span class=l>Update</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>time</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2021-03-31T03:00:47Z&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kubia-2r2pb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ownerReferences</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>blockOwnerDeletion</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>controller</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ReplicationController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kubia</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>uid</span><span class=p>:</span><span class=w> </span><span class=l>4b78e019-3753-40a1-998c-0d0ec4af9f29</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourceVersion</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;11025&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selfLink</span><span class=p>:</span><span class=w> </span><span class=l>/api/v1/namespaces/default/pods/kubia-2r2pb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>uid</span><span class=p>:</span><span class=w> </span><span class=l>342307fe-f6d8-4201-ba02-0210cd75d0a8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>derios/kubia</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kubia</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>90</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>terminationMessagePath</span><span class=p>:</span><span class=w> </span><span class=l>/dev/termination-log</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>terminationMessagePolicy</span><span class=p>:</span><span class=w> </span><span class=l>File</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/var/run/secrets/kubernetes.io/serviceaccount</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>default-token-whxzx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>readOnly</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>dnsPolicy</span><span class=p>:</span><span class=w> </span><span class=l>ClusterFirst</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enableServiceLinks</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nodeName</span><span class=p>:</span><span class=w> </span><span class=l>minikube</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>preemptionPolicy</span><span class=p>:</span><span class=w> </span><span class=l>PreemptLowerPriority</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>priority</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>schedulerName</span><span class=p>:</span><span class=w> </span><span class=l>default-scheduler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>securityContext</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>serviceAccount</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>serviceAccountName</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>terminationGracePeriodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>tolerations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>effect</span><span class=p>:</span><span class=w> </span><span class=l>NoExecute</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>node.kubernetes.io/not-ready</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=l>Exists</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>tolerationSeconds</span><span class=p>:</span><span class=w> </span><span class=m>300</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>effect</span><span class=p>:</span><span class=w> </span><span class=l>NoExecute</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>node.kubernetes.io/unreachable</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=l>Exists</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>tolerationSeconds</span><span class=p>:</span><span class=w> </span><span class=m>300</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>default-token-whxzx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>secret</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>defaultMode</span><span class=p>:</span><span class=w> </span><span class=m>420</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class=l>default-token-whxzx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>status</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>conditions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>lastProbeTime</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>lastTransitionTime</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2021-03-31T03:00:40Z&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>status</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;True&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Initialized</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>lastProbeTime</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>lastTransitionTime</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2021-03-31T03:00:47Z&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>status</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;True&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Ready</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>lastProbeTime</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>lastTransitionTime</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2021-03-31T03:00:47Z&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>status</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;True&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ContainersReady</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>lastProbeTime</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>lastTransitionTime</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2021-03-31T03:00:40Z&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>status</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;True&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>PodScheduled</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containerStatuses</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>containerID</span><span class=p>:</span><span class=w> </span><span class=l>docker://1cce1d07039838f1f4d825d088fca52b54b15808efebf20d1f38cc2952a65ebd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>derios/kubia:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>imageID</span><span class=p>:</span><span class=w> </span><span class=l>docker-pullable://derios/kubia@sha256:7aa603e50514206f8d40126520409a6814001c1bae68b9f286cca9c1ca271f7a</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>lastState</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kubia</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ready</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restartCount</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>started</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>state</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>running</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>startedAt</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2021-03-31T03:00:46Z&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hostIP</span><span class=p>:</span><span class=w> </span><span class=m>192.168.49.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>phase</span><span class=p>:</span><span class=w> </span><span class=l>Running</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>podIP</span><span class=p>:</span><span class=w> </span><span class=m>172.17.0.7</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>podIPs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>ip</span><span class=p>:</span><span class=w> </span><span class=m>172.17.0.7</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>qosClass</span><span class=p>:</span><span class=w> </span><span class=l>BestEffort</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>startTime</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2021-03-31T03:00:40Z&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>虽然看着比较复杂，主要包含了<code>k8s对象/资源类型</code>、<code>k8s API版本</code>、<code>pod元数据</code>、<code>pod规格和内容</code>、<code>pod和内部容器的详细状态</code>等。</p><h3 id=pod定义的主要部分>pod定义的主要部分<a hidden class=anchor aria-hidden=true href=#pod定义的主要部分>#</a></h3><ol><li><code>metadata</code>: 名称、命名空间、标签和关于该容器的其他信息</li><li><code>spec</code>：包含pod内容的实际说明，例如pod的容器、卷和其他数据</li><li><code>status</code>: 包含运行中的pod的当前信息，比如pod所处的条件、每个容器的描述和状态，以及内部IP和其他基本信息</li></ol><p>创建新的pod的时候，不需要提供<code>status</code>部分，这只是运行时数据。实际上深究每个属性的意义不是很大，我们需要关注创建pod的最基本信息。</p><h3 id=创建一个简单的yaml描述>创建一个简单的<code>YAML</code>描述<a hidden class=anchor aria-hidden=true href=#创建一个简单的yaml描述>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kubia-manual</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>derios/kubia</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kubia</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>可以用<code>kubectl explain pods</code>、<code>kubectl explain pod.spec</code>之类去看资源定义</p><h3 id=用kubectl-create来创建pod>用<code>kubectl create</code>来创建pod<a hidden class=anchor aria-hidden=true href=#用kubectl-create来创建pod>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ kubectl create -f kubia-manual.yaml
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ kubectl get pods
</span></span></code></pre></td></tr></table></div></div><h2 id=查看应用程序日志>查看应用程序日志<a hidden class=anchor aria-hidden=true href=#查看应用程序日志>#</a></h2><p>小型node.js应用把日志记录到进程的标准输出，容器化的应用程序通常把日志记录到标准输出和标准错误流，而不是写入文件。所以这就允许user通过标准的方式查看不同应用程序的日志。</p><p>Docker(或者广义的container runtime)把这些流重定向到文件，可以用以下命令获取容器的日志：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ docker logs &lt;container id&gt;
</span></span></code></pre></td></tr></table></div></div><p>一般可以ssh到pod运行节点然后这样查看，不过k8s提供了更为简单的方式。</p><p><strong>使用<code>kubectl logs命令获取pod日志</code></strong>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ kubectl logs kubia-manual
</span></span></code></pre></td></tr></table></div></div><p>如果一个pod只包含一个容器，那么查看k8s应用程序的日志会变得很简单。</p><p><strong>获取多容器pod的日志时指定容器名称</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ kubectl logs kubia-manual -c kubia
</span></span></code></pre></td></tr></table></div></div><p>请注意，如果pod被删了，那么pod里的日志也会被删。如果希望在pod删除之后仍然可以获取其日志，需要设置中心化、集群范围的日志系统，把所有日志存储到中心存储中，这个在后续会讨论。</p><h2 id=向pod发送请求>向pod发送请求<a hidden class=anchor aria-hidden=true href=#向pod发送请求>#</a></h2><p>通过<code>端口转发</code>连接到pod以进行测试和调试。</p><h3 id=将本地网络端口转发到pod中的端口>将本地网络端口转发到pod中的端口<a hidden class=anchor aria-hidden=true href=#将本地网络端口转发到pod中的端口>#</a></h3><p>如果不想通过service情形下对某个特定的pod进行通信(debug)，可以通过<code>kubectl port-forward</code>命令完成端口转发:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nv>$kubectl</span> port-forward kubia-munual 8888:8080
</span></span></code></pre></td></tr></table></div></div><p>这样就能通过本地端口连接到我们的pod。</p><h3 id=通过端口转发连接到pod>通过端口转发连接到pod<a hidden class=anchor aria-hidden=true href=#通过端口转发连接到pod>#</a></h3><p>另一个终端<code>curl localhost:8888</code>即可调试。实际上述指令起了一个线程进行对调试请求的处理。</p><h2 id=使用tag组织pod>使用Tag组织pod<a hidden class=anchor aria-hidden=true href=#使用tag组织pod>#</a></h2><p>对于微服务架构，部署数量能很轻松膨胀：多副本、不同版本等等。所以需要进行Pod分组去管理对象。Tag标签不仅仅可以组织pod，还包括了其他k8s资源。</p><p>标签的定义：可以附加到资源的任意键值对。只要标签的key在资源内唯一，那么一个资源便可以拥有多个标签，一般我们在创建资源的时候回把标签附加到资源上，当然后续可以新增、修改标签。举个例子：</p><ul><li><code>app</code>: 指定pod属于哪个应用、组件或者微服务</li><li><code>rel</code>：显示在pod中运行的应用程序版本是stable、beta还是canary</li></ul><p>利用这种组织形式，访问集群的开发或者运维能通过查看pod标签轻松看到系统结构以及每个pod的角色。</p><h3 id=创建pod的时候指定标签>创建pod的时候指定标签<a hidden class=anchor aria-hidden=true href=#创建pod的时候指定标签>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kubia-manual-v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>creation_method</span><span class=p>:</span><span class=w> </span><span class=l>manual</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class=l>prod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>derios/kubia</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kubia</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>91</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>可以通过以下查看标签</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ kubectl get po --show-labels
</span></span></code></pre></td></tr></table></div></div><p>如果只对某些标签的pod感兴趣，可以使用<code>-L</code>选项把tag放在列上：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ kubectl get po -L creation_method,env
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>NAME              READY   STATUS    RESTARTS   AGE     CREATION_METHOD   ENV
</span></span><span class=line><span class=cl>kubia-2r2pb       1/1     Running   <span class=m>0</span>          5h7m
</span></span><span class=line><span class=cl>kubia-kt6gz       1/1     Running   <span class=m>0</span>          5h7m
</span></span><span class=line><span class=cl>kubia-manual-v2   1/1     Running   <span class=m>0</span>          2m24s   manual            prod
</span></span><span class=line><span class=cl>kubia-tqt52       1/1     Running   <span class=m>0</span>          5h7m
</span></span><span class=line><span class=cl>nginx-r4hdr       1/1     Running   <span class=m>0</span>          18h
</span></span><span class=line><span class=cl>nginx-rg76b       1/1     Running   <span class=m>0</span>          18h
</span></span></code></pre></td></tr></table></div></div><h3 id=修改现有pod标签>修改现有pod标签<a hidden class=anchor aria-hidden=true href=#修改现有pod标签>#</a></h3><p>新增的话，用<code>kubectl label</code>即可:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl label po kubia-manual <span class=nv>creation_method</span><span class=o>=</span>manual
</span></span></code></pre></td></tr></table></div></div><p>更改的话，需要使用<code>--overwrite</code>选项:</p><pre tabindex=0><code class=language-shel data-lang=shel>kubectl label po kubia-manual-v2 env=debug --overwrite
</code></pre><h2 id=通过标签选择器列出pod子集>通过<code>标签选择器</code>列出pod子集<a hidden class=anchor aria-hidden=true href=#通过标签选择器列出pod子集>#</a></h2><p>标签的强大功能体现在这里。</p><p>标签选择器根据资源的以下条件来筛选资源:</p><ol><li>包含(or not)使用特定key的标签</li><li>包含具有特定key和value的标签</li><li>包含具有特定key的标签，但值和我们指定的不同</li></ol><h3 id=使用标签选择器列出pod>使用<code>标签选择器</code>列出pod<a hidden class=anchor aria-hidden=true href=#使用标签选择器列出pod>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ kubectl get po -l <span class=nv>creation_method</span><span class=o>=</span>manual
</span></span><span class=line><span class=cl>NAME              READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>kubia-manual-v2   1/1     Running   <span class=m>0</span>          9m5s
</span></span></code></pre></td></tr></table></div></div><p>列出包含<code>env</code>标签的所有pod，无论其值多少：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ kubectl get po -l env
</span></span><span class=line><span class=cl>NAME              READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>kubia-manual-v2   1/1     Running   <span class=m>0</span>          10m
</span></span></code></pre></td></tr></table></div></div><p>列出没有<code>env</code>标签的pod：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ kubectl get po -l <span class=s1>&#39;!env&#39;</span>
</span></span><span class=line><span class=cl>NAME          READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>kubia-2r2pb   1/1     Running   <span class=m>0</span>          5h17m
</span></span><span class=line><span class=cl>kubia-kt6gz   1/1     Running   <span class=m>0</span>          5h17m
</span></span><span class=line><span class=cl>kubia-tqt52   1/1     Running   <span class=m>0</span>          5h17m
</span></span><span class=line><span class=cl>nginx-r4hdr   1/1     Running   <span class=m>0</span>          18h
</span></span><span class=line><span class=cl>nginx-rg76b   1/1     Running   <span class=m>0</span>          18h
</span></span></code></pre></td></tr></table></div></div><p>其他的选择器语法解释：</p><ul><li><code>creation_method!=manual</code>：选择带有<code>creation_method</code>标签，但其值不为manual的pod</li><li><code>env in (prod, devel)</code>: 选择带有<code>env</code>标签且值为<code>prod</code>或者<code>devel</code>的pod</li><li><code>env notin (prod, devel)</code>: 差不多自己理解</li></ul><h3 id=在标签选择器中使用多个条件>在<code>标签选择器</code>中使用多个条件<a hidden class=anchor aria-hidden=true href=#在标签选择器中使用多个条件>#</a></h3><p>精确匹配：<code>app=pc,rel=beta</code></p><p>这种列出pod子集的做法能够让我们能够进行子集的操作，简单的例如删除自己的pod</p><h2 id=使用标签和选择器约束pod调度>使用<code>标签</code>和<code>选择器</code>约束pod调度<a hidden class=anchor aria-hidden=true href=#使用标签和选择器约束pod调度>#</a></h2><p>pod的随机调度是k8s集群的工作方式，但如果我们希望对将pod调度到何处有一定的发言权，比如我们的硬件是<code>异构</code>或者<code>非同质</code>的：cpu架构区别、节点磁盘种类区别、GPU密集型运算加速特定节点等。</p><p>当然，我们不是说明pod应该调度到哪个节点，因为基础架构和应用程序的强耦合不是k8s的玩法。我们通过用<code>某种方式</code>描述对节点的需求，使得k8s选择一个符合这个需求的节点，也就是用<code>节点标签</code>和<code>节点标签选择器</code>完成。</p><h3 id=用标签分类工作节点>用标签分类工作节点<a hidden class=anchor aria-hidden=true href=#用标签分类工作节点>#</a></h3><p>假设集群中的一个节点刚添加完成，其包含一个用于通用GPU计算的GPU，我们希望加标签去展现这个节点特性:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ kubectl label node &lt;node name&gt; <span class=nv>gpu</span><span class=o>=</span><span class=nb>true</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ kubectl get nodes -l <span class=nv>gpu</span><span class=o>=</span><span class=nb>true</span>
</span></span><span class=line><span class=cl>NAME       STATUS   ROLES    AGE   VERSION
</span></span><span class=line><span class=cl>minikube   Ready    master   20h   v1.19.2
</span></span></code></pre></td></tr></table></div></div><h3 id=将pod调度到特定节点>将pod调度到特定节点<a hidden class=anchor aria-hidden=true href=#将pod调度到特定节点>#</a></h3><p>假设已经给节点打上了标签，为了让调度器只在提供了确定标签的节点中进行选择，需要在pod的YAML文件中添加一个节点选择器(这里是deploy:test标签的节点):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kubia-manual-v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>creation_method</span><span class=p>:</span><span class=w> </span><span class=l>manual</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class=l>prod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nodeSelector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;test&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>derios/kubia</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kubia</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>91</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=调度到特定一个节点不推荐>调度到特定一个节点(不推荐)<a hidden class=anchor aria-hidden=true href=#调度到特定一个节点不推荐>#</a></h3><p>每个node有自己的一个唯一标签: <code>kubernetes.io/hostname</code>，但是如果节点离线了，就会导致pod无法调度，因此用标签选择器比较符合工作流程。当讨论Replication-Controllers和Service的时候，标签选择器的重要性也会彰显。</p><h2 id=注解pod>注解pod<a hidden class=anchor aria-hidden=true href=#注解pod>#</a></h2><p>这块暂时不想深究，知道用法就行</p><h2 id=使用命名空间对资源进行分组>使用命名空间对资源进行分组<a hidden class=anchor aria-hidden=true href=#使用命名空间对资源进行分组>#</a></h2><p>待研究</p><h2 id=停止和移除pod>停止和移除pod<a hidden class=anchor aria-hidden=true href=#停止和移除pod>#</a></h2><h3 id=按名称删除>按名称删除<a hidden class=anchor aria-hidden=true href=#按名称删除>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=p>&amp;</span> kubectl delete po kubia
</span></span></code></pre></td></tr></table></div></div><p>注意删除pod的时候，是k8s向进程发送<code>SIGTERM</code>信号并等待一定的秒数(30s默认)，如果还没有正常关闭，则发送<code>SIGKILL</code>终止线程。因此，为了保证线程可以正常关闭，需要正确处理<code>SIGTERM</code>信号。</p><h3 id=使用标签选择器删除>使用<code>标签选择器</code>删除<a hidden class=anchor aria-hidden=true href=#使用标签选择器删除>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ kubectl delete po -l <span class=nv>creation_method</span><span class=o>=</span>manual
</span></span></code></pre></td></tr></table></div></div><p>即删除带有此标签的所有pod。</p><h3 id=通过删除整个命名空间来删除pod>通过删除整个命名空间来删除pod<a hidden class=anchor aria-hidden=true href=#通过删除整个命名空间来删除pod>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ kubectl delete ns custom-namespace
</span></span></code></pre></td></tr></table></div></div><h3 id=删除命名空间的所有pod但保留命名空间>删除命名空间的所有pod，但保留命名空间<a hidden class=anchor aria-hidden=true href=#删除命名空间的所有pod但保留命名空间>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ kubectl delete po --all
</span></span></code></pre></td></tr></table></div></div><p>删除当前命名空间的所有pod。</p><p>注意如果空间内创建了replication controllers，删除所有还会新增新的pod出来，所以还需要删除rc。</p><h3 id=删除命名空间中几乎所有资源>删除命名空间中(几乎)所有资源<a hidden class=anchor aria-hidden=true href=#删除命名空间中几乎所有资源>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl delete all --all
</span></span></code></pre></td></tr></table></div></div><p>使用all并不意味着会删除所有的内容，比如secret还是会被保留，这些是要明确指定删除的。</p><p>注意：该命令会删除名为<code>kubernetes</code>的service，不过在几分钟之内会被重新创建。</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=http://localhost:63119/posts/programming/design-pattern/go-visitor/><span class=title>« Prev</span><br><span>Go编程模式：Visitor（k8s）</span>
</a><a class=next href=http://localhost:63119/posts/programming/cloud-computing/docker-basic/><span class=title>Next »</span><br><span>Docker Cheat Sheet</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Kubernetes Handbook (Start & Pod) on x" href="https://x.com/intent/tweet/?text=Kubernetes%20Handbook%20%28Start%20%26%20Pod%29&amp;url=http%3a%2f%2flocalhost%3a63119%2fposts%2fprogramming%2fcloud-computing%2fk8s-basic%2f&amp;hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Kubernetes Handbook (Start & Pod) on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a63119%2fposts%2fprogramming%2fcloud-computing%2fk8s-basic%2f&amp;title=Kubernetes%20Handbook%20%28Start%20%26%20Pod%29&amp;summary=Kubernetes%20Handbook%20%28Start%20%26%20Pod%29&amp;source=http%3a%2f%2flocalhost%3a63119%2fposts%2fprogramming%2fcloud-computing%2fk8s-basic%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Kubernetes Handbook (Start & Pod) on reddit" href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a63119%2fposts%2fprogramming%2fcloud-computing%2fk8s-basic%2f&title=Kubernetes%20Handbook%20%28Start%20%26%20Pod%29"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Kubernetes Handbook (Start & Pod) on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a63119%2fposts%2fprogramming%2fcloud-computing%2fk8s-basic%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Kubernetes Handbook (Start & Pod) on whatsapp" href="https://api.whatsapp.com/send?text=Kubernetes%20Handbook%20%28Start%20%26%20Pod%29%20-%20http%3a%2f%2flocalhost%3a63119%2fposts%2fprogramming%2fcloud-computing%2fk8s-basic%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Kubernetes Handbook (Start & Pod) on telegram" href="https://telegram.me/share/url?text=Kubernetes%20Handbook%20%28Start%20%26%20Pod%29&amp;url=http%3a%2f%2flocalhost%3a63119%2fposts%2fprogramming%2fcloud-computing%2fk8s-basic%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Kubernetes Handbook (Start & Pod) on ycombinator" href="https://news.ycombinator.com/submitlink?t=Kubernetes%20Handbook%20%28Start%20%26%20Pod%29&u=http%3a%2f%2flocalhost%3a63119%2fposts%2fprogramming%2fcloud-computing%2fk8s-basic%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:63119/>CctoctoFX</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>