<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Kubernetes Operator Development History | CctoctoFX</title><meta name=keywords content><meta name=description content="
本文旨在记录对中间件、编排组件容器化部署后，实现kubernetes扩展组件Controller的过程。
Third-Parties
kubernetes-client: javascript
client-go
kube-rs
client-go源码分析
目录结构


kubernetes: contains the clientset to access Kubernetes API.
discovery: discover APIs supported by a Kubernetes API server.
dynamic: contains a dynamic client that can perform generic operations on arbitrary Kubernetes API objects.
transport: set up auth and start a connection.
tools/cache: useful for writing controllers.
informers:  informer group
listers:  lister group

代码实例


1
2
3
4


git clone https://github.com/huweihuang/client-go.git
cd client-go
#保证本地HOME目录有配置kubernetes集群的配置文件
go run client-go.go


client-go.go"><meta name=author content="Me"><link rel=canonical href=https://pillumina.github.io/posts/programming/cloud-computing/k8s-operator-dev/><link crossorigin=anonymous href=/assets/css/stylesheet.9d388901283682bb45dd422fcaa0d0a2054a3c8ff47c9cc6b2baab15508b1b90.css integrity="sha256-nTiJASg2grtF3UIvyqDQogVKPI/0fJzGsrqrFVCLG5A=" rel="preload stylesheet" as=style><link rel=icon href=https://pillumina.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://pillumina.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://pillumina.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://pillumina.github.io/apple-touch-icon.png><link rel=mask-icon href=https://pillumina.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://pillumina.github.io/posts/programming/cloud-computing/k8s-operator-dev/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js crossorigin=anonymous></script><script>(function(){function t(){return document.querySelector(".post-content")||document.querySelector(".post-single")||document.body}function n(e){return/\$\$[\s\S]+?\$\$|\\\(|\\\)|\\\[|\\\]/.test(e)}function s(e){if(window.__mathjaxLoaded)return;window.__mathjaxLoaded=!0,window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre","code","tt"],ignoreHtmlClass:"no-math"}};var t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js",t.defer=!0,t.onload=function(){window.MathJax&&window.MathJax.typesetPromise&&window.MathJax.typesetPromise([e]).catch(function(e){console.warn("MathJax typeset error",e)})},document.head.appendChild(t)}function e(){try{if(typeof renderMathInElement=="function"){const e=t();renderMathInElement(e,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\[",right:"\\]",display:!0},{left:"\\(",right:"\\)",display:!1}],throwOnError:!1,strict:!1,trust:!0,ignoredTags:["script","noscript","style","textarea","pre","code","tt"],ignoredClasses:["no-math"],macros:{"\\boldsymbol":"\\mathbf{#1}","\\bm":"\\mathbf{#1}"}}),setTimeout(function(){n(e.innerHTML)&&s(e)},200)}}catch(e){console.warn("KaTeX render error:",e)}}document.addEventListener("DOMContentLoaded",function(){e(),setTimeout(e,200)}),window.addEventListener("load",function(){setTimeout(e,0)})})()</script><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script><script>const config={startOnLoad:!0,theme:"neutral",themeVariables:{lineColor:"#0f0f0f"},flowchart:{useMaxWidth:!1,htmlLabels:!0}};mermaid.initialize(config),window.onload=()=>{window.mermaid.init(0[0],document.querySelectorAll(".language-mermaid"))}</script><link rel=stylesheet href=/css/custom.min.de5dbc794941fcaf859be4ddf58c8ebc96bd8b6f47c4b2b10a1d309a8ccd26f1.css integrity="sha256-3l28eUlB/K+Fm+Td9YyOvJa9i29HxLKxCh0wmozNJvE="><script>document.addEventListener("DOMContentLoaded",function(){const t=document.querySelectorAll("h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]"),n=document.querySelectorAll(".toc a");if(t.length===0||n.length===0)return;const s={};t.forEach(e=>{s[e.id]=e.offsetTop});function i(){const t=window.scrollY+100;let e="";for(const[n,o]of Object.entries(s))if(t>=o)e=n;else break;return e}function o(){const e=i();if(n.forEach(e=>{e.classList.remove("active")}),e){const t=document.querySelector(`.toc a[href="#${e}"]`);t&&t.classList.add("active")}}let e=!1;window.addEventListener("scroll",function(){e||(window.requestAnimationFrame(function(){o(),e=!1}),e=!0)}),o()})</script><meta property="og:url" content="https://pillumina.github.io/posts/programming/cloud-computing/k8s-operator-dev/"><meta property="og:site_name" content="CctoctoFX"><meta property="og:title" content="Kubernetes Operator Development History"><meta property="og:description" content=" 本文旨在记录对中间件、编排组件容器化部署后，实现kubernetes扩展组件Controller的过程。
Third-Parties kubernetes-client: javascript
client-go
kube-rs
client-go源码分析 目录结构 kubernetes: contains the clientset to access Kubernetes API. discovery: discover APIs supported by a Kubernetes API server. dynamic: contains a dynamic client that can perform generic operations on arbitrary Kubernetes API objects. transport: set up auth and start a connection. tools/cache: useful for writing controllers. informers: informer group listers: lister group 代码实例 1 2 3 4 git clone https://github.com/huweihuang/client-go.git cd client-go #保证本地HOME目录有配置kubernetes集群的配置文件 go run client-go.go client-go.go"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-04-29T11:22:18+08:00"><meta property="article:modified_time" content="2021-04-29T11:22:18+08:00"><meta property="og:image" content="https://pillumina.github.io/imgs/icon_head.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://pillumina.github.io/imgs/icon_head.png"><meta name=twitter:title content="Kubernetes Operator Development History"><meta name=twitter:description content="
本文旨在记录对中间件、编排组件容器化部署后，实现kubernetes扩展组件Controller的过程。
Third-Parties
kubernetes-client: javascript
client-go
kube-rs
client-go源码分析
目录结构


kubernetes: contains the clientset to access Kubernetes API.
discovery: discover APIs supported by a Kubernetes API server.
dynamic: contains a dynamic client that can perform generic operations on arbitrary Kubernetes API objects.
transport: set up auth and start a connection.
tools/cache: useful for writing controllers.
informers:  informer group
listers:  lister group

代码实例


1
2
3
4


git clone https://github.com/huweihuang/client-go.git
cd client-go
#保证本地HOME目录有配置kubernetes集群的配置文件
go run client-go.go


client-go.go"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://pillumina.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Programming","item":"https://pillumina.github.io/posts/programming/"},{"@type":"ListItem","position":3,"name":"Kubernetes \u0026 Docker","item":"https://pillumina.github.io/posts/programming/cloud-computing/"},{"@type":"ListItem","position":4,"name":"Kubernetes Operator Development History","item":"https://pillumina.github.io/posts/programming/cloud-computing/k8s-operator-dev/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Kubernetes Operator Development History","name":"Kubernetes Operator Development History","description":" 本文旨在记录对中间件、编排组件容器化部署后，实现kubernetes扩展组件Controller的过程。\nThird-Parties kubernetes-client: javascript\nclient-go\nkube-rs\nclient-go源码分析 目录结构 kubernetes: contains the clientset to access Kubernetes API. discovery: discover APIs supported by a Kubernetes API server. dynamic: contains a dynamic client that can perform generic operations on arbitrary Kubernetes API objects. transport: set up auth and start a connection. tools/cache: useful for writing controllers. informers: informer group listers: lister group 代码实例 1 2 3 4 git clone https://github.com/huweihuang/client-go.git cd client-go #保证本地HOME目录有配置kubernetes集群的配置文件 go run client-go.go client-go.go\n","keywords":[],"articleBody":" 本文旨在记录对中间件、编排组件容器化部署后，实现kubernetes扩展组件Controller的过程。\nThird-Parties kubernetes-client: javascript\nclient-go\nkube-rs\nclient-go源码分析 目录结构 kubernetes: contains the clientset to access Kubernetes API. discovery: discover APIs supported by a Kubernetes API server. dynamic: contains a dynamic client that can perform generic operations on arbitrary Kubernetes API objects. transport: set up auth and start a connection. tools/cache: useful for writing controllers. informers: informer group listers: lister group 代码实例 1 2 3 4 git clone https://github.com/huweihuang/client-go.git cd client-go #保证本地HOME目录有配置kubernetes集群的配置文件 go run client-go.go client-go.go\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 package main import ( \"flag\" \"fmt\" \"os\" \"path/filepath\" \"time\" metav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\" \"k8s.io/client-go/kubernetes\" \"k8s.io/client-go/tools/clientcmd\" ) func main() { var kubeconfig *string if home := homeDir(); home != \"\" { kubeconfig = flag.String(\"kubeconfig\", filepath.Join(home, \".kube\", \"config\"), \"(optional) absolute path to the kubeconfig file\") } else { kubeconfig = flag.String(\"kubeconfig\", \"\", \"absolute path to the kubeconfig file\") } flag.Parse() // uses the current context in kubeconfig config, err := clientcmd.BuildConfigFromFlags(\"\", *kubeconfig) if err != nil { panic(err.Error()) } // creates the clientset clientset, err := kubernetes.NewForConfig(config) if err != nil { panic(err.Error()) } for { pods, err := clientset.CoreV1().Pods(\"\").List(metav1.ListOptions{}) if err != nil { panic(err.Error()) } fmt.Printf(\"There are %d pods in the cluster\\n\", len(pods.Items)) time.Sleep(10 * time.Second) } } func homeDir() string { if h := os.Getenv(\"HOME\"); h != \"\" { return h } return os.Getenv(\"USERPROFILE\") // windows } output\n1 2 3 4 5 6 ➜ go run client-go.go There are 9 pods in the cluster There are 7 pods in the cluster There are 7 pods in the cluster There are 7 pods in the cluster There are 7 pods in the cluster kubeconfig 1 kubeconfig = flag.String(\"kubeconfig\", filepath.Join(home, \".kube\", \"config\"), \"(optional) absolute path to the kubeconfig file\") 为了获取k8s配置文件kubeconfig的绝对路径，一般路径为$HOME/.kube/config，这个文件主要用来配置本地连接的k8s集群。\nconfig的内容大概如图所示：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 apiVersion: v1 clusters: - cluster: server: http://:8080 name: k8s contexts: - context: cluster: k8s namespace: default user: \"\" name: default current-context: default kind: Config preferences: {} users: [] rest.config 通过参数和BuildConfigFromFlags方法获取rest.Config对象\n1 config, err := clientcmd.BuildConfigFromFlags(\"\", *kubeconfig) k8s.io/client-go/tools/clientcmd/client_config.go\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // BuildConfigFromFlags is a helper function that builds configs from a master // url or a kubeconfig filepath. These are passed in as command line flags for cluster // components. Warnings should reflect this usage. If neither masterUrl or kubeconfigPath // are passed in we fallback to inClusterConfig. If inClusterConfig fails, we fallback // to the default config. func BuildConfigFromFlags(masterUrl, kubeconfigPath string) (*restclient.Config, error) { if kubeconfigPath == \"\" \u0026\u0026 masterUrl == \"\" { klog.Warning(\"Neither --kubeconfig nor --master was specified. Using the inClusterConfig. This might not work.\") kubeconfig, err := restclient.InClusterConfig() if err == nil { return kubeconfig, nil } klog.Warning(\"error creating inClusterConfig, falling back to default config: \", err) } return NewNonInteractiveDeferredLoadingClientConfig( \u0026ClientConfigLoadingRules{ExplicitPath: kubeconfigPath}, \u0026ConfigOverrides{ClusterInfo: clientcmdapi.Cluster{Server: masterUrl}}).ClientConfig() } clientset 通过*rest.Config参数和NewForConfig方法来获取clientset对象，clientset是多个client集合，每个client可能包括不同版本的方法调用\n1 clientset, err := kubernetes.NewForConfig(config) NewForConfig NewForConfig函数就是初始化clientset中的每个client。\nk8s.io/client-go/kubernetes/clientset.go\n1 2 3 4 5 6 7 8 9 10 // NewForConfig creates a new Clientset for the given config. func NewForConfig(c *rest.Config) (*Clientset, error) { configShallowCopy := *c ... var cs Clientset cs.appsV1beta1, err = appsv1beta1.NewForConfig(\u0026configShallowCopy) ... cs.coreV1, err = corev1.NewForConfig(\u0026configShallowCopy) ... } clientset的结构体 k8s.io/client-go/kubernetes/clientset.go\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 // Clientset contains the clients for groups. Each group has exactly one // version included in a Clientset. type Clientset struct { *discovery.DiscoveryClient admissionregistrationV1 *admissionregistrationv1.AdmissionregistrationV1Client admissionregistrationV1beta1 *admissionregistrationv1beta1.AdmissionregistrationV1beta1Client internalV1alpha1 *internalv1alpha1.InternalV1alpha1Client appsV1 *appsv1.AppsV1Client appsV1beta1 *appsv1beta1.AppsV1beta1Client appsV1beta2 *appsv1beta2.AppsV1beta2Client authenticationV1 *authenticationv1.AuthenticationV1Client authenticationV1beta1 *authenticationv1beta1.AuthenticationV1beta1Client authorizationV1 *authorizationv1.AuthorizationV1Client authorizationV1beta1 *authorizationv1beta1.AuthorizationV1beta1Client autoscalingV1 *autoscalingv1.AutoscalingV1Client autoscalingV2beta1 *autoscalingv2beta1.AutoscalingV2beta1Client autoscalingV2beta2 *autoscalingv2beta2.AutoscalingV2beta2Client batchV1 *batchv1.BatchV1Client batchV1beta1 *batchv1beta1.BatchV1beta1Client certificatesV1 *certificatesv1.CertificatesV1Client certificatesV1beta1 *certificatesv1beta1.CertificatesV1beta1Client coordinationV1beta1 *coordinationv1beta1.CoordinationV1beta1Client coordinationV1 *coordinationv1.CoordinationV1Client coreV1 *corev1.CoreV1Client discoveryV1 *discoveryv1.DiscoveryV1Client discoveryV1beta1 *discoveryv1beta1.DiscoveryV1beta1Client eventsV1 *eventsv1.EventsV1Client eventsV1beta1 *eventsv1beta1.EventsV1beta1Client extensionsV1beta1 *extensionsv1beta1.ExtensionsV1beta1Client flowcontrolV1alpha1 *flowcontrolv1alpha1.FlowcontrolV1alpha1Client flowcontrolV1beta1 *flowcontrolv1beta1.FlowcontrolV1beta1Client networkingV1 *networkingv1.NetworkingV1Client networkingV1beta1 *networkingv1beta1.NetworkingV1beta1Client nodeV1 *nodev1.NodeV1Client nodeV1alpha1 *nodev1alpha1.NodeV1alpha1Client nodeV1beta1 *nodev1beta1.NodeV1beta1Client policyV1 *policyv1.PolicyV1Client policyV1beta1 *policyv1beta1.PolicyV1beta1Client rbacV1 *rbacv1.RbacV1Client rbacV1beta1 *rbacv1beta1.RbacV1beta1Client rbacV1alpha1 *rbacv1alpha1.RbacV1alpha1Client schedulingV1alpha1 *schedulingv1alpha1.SchedulingV1alpha1Client schedulingV1beta1 *schedulingv1beta1.SchedulingV1beta1Client schedulingV1 *schedulingv1.SchedulingV1Client storageV1beta1 *storagev1beta1.StorageV1beta1Client storageV1 *storagev1.StorageV1Client storageV1alpha1 *storagev1alpha1.StorageV1alpha1Client } clientset.Interface clientset实现了以下的interface，可以通过以下的方法获得具体的client，例如:\n1 pods, err := clientset.CoreV1().Pods(\"\").List(metav1.ListOptions{}) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 type Interface interface { Discovery() discovery.DiscoveryInterface AdmissionregistrationV1() admissionregistrationv1.AdmissionregistrationV1Interface AdmissionregistrationV1beta1() admissionregistrationv1beta1.AdmissionregistrationV1beta1Interface InternalV1alpha1() internalv1alpha1.InternalV1alpha1Interface AppsV1() appsv1.AppsV1Interface AppsV1beta1() appsv1beta1.AppsV1beta1Interface AppsV1beta2() appsv1beta2.AppsV1beta2Interface AuthenticationV1() authenticationv1.AuthenticationV1Interface AuthenticationV1beta1() authenticationv1beta1.AuthenticationV1beta1Interface AuthorizationV1() authorizationv1.AuthorizationV1Interface AuthorizationV1beta1() authorizationv1beta1.AuthorizationV1beta1Interface AutoscalingV1() autoscalingv1.AutoscalingV1Interface AutoscalingV2beta1() autoscalingv2beta1.AutoscalingV2beta1Interface AutoscalingV2beta2() autoscalingv2beta2.AutoscalingV2beta2Interface BatchV1() batchv1.BatchV1Interface BatchV1beta1() batchv1beta1.BatchV1beta1Interface CertificatesV1() certificatesv1.CertificatesV1Interface CertificatesV1beta1() certificatesv1beta1.CertificatesV1beta1Interface CoordinationV1beta1() coordinationv1beta1.CoordinationV1beta1Interface CoordinationV1() coordinationv1.CoordinationV1Interface CoreV1() corev1.CoreV1Interface DiscoveryV1() discoveryv1.DiscoveryV1Interface DiscoveryV1beta1() discoveryv1beta1.DiscoveryV1beta1Interface EventsV1() eventsv1.EventsV1Interface EventsV1beta1() eventsv1beta1.EventsV1beta1Interface ExtensionsV1beta1() extensionsv1beta1.ExtensionsV1beta1Interface FlowcontrolV1alpha1() flowcontrolv1alpha1.FlowcontrolV1alpha1Interface FlowcontrolV1beta1() flowcontrolv1beta1.FlowcontrolV1beta1Interface NetworkingV1() networkingv1.NetworkingV1Interface NetworkingV1beta1() networkingv1beta1.NetworkingV1beta1Interface NodeV1() nodev1.NodeV1Interface NodeV1alpha1() nodev1alpha1.NodeV1alpha1Interface NodeV1beta1() nodev1beta1.NodeV1beta1Interface PolicyV1() policyv1.PolicyV1Interface PolicyV1beta1() policyv1beta1.PolicyV1beta1Interface RbacV1() rbacv1.RbacV1Interface RbacV1beta1() rbacv1beta1.RbacV1beta1Interface RbacV1alpha1() rbacv1alpha1.RbacV1alpha1Interface SchedulingV1alpha1() schedulingv1alpha1.SchedulingV1alpha1Interface SchedulingV1beta1() schedulingv1beta1.SchedulingV1beta1Interface SchedulingV1() schedulingv1.SchedulingV1Interface StorageV1beta1() storagev1beta1.StorageV1beta1Interface StorageV1() storagev1.StorageV1Interface StorageV1alpha1() storagev1alpha1.StorageV1alpha1Interface } CoreV1Client 常用的CoreV1Client为例子分析\ncorev1.NewForConfig 1 2 3 4 5 6 7 8 9 10 11 12 // NewForConfig creates a new CoreV1Client for the given config. func NewForConfig(c *rest.Config) (*CoreV1Client, error) { config := *c if err := setConfigDefaults(\u0026config); err != nil { return nil, err } client, err := rest.RESTClientFor(\u0026config) if err != nil { return nil, err } return \u0026CoreV1Client{client}, nil } 通过传入配置信息rest.Config来实例化对象，其本质是调用了rest.RESTClientFor(\u0026Config)方法创建了RESTClient的对象，即CoreV1Client的本质就是一个RESTClient对象。\nCoreV1Client结构体定义 1 2 3 4 // CoreV1Client is used to interact with features provided by the group. type CoreV1Client struct { restClient rest.Interface } CoreV1Client实现了CoreV1Interface接口，从而对k8s的资源对象进行增删改查的操作。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 //CoreV1Client的方法 func (c *CoreV1Client) ComponentStatuses() ComponentStatusInterface {...} //ConfigMaps func (c *CoreV1Client) ConfigMaps(namespace string) ConfigMapInterface {...} //Endpoints func (c *CoreV1Client) Endpoints(namespace string) EndpointsInterface {...} func (c *CoreV1Client) Events(namespace string) EventInterface {...} func (c *CoreV1Client) LimitRanges(namespace string) LimitRangeInterface {...} //Namespaces func (c *CoreV1Client) Namespaces() NamespaceInterface {...} //Nodes func (c *CoreV1Client) Nodes() NodeInterface {...} func (c *CoreV1Client) PersistentVolumes() PersistentVolumeInterface {...} func (c *CoreV1Client) PersistentVolumeClaims(namespace string) PersistentVolumeClaimInterface {...} //Pods func (c *CoreV1Client) Pods(namespace string) PodInterface {...} func (c *CoreV1Client) PodTemplates(namespace string) PodTemplateInterface {...} //ReplicationControllers func (c *CoreV1Client) ReplicationControllers(namespace string) ReplicationControllerInterface {...} func (c *CoreV1Client) ResourceQuotas(namespace string) ResourceQuotaInterface {...} func (c *CoreV1Client) Secrets(namespace string) SecretInterface {...} //Services func (c *CoreV1Client) Services(namespace string) ServiceInterface {...} func (c *CoreV1Client) ServiceAccounts(namespace string) ServiceAccountInterface {...} CoreV1Interface 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 type CoreV1Interface interface { RESTClient() rest.Interface ComponentStatusesGetter ConfigMapsGetter EndpointsGetter EventsGetter LimitRangesGetter NamespacesGetter NodesGetter PersistentVolumesGetter PersistentVolumeClaimsGetter PodsGetter PodTemplatesGetter ReplicationControllersGetter ResourceQuotasGetter SecretsGetter ServicesGetter ServiceAccountsGetter } CoreV1Interface中包含了各种k8s对象的调用接口，例如PodsGetter是对k8s中pod对象增删改查的接口。ServicesGetter是对service对象的操作的接口。\nPodsGetter接口举例探索 可以以PodsGetter接口为例来研究一下CoreV1Client对pod对象的增删改查调用。\n示例中的代码如下：\n1 pods, err := clientset.CoreV1().Pods(\"\").List(metav1.ListOptions{}) CoreV1().Pods()\n1 2 3 4 5 6 7 8 9 10 11 12 13 // core_client.go func (c *CoreV1Client) Pods(namespace string) PodInterface { return newPods(c, namespace) } // pod.go // newPods returns a Pods func newPods(c *CoreV1Client, namespace string) *pods { return \u0026pods{ client: c.RESTClient(), ns: namespace, } } CoreV1().Pods()方法实际上调用了newPods()方法，创建了一个pod对象，该对象继承了rest.Interface接口，即最终的实现本质是RESTClient的HTTP调用。\n1 2 3 4 5 // pods implements PodInterface type pods struct { client rest.Interface ns string } pods对象实现了PodInterface接口：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // PodInterface has methods to work with Pod resources. type PodInterface interface { Create(*v1.Pod) (*v1.Pod, error) Update(*v1.Pod) (*v1.Pod, error) UpdateStatus(*v1.Pod) (*v1.Pod, error) Delete(name string, options *metav1.DeleteOptions) error DeleteCollection(options *metav1.DeleteOptions, listOptions metav1.ListOptions) error Get(name string, options metav1.GetOptions) (*v1.Pod, error) List(opts metav1.ListOptions) (*v1.PodList, error) Watch(opts metav1.ListOptions) (watch.Interface, error) Patch(name string, pt types.PatchType, data []byte, subresources ...string) (result *v1.Pod, err error) GetEphemeralContainers(podName string, options metav1.GetOptions) (*v1.EphemeralContainers, error) UpdateEphemeralContainers(podName string, ephemeralContainers *v1.EphemeralContainers) (*v1.EphemeralContainers, error) PodExpansion 这个interface定义了pods对象的增删改查等方法。\nPodsGetter 继承了PodInterface的接口:\n1 2 3 4 5 // PodsGetter has a method to return a PodInterface. // A group's client should implement this interface. type PodsGetter interface { Pods(namespace string) PodInterface } Pods().List()方法通过RESTClient的HTTP调用来实现对k8s的pod资源的获取:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // List takes label and field selectors, and returns the list of Pods that match those selectors. func (c *pods) List(opts metav1.ListOptions) (result *v1.PodList, err error) { var timeout time.Duration if opts.TimeoutSeconds != nil { timeout = time.Duration(*opts.TimeoutSeconds) * time.Second } result = \u0026v1.PodList{} err = c.client.Get(). Namespace(c.ns). Resource(\"pods\"). VersionedParams(\u0026opts, scheme.ParameterCodec). Timeout(timeout). Do(). Into(result) return } 以上分析了clientset.CoreV1().Pods(\"\").List(metav1.ListOptions{})对pod资源获取的过程，最终是调用RESTClient的方法实现。\nRESTClient 待补充\n总结 client-go对K8s资源对象的调用，需要先获取k8s的配置信息，也就是$HOME/.kube/config。\n调用顺序如下：\nkubeconfig -\u003e rest.config -\u003e clientset -\u003e 具体的client(CoreV1Client) -\u003e 具体的资源对象(如pod) -\u003e RESTClient -\u003e http.Client -\u003e HTTP 请求的发送和响应\n常用的client有CoreV1Client、AppsV1betaClient、ExtensionsV1beta1Client等。\nOperator SDK ","wordCount":"1437","inLanguage":"en","image":"https://pillumina.github.io/imgs/icon_head.png","datePublished":"2021-04-29T11:22:18+08:00","dateModified":"2021-04-29T11:22:18+08:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://pillumina.github.io/posts/programming/cloud-computing/k8s-operator-dev/"},"publisher":{"@type":"Organization","name":"CctoctoFX","logo":{"@type":"ImageObject","url":"https://pillumina.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://pillumina.github.io/ accesskey=h title="CctoctoFX (Alt + H)"><img src=https://pillumina.github.io/apple-touch-icon.png alt aria-label=logo height=30>CctoctoFX</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://pillumina.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://pillumina.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://pillumina.github.io/posts/aiinfra/ title="AI Infra"><span>AI Infra</span></a></li><li><a href=https://pillumina.github.io/posts/llmtheory/ title=Thoery><span>Thoery</span></a></li><li><a href=https://pillumina.github.io/posts/programming/ title=Programming><span>Programming</span></a></li><li><a href=https://pillumina.github.io/social/ title=Social><span>Social</span></a></li><li><a href=https://pillumina.github.io/open_courses/ title=Study><span>Study</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://pillumina.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://pillumina.github.io/posts/>Posts</a>&nbsp;»&nbsp;<a href=https://pillumina.github.io/posts/programming/>Programming</a>&nbsp;»&nbsp;<a href=https://pillumina.github.io/posts/programming/cloud-computing/>Kubernetes & Docker</a></div><h1 class="post-title entry-hint-parent">Kubernetes Operator Development History</h1><div class=post-meta><span title='2021-04-29 11:22:18 +0800 CST'>April 29, 2021</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;1437 words&nbsp;·&nbsp;Me</div></header><div class="toc side left"><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><ul><li><a href=#third-parties>Third-Parties</a></li><li><a href=#client-go源码分析><code>client-go</code>源码分析</a><ul><li><a href=#目录结构>目录结构</a></li><li><a href=#代码实例>代码实例</a></li><li><a href=#kubeconfig><code>kubeconfig</code></a></li><li><a href=#restconfig><code>rest.config</code></a></li><li><a href=#clientset><code>clientset</code></a><ul><li><a href=#newforconfig><code>NewForConfig</code></a></li><li><a href=#clientset的结构体><code>clientset</code>的结构体</a></li><li><a href=#clientsetinterface><code>clientset.Interface</code></a></li></ul></li><li><a href=#corev1client><code>CoreV1Client</code></a><ul><li><a href=#corev1newforconfig><code>corev1.NewForConfig</code></a></li><li><a href=#corev1client结构体定义><code>CoreV1Client</code>结构体定义</a></li><li><a href=#corev1interface><code>CoreV1Interface</code></a></li><li><a href=#podsgetter接口举例探索><code>PodsGetter</code>接口举例探索</a></li></ul></li><li><a href=#restclient><code>RESTClient</code></a></li><li><a href=#总结>总结</a></li></ul></li><li><a href=#operator-sdk><code>Operator SDK</code></a></li></ul></li></ul></nav></div></details></div><div class=post-content><blockquote><p>本文旨在记录对中间件、编排组件容器化部署后，实现kubernetes扩展组件Controller的过程。</p></blockquote><h2 id=third-parties>Third-Parties<a hidden class=anchor aria-hidden=true href=#third-parties>#</a></h2><p><a href=https://github.com/kubernetes-client/javascript>kubernetes-client: javascript</a></p><p><a href=https://github.com/kubernetes/client-go>client-go</a></p><p><a href=https://github.com/clux/kube-rs>kube-rs</a></p><h2 id=client-go源码分析><code>client-go</code>源码分析<a hidden class=anchor aria-hidden=true href=#client-go源码分析>#</a></h2><h3 id=目录结构>目录结构<a hidden class=anchor aria-hidden=true href=#目录结构>#</a></h3><blockquote><ul><li><code>kubernetes</code>: contains the clientset to access Kubernetes API.</li><li><code>discovery</code>: discover APIs supported by a Kubernetes API server.</li><li><code>dynamic</code>: contains a dynamic client that can perform generic operations on arbitrary Kubernetes API objects.</li><li><code>transport</code>: set up auth and start a connection.</li><li><code>tools/cache</code>: useful for writing controllers.</li><li><code>informers</code>: informer group</li><li><code>listers</code>: lister group</li></ul></blockquote><h3 id=代码实例>代码实例<a hidden class=anchor aria-hidden=true href=#代码实例>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>git clone https://github.com/huweihuang/client-go.git
</span></span><span class=line><span class=cl><span class=nb>cd</span> client-go
</span></span><span class=line><span class=cl><span class=c1>#保证本地HOME目录有配置kubernetes集群的配置文件</span>
</span></span><span class=line><span class=cl>go run client-go.go
</span></span></code></pre></td></tr></table></div></div><p><code>client-go.go</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;flag&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;os&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;path/filepath&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>metav1</span> <span class=s>&#34;k8s.io/apimachinery/pkg/apis/meta/v1&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;k8s.io/client-go/kubernetes&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;k8s.io/client-go/tools/clientcmd&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>kubeconfig</span> <span class=o>*</span><span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>home</span> <span class=o>:=</span> <span class=nf>homeDir</span><span class=p>();</span> <span class=nx>home</span> <span class=o>!=</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>kubeconfig</span> <span class=p>=</span> <span class=nx>flag</span><span class=p>.</span><span class=nf>String</span><span class=p>(</span><span class=s>&#34;kubeconfig&#34;</span><span class=p>,</span> <span class=nx>filepath</span><span class=p>.</span><span class=nf>Join</span><span class=p>(</span><span class=nx>home</span><span class=p>,</span> <span class=s>&#34;.kube&#34;</span><span class=p>,</span> <span class=s>&#34;config&#34;</span><span class=p>),</span> <span class=s>&#34;(optional) absolute path to the kubeconfig file&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>kubeconfig</span> <span class=p>=</span> <span class=nx>flag</span><span class=p>.</span><span class=nf>String</span><span class=p>(</span><span class=s>&#34;kubeconfig&#34;</span><span class=p>,</span> <span class=s>&#34;&#34;</span><span class=p>,</span> <span class=s>&#34;absolute path to the kubeconfig file&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>flag</span><span class=p>.</span><span class=nf>Parse</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=c1>// uses the current context in kubeconfig</span>
</span></span><span class=line><span class=cl>	<span class=nx>config</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>clientcmd</span><span class=p>.</span><span class=nf>BuildConfigFromFlags</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>,</span> <span class=o>*</span><span class=nx>kubeconfig</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>())</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>// creates the clientset</span>
</span></span><span class=line><span class=cl>	<span class=nx>clientset</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>kubernetes</span><span class=p>.</span><span class=nf>NewForConfig</span><span class=p>(</span><span class=nx>config</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>())</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>pods</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>clientset</span><span class=p>.</span><span class=nf>CoreV1</span><span class=p>().</span><span class=nf>Pods</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>).</span><span class=nf>List</span><span class=p>(</span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>())</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;There are %d pods in the cluster\n&#34;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=nx>pods</span><span class=p>.</span><span class=nx>Items</span><span class=p>))</span>
</span></span><span class=line><span class=cl>		<span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>10</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>homeDir</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>h</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>Getenv</span><span class=p>(</span><span class=s>&#34;HOME&#34;</span><span class=p>);</span> <span class=nx>h</span> <span class=o>!=</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>h</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>os</span><span class=p>.</span><span class=nf>Getenv</span><span class=p>(</span><span class=s>&#34;USERPROFILE&#34;</span><span class=p>)</span> <span class=c1>// windows</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>output</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜ go run client-go.go
</span></span><span class=line><span class=cl>There are <span class=m>9</span> pods in the cluster
</span></span><span class=line><span class=cl>There are <span class=m>7</span> pods in the cluster
</span></span><span class=line><span class=cl>There are <span class=m>7</span> pods in the cluster
</span></span><span class=line><span class=cl>There are <span class=m>7</span> pods in the cluster
</span></span><span class=line><span class=cl>There are <span class=m>7</span> pods in the cluster
</span></span></code></pre></td></tr></table></div></div><h3 id=kubeconfig><code>kubeconfig</code><a hidden class=anchor aria-hidden=true href=#kubeconfig>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>kubeconfig</span> <span class=p>=</span> <span class=nx>flag</span><span class=p>.</span><span class=nf>String</span><span class=p>(</span><span class=s>&#34;kubeconfig&#34;</span><span class=p>,</span> <span class=nx>filepath</span><span class=p>.</span><span class=nf>Join</span><span class=p>(</span><span class=nx>home</span><span class=p>,</span> <span class=s>&#34;.kube&#34;</span><span class=p>,</span> <span class=s>&#34;config&#34;</span><span class=p>),</span> <span class=s>&#34;(optional) absolute path to the kubeconfig file&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>为了获取k8s配置文件<code>kubeconfig</code>的绝对路径，一般路径为<code>$HOME/.kube/config</code>，这个文件主要用来配置本地连接的k8s集群。</p><p>config的内容大概如图所示：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>clusters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>cluster</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>server</span><span class=p>:</span><span class=w> </span><span class=l>http://&lt;kube-master-ip&gt;:8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>k8s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>contexts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>context</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class=l>k8s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>user</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>current-context</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>preferences</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>users</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=restconfig><code>rest.config</code><a hidden class=anchor aria-hidden=true href=#restconfig>#</a></h3><p>通过参数和<code>BuildConfigFromFlags</code>方法获取<code>rest.Config</code>对象</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>config</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>clientcmd</span><span class=p>.</span><span class=nf>BuildConfigFromFlags</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>,</span> <span class=o>*</span><span class=nx>kubeconfig</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><a href=https://github.com/kubernetes/client-go/blob/master/tools/clientcmd/client_config.go#L522>k8s.io/client-go/tools/clientcmd/client_config.go</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// BuildConfigFromFlags is a helper function that builds configs from a master</span>
</span></span><span class=line><span class=cl><span class=c1>// url or a kubeconfig filepath. These are passed in as command line flags for cluster</span>
</span></span><span class=line><span class=cl><span class=c1>// components. Warnings should reflect this usage. If neither masterUrl or kubeconfigPath</span>
</span></span><span class=line><span class=cl><span class=c1>// are passed in we fallback to inClusterConfig. If inClusterConfig fails, we fallback</span>
</span></span><span class=line><span class=cl><span class=c1>// to the default config.</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>BuildConfigFromFlags</span><span class=p>(</span><span class=nx>masterUrl</span><span class=p>,</span> <span class=nx>kubeconfigPath</span> <span class=kt>string</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>restclient</span><span class=p>.</span><span class=nx>Config</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>kubeconfigPath</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=o>&amp;&amp;</span> <span class=nx>masterUrl</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>klog</span><span class=p>.</span><span class=nf>Warning</span><span class=p>(</span><span class=s>&#34;Neither --kubeconfig nor --master was specified.  Using the inClusterConfig.  This might not work.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>kubeconfig</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>restclient</span><span class=p>.</span><span class=nf>InClusterConfig</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nx>kubeconfig</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>klog</span><span class=p>.</span><span class=nf>Warning</span><span class=p>(</span><span class=s>&#34;error creating inClusterConfig, falling back to default config: &#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nf>NewNonInteractiveDeferredLoadingClientConfig</span><span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=o>&amp;</span><span class=nx>ClientConfigLoadingRules</span><span class=p>{</span><span class=nx>ExplicitPath</span><span class=p>:</span> <span class=nx>kubeconfigPath</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=o>&amp;</span><span class=nx>ConfigOverrides</span><span class=p>{</span><span class=nx>ClusterInfo</span><span class=p>:</span> <span class=nx>clientcmdapi</span><span class=p>.</span><span class=nx>Cluster</span><span class=p>{</span><span class=nx>Server</span><span class=p>:</span> <span class=nx>masterUrl</span><span class=p>}}).</span><span class=nf>ClientConfig</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=clientset><code>clientset</code><a hidden class=anchor aria-hidden=true href=#clientset>#</a></h3><p>通过<code>*rest.Config</code>参数和<code>NewForConfig</code>方法来获取<code>clientset</code>对象，<code>clientset</code>是多个<code>client</code>集合，每个<code>client</code>可能包括不同版本的方法调用</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>clientset</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>kubernetes</span><span class=p>.</span><span class=nf>NewForConfig</span><span class=p>(</span><span class=nx>config</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=newforconfig><code>NewForConfig</code><a hidden class=anchor aria-hidden=true href=#newforconfig>#</a></h4><p><code>NewForConfig</code>函数就是初始化<code>clientset</code>中的每个client。</p><p><a href=https://github.com/kubernetes/client-go/blob/87887458218a51f3944b2f4c553eb38173458e97/kubernetes/clientset.go#L396>k8s.io/client-go/kubernetes/clientset.go</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// NewForConfig creates a new Clientset for the given config.</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewForConfig</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>rest</span><span class=p>.</span><span class=nx>Config</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>Clientset</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>configShallowCopy</span> <span class=o>:=</span> <span class=o>*</span><span class=nx>c</span>
</span></span><span class=line><span class=cl>	<span class=o>...</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>cs</span> <span class=nx>Clientset</span>
</span></span><span class=line><span class=cl>	<span class=nx>cs</span><span class=p>.</span><span class=nx>appsV1beta1</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>appsv1beta1</span><span class=p>.</span><span class=nf>NewForConfig</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>configShallowCopy</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=o>...</span>
</span></span><span class=line><span class=cl>	<span class=nx>cs</span><span class=p>.</span><span class=nx>coreV1</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>corev1</span><span class=p>.</span><span class=nf>NewForConfig</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>configShallowCopy</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=o>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=clientset的结构体><code>clientset</code>的结构体<a hidden class=anchor aria-hidden=true href=#clientset的结构体>#</a></h4><p><a href=https://github.com/kubernetes/client-go/blob/master/kubernetes/clientset.go>k8s.io/client-go/kubernetes/clientset.go</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Clientset contains the clients for groups. Each group has exactly one</span>
</span></span><span class=line><span class=cl><span class=c1>// version included in a Clientset.</span>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Clientset</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=o>*</span><span class=nx>discovery</span><span class=p>.</span><span class=nx>DiscoveryClient</span>
</span></span><span class=line><span class=cl>	<span class=nx>admissionregistrationV1</span>      <span class=o>*</span><span class=nx>admissionregistrationv1</span><span class=p>.</span><span class=nx>AdmissionregistrationV1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>admissionregistrationV1beta1</span> <span class=o>*</span><span class=nx>admissionregistrationv1beta1</span><span class=p>.</span><span class=nx>AdmissionregistrationV1beta1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>internalV1alpha1</span>             <span class=o>*</span><span class=nx>internalv1alpha1</span><span class=p>.</span><span class=nx>InternalV1alpha1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>appsV1</span>                       <span class=o>*</span><span class=nx>appsv1</span><span class=p>.</span><span class=nx>AppsV1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>appsV1beta1</span>                  <span class=o>*</span><span class=nx>appsv1beta1</span><span class=p>.</span><span class=nx>AppsV1beta1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>appsV1beta2</span>                  <span class=o>*</span><span class=nx>appsv1beta2</span><span class=p>.</span><span class=nx>AppsV1beta2Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>authenticationV1</span>             <span class=o>*</span><span class=nx>authenticationv1</span><span class=p>.</span><span class=nx>AuthenticationV1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>authenticationV1beta1</span>        <span class=o>*</span><span class=nx>authenticationv1beta1</span><span class=p>.</span><span class=nx>AuthenticationV1beta1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>authorizationV1</span>              <span class=o>*</span><span class=nx>authorizationv1</span><span class=p>.</span><span class=nx>AuthorizationV1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>authorizationV1beta1</span>         <span class=o>*</span><span class=nx>authorizationv1beta1</span><span class=p>.</span><span class=nx>AuthorizationV1beta1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>autoscalingV1</span>                <span class=o>*</span><span class=nx>autoscalingv1</span><span class=p>.</span><span class=nx>AutoscalingV1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>autoscalingV2beta1</span>           <span class=o>*</span><span class=nx>autoscalingv2beta1</span><span class=p>.</span><span class=nx>AutoscalingV2beta1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>autoscalingV2beta2</span>           <span class=o>*</span><span class=nx>autoscalingv2beta2</span><span class=p>.</span><span class=nx>AutoscalingV2beta2Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>batchV1</span>                      <span class=o>*</span><span class=nx>batchv1</span><span class=p>.</span><span class=nx>BatchV1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>batchV1beta1</span>                 <span class=o>*</span><span class=nx>batchv1beta1</span><span class=p>.</span><span class=nx>BatchV1beta1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>certificatesV1</span>               <span class=o>*</span><span class=nx>certificatesv1</span><span class=p>.</span><span class=nx>CertificatesV1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>certificatesV1beta1</span>          <span class=o>*</span><span class=nx>certificatesv1beta1</span><span class=p>.</span><span class=nx>CertificatesV1beta1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>coordinationV1beta1</span>          <span class=o>*</span><span class=nx>coordinationv1beta1</span><span class=p>.</span><span class=nx>CoordinationV1beta1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>coordinationV1</span>               <span class=o>*</span><span class=nx>coordinationv1</span><span class=p>.</span><span class=nx>CoordinationV1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>coreV1</span>                       <span class=o>*</span><span class=nx>corev1</span><span class=p>.</span><span class=nx>CoreV1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>discoveryV1</span>                  <span class=o>*</span><span class=nx>discoveryv1</span><span class=p>.</span><span class=nx>DiscoveryV1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>discoveryV1beta1</span>             <span class=o>*</span><span class=nx>discoveryv1beta1</span><span class=p>.</span><span class=nx>DiscoveryV1beta1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>eventsV1</span>                     <span class=o>*</span><span class=nx>eventsv1</span><span class=p>.</span><span class=nx>EventsV1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>eventsV1beta1</span>                <span class=o>*</span><span class=nx>eventsv1beta1</span><span class=p>.</span><span class=nx>EventsV1beta1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>extensionsV1beta1</span>            <span class=o>*</span><span class=nx>extensionsv1beta1</span><span class=p>.</span><span class=nx>ExtensionsV1beta1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>flowcontrolV1alpha1</span>          <span class=o>*</span><span class=nx>flowcontrolv1alpha1</span><span class=p>.</span><span class=nx>FlowcontrolV1alpha1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>flowcontrolV1beta1</span>           <span class=o>*</span><span class=nx>flowcontrolv1beta1</span><span class=p>.</span><span class=nx>FlowcontrolV1beta1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>networkingV1</span>                 <span class=o>*</span><span class=nx>networkingv1</span><span class=p>.</span><span class=nx>NetworkingV1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>networkingV1beta1</span>            <span class=o>*</span><span class=nx>networkingv1beta1</span><span class=p>.</span><span class=nx>NetworkingV1beta1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>nodeV1</span>                       <span class=o>*</span><span class=nx>nodev1</span><span class=p>.</span><span class=nx>NodeV1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>nodeV1alpha1</span>                 <span class=o>*</span><span class=nx>nodev1alpha1</span><span class=p>.</span><span class=nx>NodeV1alpha1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>nodeV1beta1</span>                  <span class=o>*</span><span class=nx>nodev1beta1</span><span class=p>.</span><span class=nx>NodeV1beta1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>policyV1</span>                     <span class=o>*</span><span class=nx>policyv1</span><span class=p>.</span><span class=nx>PolicyV1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>policyV1beta1</span>                <span class=o>*</span><span class=nx>policyv1beta1</span><span class=p>.</span><span class=nx>PolicyV1beta1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>rbacV1</span>                       <span class=o>*</span><span class=nx>rbacv1</span><span class=p>.</span><span class=nx>RbacV1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>rbacV1beta1</span>                  <span class=o>*</span><span class=nx>rbacv1beta1</span><span class=p>.</span><span class=nx>RbacV1beta1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>rbacV1alpha1</span>                 <span class=o>*</span><span class=nx>rbacv1alpha1</span><span class=p>.</span><span class=nx>RbacV1alpha1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>schedulingV1alpha1</span>           <span class=o>*</span><span class=nx>schedulingv1alpha1</span><span class=p>.</span><span class=nx>SchedulingV1alpha1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>schedulingV1beta1</span>            <span class=o>*</span><span class=nx>schedulingv1beta1</span><span class=p>.</span><span class=nx>SchedulingV1beta1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>schedulingV1</span>                 <span class=o>*</span><span class=nx>schedulingv1</span><span class=p>.</span><span class=nx>SchedulingV1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>storageV1beta1</span>               <span class=o>*</span><span class=nx>storagev1beta1</span><span class=p>.</span><span class=nx>StorageV1beta1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>storageV1</span>                    <span class=o>*</span><span class=nx>storagev1</span><span class=p>.</span><span class=nx>StorageV1Client</span>
</span></span><span class=line><span class=cl>	<span class=nx>storageV1alpha1</span>              <span class=o>*</span><span class=nx>storagev1alpha1</span><span class=p>.</span><span class=nx>StorageV1alpha1Client</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=clientsetinterface><code>clientset.Interface</code><a hidden class=anchor aria-hidden=true href=#clientsetinterface>#</a></h4><p><code>clientset</code>实现了以下的interface，可以通过以下的方法获得具体的client，例如:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>pods</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>clientset</span><span class=p>.</span><span class=nf>CoreV1</span><span class=p>().</span><span class=nf>Pods</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>).</span><span class=nf>List</span><span class=p>(</span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Interface</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nf>Discovery</span><span class=p>()</span> <span class=nx>discovery</span><span class=p>.</span><span class=nx>DiscoveryInterface</span>
</span></span><span class=line><span class=cl>	<span class=nf>AdmissionregistrationV1</span><span class=p>()</span> <span class=nx>admissionregistrationv1</span><span class=p>.</span><span class=nx>AdmissionregistrationV1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>AdmissionregistrationV1beta1</span><span class=p>()</span> <span class=nx>admissionregistrationv1beta1</span><span class=p>.</span><span class=nx>AdmissionregistrationV1beta1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>InternalV1alpha1</span><span class=p>()</span> <span class=nx>internalv1alpha1</span><span class=p>.</span><span class=nx>InternalV1alpha1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>AppsV1</span><span class=p>()</span> <span class=nx>appsv1</span><span class=p>.</span><span class=nx>AppsV1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>AppsV1beta1</span><span class=p>()</span> <span class=nx>appsv1beta1</span><span class=p>.</span><span class=nx>AppsV1beta1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>AppsV1beta2</span><span class=p>()</span> <span class=nx>appsv1beta2</span><span class=p>.</span><span class=nx>AppsV1beta2Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>AuthenticationV1</span><span class=p>()</span> <span class=nx>authenticationv1</span><span class=p>.</span><span class=nx>AuthenticationV1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>AuthenticationV1beta1</span><span class=p>()</span> <span class=nx>authenticationv1beta1</span><span class=p>.</span><span class=nx>AuthenticationV1beta1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>AuthorizationV1</span><span class=p>()</span> <span class=nx>authorizationv1</span><span class=p>.</span><span class=nx>AuthorizationV1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>AuthorizationV1beta1</span><span class=p>()</span> <span class=nx>authorizationv1beta1</span><span class=p>.</span><span class=nx>AuthorizationV1beta1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>AutoscalingV1</span><span class=p>()</span> <span class=nx>autoscalingv1</span><span class=p>.</span><span class=nx>AutoscalingV1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>AutoscalingV2beta1</span><span class=p>()</span> <span class=nx>autoscalingv2beta1</span><span class=p>.</span><span class=nx>AutoscalingV2beta1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>AutoscalingV2beta2</span><span class=p>()</span> <span class=nx>autoscalingv2beta2</span><span class=p>.</span><span class=nx>AutoscalingV2beta2Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>BatchV1</span><span class=p>()</span> <span class=nx>batchv1</span><span class=p>.</span><span class=nx>BatchV1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>BatchV1beta1</span><span class=p>()</span> <span class=nx>batchv1beta1</span><span class=p>.</span><span class=nx>BatchV1beta1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>CertificatesV1</span><span class=p>()</span> <span class=nx>certificatesv1</span><span class=p>.</span><span class=nx>CertificatesV1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>CertificatesV1beta1</span><span class=p>()</span> <span class=nx>certificatesv1beta1</span><span class=p>.</span><span class=nx>CertificatesV1beta1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>CoordinationV1beta1</span><span class=p>()</span> <span class=nx>coordinationv1beta1</span><span class=p>.</span><span class=nx>CoordinationV1beta1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>CoordinationV1</span><span class=p>()</span> <span class=nx>coordinationv1</span><span class=p>.</span><span class=nx>CoordinationV1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>CoreV1</span><span class=p>()</span> <span class=nx>corev1</span><span class=p>.</span><span class=nx>CoreV1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>DiscoveryV1</span><span class=p>()</span> <span class=nx>discoveryv1</span><span class=p>.</span><span class=nx>DiscoveryV1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>DiscoveryV1beta1</span><span class=p>()</span> <span class=nx>discoveryv1beta1</span><span class=p>.</span><span class=nx>DiscoveryV1beta1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>EventsV1</span><span class=p>()</span> <span class=nx>eventsv1</span><span class=p>.</span><span class=nx>EventsV1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>EventsV1beta1</span><span class=p>()</span> <span class=nx>eventsv1beta1</span><span class=p>.</span><span class=nx>EventsV1beta1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>ExtensionsV1beta1</span><span class=p>()</span> <span class=nx>extensionsv1beta1</span><span class=p>.</span><span class=nx>ExtensionsV1beta1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>FlowcontrolV1alpha1</span><span class=p>()</span> <span class=nx>flowcontrolv1alpha1</span><span class=p>.</span><span class=nx>FlowcontrolV1alpha1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>FlowcontrolV1beta1</span><span class=p>()</span> <span class=nx>flowcontrolv1beta1</span><span class=p>.</span><span class=nx>FlowcontrolV1beta1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>NetworkingV1</span><span class=p>()</span> <span class=nx>networkingv1</span><span class=p>.</span><span class=nx>NetworkingV1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>NetworkingV1beta1</span><span class=p>()</span> <span class=nx>networkingv1beta1</span><span class=p>.</span><span class=nx>NetworkingV1beta1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>NodeV1</span><span class=p>()</span> <span class=nx>nodev1</span><span class=p>.</span><span class=nx>NodeV1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>NodeV1alpha1</span><span class=p>()</span> <span class=nx>nodev1alpha1</span><span class=p>.</span><span class=nx>NodeV1alpha1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>NodeV1beta1</span><span class=p>()</span> <span class=nx>nodev1beta1</span><span class=p>.</span><span class=nx>NodeV1beta1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>PolicyV1</span><span class=p>()</span> <span class=nx>policyv1</span><span class=p>.</span><span class=nx>PolicyV1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>PolicyV1beta1</span><span class=p>()</span> <span class=nx>policyv1beta1</span><span class=p>.</span><span class=nx>PolicyV1beta1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>RbacV1</span><span class=p>()</span> <span class=nx>rbacv1</span><span class=p>.</span><span class=nx>RbacV1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>RbacV1beta1</span><span class=p>()</span> <span class=nx>rbacv1beta1</span><span class=p>.</span><span class=nx>RbacV1beta1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>RbacV1alpha1</span><span class=p>()</span> <span class=nx>rbacv1alpha1</span><span class=p>.</span><span class=nx>RbacV1alpha1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>SchedulingV1alpha1</span><span class=p>()</span> <span class=nx>schedulingv1alpha1</span><span class=p>.</span><span class=nx>SchedulingV1alpha1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>SchedulingV1beta1</span><span class=p>()</span> <span class=nx>schedulingv1beta1</span><span class=p>.</span><span class=nx>SchedulingV1beta1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>SchedulingV1</span><span class=p>()</span> <span class=nx>schedulingv1</span><span class=p>.</span><span class=nx>SchedulingV1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>StorageV1beta1</span><span class=p>()</span> <span class=nx>storagev1beta1</span><span class=p>.</span><span class=nx>StorageV1beta1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>StorageV1</span><span class=p>()</span> <span class=nx>storagev1</span><span class=p>.</span><span class=nx>StorageV1Interface</span>
</span></span><span class=line><span class=cl>	<span class=nf>StorageV1alpha1</span><span class=p>()</span> <span class=nx>storagev1alpha1</span><span class=p>.</span><span class=nx>StorageV1alpha1Interface</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=corev1client><code>CoreV1Client</code><a hidden class=anchor aria-hidden=true href=#corev1client>#</a></h3><p>常用的<code>CoreV1Client</code>为例子分析</p><h4 id=corev1newforconfig><code>corev1.NewForConfig</code><a hidden class=anchor aria-hidden=true href=#corev1newforconfig>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// NewForConfig creates a new CoreV1Client for the given config.</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewForConfig</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>rest</span><span class=p>.</span><span class=nx>Config</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>CoreV1Client</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>config</span> <span class=o>:=</span> <span class=o>*</span><span class=nx>c</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nf>setConfigDefaults</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>config</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>client</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>rest</span><span class=p>.</span><span class=nf>RESTClientFor</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>config</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=o>&amp;</span><span class=nx>CoreV1Client</span><span class=p>{</span><span class=nx>client</span><span class=p>},</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>通过传入配置信息<code>rest.Config</code>来实例化对象，其本质是调用了<code>rest.RESTClientFor(&amp;Config)</code>方法创建了<code>RESTClient</code>的对象，即<code>CoreV1Client</code>的本质就是一个<code>RESTClient</code>对象。</p><h4 id=corev1client结构体定义><code>CoreV1Client</code>结构体定义<a hidden class=anchor aria-hidden=true href=#corev1client结构体定义>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// CoreV1Client is used to interact with features provided by the  group.</span>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>CoreV1Client</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>restClient</span> <span class=nx>rest</span><span class=p>.</span><span class=nx>Interface</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>CoreV1Client</code>实现了<code>CoreV1Interface</code>接口，从而对k8s的资源对象进行增删改查的操作。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>//CoreV1Client的方法</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>CoreV1Client</span><span class=p>)</span> <span class=nf>ComponentStatuses</span><span class=p>()</span> <span class=nx>ComponentStatusInterface</span> <span class=p>{</span><span class=o>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>//ConfigMaps</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>CoreV1Client</span><span class=p>)</span> <span class=nf>ConfigMaps</span><span class=p>(</span><span class=nx>namespace</span> <span class=kt>string</span><span class=p>)</span> <span class=nx>ConfigMapInterface</span> <span class=p>{</span><span class=o>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>//Endpoints</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>CoreV1Client</span><span class=p>)</span> <span class=nf>Endpoints</span><span class=p>(</span><span class=nx>namespace</span> <span class=kt>string</span><span class=p>)</span> <span class=nx>EndpointsInterface</span> <span class=p>{</span><span class=o>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>CoreV1Client</span><span class=p>)</span> <span class=nf>Events</span><span class=p>(</span><span class=nx>namespace</span> <span class=kt>string</span><span class=p>)</span> <span class=nx>EventInterface</span> <span class=p>{</span><span class=o>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>CoreV1Client</span><span class=p>)</span> <span class=nf>LimitRanges</span><span class=p>(</span><span class=nx>namespace</span> <span class=kt>string</span><span class=p>)</span> <span class=nx>LimitRangeInterface</span> <span class=p>{</span><span class=o>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>//Namespaces</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>CoreV1Client</span><span class=p>)</span> <span class=nf>Namespaces</span><span class=p>()</span> <span class=nx>NamespaceInterface</span> <span class=p>{</span><span class=o>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>//Nodes</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>CoreV1Client</span><span class=p>)</span> <span class=nf>Nodes</span><span class=p>()</span> <span class=nx>NodeInterface</span> <span class=p>{</span><span class=o>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>CoreV1Client</span><span class=p>)</span> <span class=nf>PersistentVolumes</span><span class=p>()</span> <span class=nx>PersistentVolumeInterface</span> <span class=p>{</span><span class=o>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>CoreV1Client</span><span class=p>)</span> <span class=nf>PersistentVolumeClaims</span><span class=p>(</span><span class=nx>namespace</span> <span class=kt>string</span><span class=p>)</span> <span class=nx>PersistentVolumeClaimInterface</span> <span class=p>{</span><span class=o>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>//Pods</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>CoreV1Client</span><span class=p>)</span> <span class=nf>Pods</span><span class=p>(</span><span class=nx>namespace</span> <span class=kt>string</span><span class=p>)</span> <span class=nx>PodInterface</span> <span class=p>{</span><span class=o>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>CoreV1Client</span><span class=p>)</span> <span class=nf>PodTemplates</span><span class=p>(</span><span class=nx>namespace</span> <span class=kt>string</span><span class=p>)</span> <span class=nx>PodTemplateInterface</span> <span class=p>{</span><span class=o>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>//ReplicationControllers</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>CoreV1Client</span><span class=p>)</span> <span class=nf>ReplicationControllers</span><span class=p>(</span><span class=nx>namespace</span> <span class=kt>string</span><span class=p>)</span> <span class=nx>ReplicationControllerInterface</span> <span class=p>{</span><span class=o>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>CoreV1Client</span><span class=p>)</span> <span class=nf>ResourceQuotas</span><span class=p>(</span><span class=nx>namespace</span> <span class=kt>string</span><span class=p>)</span> <span class=nx>ResourceQuotaInterface</span> <span class=p>{</span><span class=o>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>CoreV1Client</span><span class=p>)</span> <span class=nf>Secrets</span><span class=p>(</span><span class=nx>namespace</span> <span class=kt>string</span><span class=p>)</span> <span class=nx>SecretInterface</span> <span class=p>{</span><span class=o>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>//Services</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>CoreV1Client</span><span class=p>)</span> <span class=nf>Services</span><span class=p>(</span><span class=nx>namespace</span> <span class=kt>string</span><span class=p>)</span> <span class=nx>ServiceInterface</span> <span class=p>{</span><span class=o>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>CoreV1Client</span><span class=p>)</span> <span class=nf>ServiceAccounts</span><span class=p>(</span><span class=nx>namespace</span> <span class=kt>string</span><span class=p>)</span> <span class=nx>ServiceAccountInterface</span> <span class=p>{</span><span class=o>...</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=corev1interface><code>CoreV1Interface</code><a hidden class=anchor aria-hidden=true href=#corev1interface>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>CoreV1Interface</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nf>RESTClient</span><span class=p>()</span> <span class=nx>rest</span><span class=p>.</span><span class=nx>Interface</span>
</span></span><span class=line><span class=cl>	<span class=nx>ComponentStatusesGetter</span>
</span></span><span class=line><span class=cl>	<span class=nx>ConfigMapsGetter</span>
</span></span><span class=line><span class=cl>	<span class=nx>EndpointsGetter</span>
</span></span><span class=line><span class=cl>	<span class=nx>EventsGetter</span>
</span></span><span class=line><span class=cl>	<span class=nx>LimitRangesGetter</span>
</span></span><span class=line><span class=cl>	<span class=nx>NamespacesGetter</span>
</span></span><span class=line><span class=cl>	<span class=nx>NodesGetter</span>
</span></span><span class=line><span class=cl>	<span class=nx>PersistentVolumesGetter</span>
</span></span><span class=line><span class=cl>	<span class=nx>PersistentVolumeClaimsGetter</span>
</span></span><span class=line><span class=cl>	<span class=nx>PodsGetter</span>
</span></span><span class=line><span class=cl>	<span class=nx>PodTemplatesGetter</span>
</span></span><span class=line><span class=cl>	<span class=nx>ReplicationControllersGetter</span>
</span></span><span class=line><span class=cl>	<span class=nx>ResourceQuotasGetter</span>
</span></span><span class=line><span class=cl>	<span class=nx>SecretsGetter</span>
</span></span><span class=line><span class=cl>	<span class=nx>ServicesGetter</span>
</span></span><span class=line><span class=cl>	<span class=nx>ServiceAccountsGetter</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>CoreV1Interface</code>中包含了各种k8s对象的调用接口，例如<code>PodsGetter</code>是对k8s中pod对象增删改查的接口。<code>ServicesGetter</code>是对service对象的操作的接口。</p><h4 id=podsgetter接口举例探索><code>PodsGetter</code>接口举例探索<a hidden class=anchor aria-hidden=true href=#podsgetter接口举例探索>#</a></h4><p>可以以<code>PodsGetter</code>接口为例来研究一下<code>CoreV1Client</code>对pod对象的增删改查调用。</p><p>示例中的代码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>pods</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>clientset</span><span class=p>.</span><span class=nf>CoreV1</span><span class=p>().</span><span class=nf>Pods</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>).</span><span class=nf>List</span><span class=p>(</span><span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>{})</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>CoreV1().Pods()</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// core_client.go</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>CoreV1Client</span><span class=p>)</span> <span class=nf>Pods</span><span class=p>(</span><span class=nx>namespace</span> <span class=kt>string</span><span class=p>)</span> <span class=nx>PodInterface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nf>newPods</span><span class=p>(</span><span class=nx>c</span><span class=p>,</span> <span class=nx>namespace</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// pod.go</span>
</span></span><span class=line><span class=cl><span class=c1>// newPods returns a Pods</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>newPods</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>CoreV1Client</span><span class=p>,</span> <span class=nx>namespace</span> <span class=kt>string</span><span class=p>)</span> <span class=o>*</span><span class=nx>pods</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=o>&amp;</span><span class=nx>pods</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>client</span><span class=p>:</span> <span class=nx>c</span><span class=p>.</span><span class=nf>RESTClient</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>		<span class=nx>ns</span><span class=p>:</span>     <span class=nx>namespace</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>CoreV1().Pods()</code>方法实际上调用了<code>newPods()</code>方法，创建了一个pod对象，该对象继承了<code>rest.Interface</code>接口，即最终的实现本质是<code>RESTClient</code>的HTTP调用。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// pods implements PodInterface</span>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>pods</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>client</span> <span class=nx>rest</span><span class=p>.</span><span class=nx>Interface</span>
</span></span><span class=line><span class=cl>	<span class=nx>ns</span>     <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>pods</code>对象实现了<code>PodInterface</code>接口：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// PodInterface has methods to work with Pod resources.</span>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>PodInterface</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nf>Create</span><span class=p>(</span><span class=o>*</span><span class=nx>v1</span><span class=p>.</span><span class=nx>Pod</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>v1</span><span class=p>.</span><span class=nx>Pod</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nf>Update</span><span class=p>(</span><span class=o>*</span><span class=nx>v1</span><span class=p>.</span><span class=nx>Pod</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>v1</span><span class=p>.</span><span class=nx>Pod</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nf>UpdateStatus</span><span class=p>(</span><span class=o>*</span><span class=nx>v1</span><span class=p>.</span><span class=nx>Pod</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>v1</span><span class=p>.</span><span class=nx>Pod</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nf>Delete</span><span class=p>(</span><span class=nx>name</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>options</span> <span class=o>*</span><span class=nx>metav1</span><span class=p>.</span><span class=nx>DeleteOptions</span><span class=p>)</span> <span class=kt>error</span>
</span></span><span class=line><span class=cl>	<span class=nf>DeleteCollection</span><span class=p>(</span><span class=nx>options</span> <span class=o>*</span><span class=nx>metav1</span><span class=p>.</span><span class=nx>DeleteOptions</span><span class=p>,</span> <span class=nx>listOptions</span> <span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>)</span> <span class=kt>error</span>
</span></span><span class=line><span class=cl>	<span class=nf>Get</span><span class=p>(</span><span class=nx>name</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>options</span> <span class=nx>metav1</span><span class=p>.</span><span class=nx>GetOptions</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>v1</span><span class=p>.</span><span class=nx>Pod</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nf>List</span><span class=p>(</span><span class=nx>opts</span> <span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>v1</span><span class=p>.</span><span class=nx>PodList</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nf>Watch</span><span class=p>(</span><span class=nx>opts</span> <span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>)</span> <span class=p>(</span><span class=nx>watch</span><span class=p>.</span><span class=nx>Interface</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nf>Patch</span><span class=p>(</span><span class=nx>name</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>pt</span> <span class=nx>types</span><span class=p>.</span><span class=nx>PatchType</span><span class=p>,</span> <span class=nx>data</span> <span class=p>[]</span><span class=kt>byte</span><span class=p>,</span> <span class=nx>subresources</span> <span class=o>...</span><span class=kt>string</span><span class=p>)</span> <span class=p>(</span><span class=nx>result</span> <span class=o>*</span><span class=nx>v1</span><span class=p>.</span><span class=nx>Pod</span><span class=p>,</span> <span class=nx>err</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nf>GetEphemeralContainers</span><span class=p>(</span><span class=nx>podName</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>options</span> <span class=nx>metav1</span><span class=p>.</span><span class=nx>GetOptions</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>v1</span><span class=p>.</span><span class=nx>EphemeralContainers</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nf>UpdateEphemeralContainers</span><span class=p>(</span><span class=nx>podName</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>ephemeralContainers</span> <span class=o>*</span><span class=nx>v1</span><span class=p>.</span><span class=nx>EphemeralContainers</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>v1</span><span class=p>.</span><span class=nx>EphemeralContainers</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>PodExpansion</span>
</span></span></code></pre></td></tr></table></div></div><p>这个interface定义了<code>pods</code>对象的增删改查等方法。</p><p><code>PodsGetter</code> 继承了<code>PodInterface</code>的接口:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// PodsGetter has a method to return a PodInterface.</span>
</span></span><span class=line><span class=cl><span class=c1>// A group&#39;s client should implement this interface.</span>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>PodsGetter</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nf>Pods</span><span class=p>(</span><span class=nx>namespace</span> <span class=kt>string</span><span class=p>)</span> <span class=nx>PodInterface</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>Pods().List()</code>方法通过<code>RESTClient</code>的HTTP调用来实现对k8s的pod资源的获取:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// List takes label and field selectors, and returns the list of Pods that match those selectors.</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>pods</span><span class=p>)</span> <span class=nf>List</span><span class=p>(</span><span class=nx>opts</span> <span class=nx>metav1</span><span class=p>.</span><span class=nx>ListOptions</span><span class=p>)</span> <span class=p>(</span><span class=nx>result</span> <span class=o>*</span><span class=nx>v1</span><span class=p>.</span><span class=nx>PodList</span><span class=p>,</span> <span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>timeout</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Duration</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>opts</span><span class=p>.</span><span class=nx>TimeoutSeconds</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>timeout</span> <span class=p>=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>Duration</span><span class=p>(</span><span class=o>*</span><span class=nx>opts</span><span class=p>.</span><span class=nx>TimeoutSeconds</span><span class=p>)</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>result</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>v1</span><span class=p>.</span><span class=nx>PodList</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=p>=</span> <span class=nx>c</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nf>Get</span><span class=p>().</span>
</span></span><span class=line><span class=cl>		<span class=nf>Namespace</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nx>ns</span><span class=p>).</span>
</span></span><span class=line><span class=cl>		<span class=nf>Resource</span><span class=p>(</span><span class=s>&#34;pods&#34;</span><span class=p>).</span>
</span></span><span class=line><span class=cl>		<span class=nf>VersionedParams</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>opts</span><span class=p>,</span> <span class=nx>scheme</span><span class=p>.</span><span class=nx>ParameterCodec</span><span class=p>).</span>
</span></span><span class=line><span class=cl>		<span class=nf>Timeout</span><span class=p>(</span><span class=nx>timeout</span><span class=p>).</span>
</span></span><span class=line><span class=cl>		<span class=nf>Do</span><span class=p>().</span>
</span></span><span class=line><span class=cl>		<span class=nf>Into</span><span class=p>(</span><span class=nx>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>以上分析了<code>clientset.CoreV1().Pods("").List(metav1.ListOptions{})</code>对pod资源获取的过程，最终是调用<code>RESTClient</code>的方法实现。</p><h3 id=restclient><code>RESTClient</code><a hidden class=anchor aria-hidden=true href=#restclient>#</a></h3><p>待补充</p><h3 id=总结>总结<a hidden class=anchor aria-hidden=true href=#总结>#</a></h3><p><code>client-go</code>对K8s资源对象的调用，需要先获取k8s的配置信息，也就是<code>$HOME/.kube/config</code>。</p><p>调用顺序如下：</p><blockquote><p><code>kubeconfig</code> -> <code>rest.config</code> -> <code>clientset</code> -> 具体的client(CoreV1Client) -> 具体的资源对象(如pod) -> <code>RESTClient</code> -> <code>http.Client</code> -> HTTP 请求的发送和响应</p></blockquote><p>常用的client有<code>CoreV1Client</code>、<code>AppsV1betaClient</code>、<code>ExtensionsV1beta1Client</code>等。</p><h2 id=operator-sdk><code>Operator SDK</code><a hidden class=anchor aria-hidden=true href=#operator-sdk>#</a></h2></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://pillumina.github.io/posts/llmtheory/latex-test/><span class=title>« Prev</span><br><span>LaTeX Test Page</span>
</a><a class=next href=https://pillumina.github.io/posts/programming/cloud-computing/k8s-config-update/><span class=title>Next »</span><br><span>Kubernetes ConfigMap 热更新</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Kubernetes Operator Development History on x" href="https://x.com/intent/tweet/?text=Kubernetes%20Operator%20Development%20History&amp;url=https%3a%2f%2fpillumina.github.io%2fposts%2fprogramming%2fcloud-computing%2fk8s-operator-dev%2f&amp;hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Kubernetes Operator Development History on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fpillumina.github.io%2fposts%2fprogramming%2fcloud-computing%2fk8s-operator-dev%2f&amp;title=Kubernetes%20Operator%20Development%20History&amp;summary=Kubernetes%20Operator%20Development%20History&amp;source=https%3a%2f%2fpillumina.github.io%2fposts%2fprogramming%2fcloud-computing%2fk8s-operator-dev%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Kubernetes Operator Development History on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fpillumina.github.io%2fposts%2fprogramming%2fcloud-computing%2fk8s-operator-dev%2f&title=Kubernetes%20Operator%20Development%20History"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Kubernetes Operator Development History on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fpillumina.github.io%2fposts%2fprogramming%2fcloud-computing%2fk8s-operator-dev%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Kubernetes Operator Development History on whatsapp" href="https://api.whatsapp.com/send?text=Kubernetes%20Operator%20Development%20History%20-%20https%3a%2f%2fpillumina.github.io%2fposts%2fprogramming%2fcloud-computing%2fk8s-operator-dev%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Kubernetes Operator Development History on telegram" href="https://telegram.me/share/url?text=Kubernetes%20Operator%20Development%20History&amp;url=https%3a%2f%2fpillumina.github.io%2fposts%2fprogramming%2fcloud-computing%2fk8s-operator-dev%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Kubernetes Operator Development History on ycombinator" href="https://news.ycombinator.com/submitlink?t=Kubernetes%20Operator%20Development%20History&u=https%3a%2f%2fpillumina.github.io%2fposts%2fprogramming%2fcloud-computing%2fk8s-operator-dev%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://pillumina.github.io/>CctoctoFX</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg></a><div class=reading-progress-bar></div><script src=https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){const t=document.querySelector(".reading-progress-bar");if(!t)return;const n=document.querySelector(".post-single");if(!n)return;function s(){const e=n.getBoundingClientRect(),s=e.height,o=window.innerHeight,i=window.scrollY||window.pageYOffset,a=i/(s-o)*100;t.style.width=`${Math.min(100,Math.max(0,a))}%`}let e=!1;window.addEventListener("scroll",function(){e||(window.requestAnimationFrame(function(){s(),e=!1}),e=!0)}),s()}),document.addEventListener("DOMContentLoaded",function(){mediumZoom("article img:not(.nozoom)",{margin:24,background:"var(--theme)",scrollOffset:0})})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>