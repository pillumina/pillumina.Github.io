<!doctype html><html lang=en dir=auto><head><meta name=generator content="Hugo 0.148.2"><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>CctoctoFX</title><meta name=description content><meta name=author content="Me"><link rel=canonical href=https://pillumina.github.io/><link crossorigin=anonymous href=/assets/css/stylesheet.9d388901283682bb45dd422fcaa0d0a2054a3c8ff47c9cc6b2baab15508b1b90.css integrity="sha256-nTiJASg2grtF3UIvyqDQogVKPI/0fJzGsrqrFVCLG5A=" rel="preload stylesheet" as=style><link rel=icon href=https://pillumina.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://pillumina.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://pillumina.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://pillumina.github.io/apple-touch-icon.png><link rel=mask-icon href=https://pillumina.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://pillumina.github.io/index.xml><link rel=alternate type=application/json href=https://pillumina.github.io/index.json><link rel=alternate hreflang=en href=https://pillumina.github.io/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js crossorigin=anonymous></script><script>(function(){function t(){return document.querySelector(".post-content")||document.querySelector(".post-single")||document.body}function n(e){return/\$\$[\s\S]+?\$\$|\\\(|\\\)|\\\[|\\\]/.test(e)}function s(e){if(window.__mathjaxLoaded)return;window.__mathjaxLoaded=!0,window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre","code","tt"],ignoreHtmlClass:"no-math"}};var t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js",t.defer=!0,t.onload=function(){window.MathJax&&window.MathJax.typesetPromise&&window.MathJax.typesetPromise([e]).catch(function(e){console.warn("MathJax typeset error",e)})},document.head.appendChild(t)}function e(){try{if(typeof renderMathInElement=="function"){const e=t();renderMathInElement(e,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\[",right:"\\]",display:!0},{left:"\\(",right:"\\)",display:!1}],throwOnError:!1,strict:!1,trust:!0,ignoredTags:["script","noscript","style","textarea","pre","code","tt"],ignoredClasses:["no-math"],macros:{"\\boldsymbol":"\\mathbf{#1}","\\bm":"\\mathbf{#1}"}}),setTimeout(function(){n(e.innerHTML)&&s(e)},200)}}catch(e){console.warn("KaTeX render error:",e)}}document.addEventListener("DOMContentLoaded",function(){e(),setTimeout(e,200)}),window.addEventListener("load",function(){setTimeout(e,0)})})()</script><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script><script>const config={startOnLoad:!0,theme:"neutral",themeVariables:{lineColor:"#0f0f0f"},flowchart:{useMaxWidth:!1,htmlLabels:!0}};mermaid.initialize(config),window.onload=()=>{window.mermaid.init(0[0],document.querySelectorAll(".language-mermaid"))}</script><link rel=stylesheet href=/css/custom.min.bda7229c4269a242639e058fb11a4782f02f8d77071ba16609befee67cc41c49.css integrity="sha256-vacinEJpokJjngWPsRpHgvAvjXcHG6FmCb7+5nzEHEk="><script>document.addEventListener("DOMContentLoaded",function(){const t=document.querySelectorAll("h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]"),n=document.querySelectorAll(".toc a");if(t.length===0||n.length===0)return;const s={};t.forEach(e=>{s[e.id]=e.offsetTop});function i(){const t=window.scrollY+100;let e="";for(const[n,o]of Object.entries(s))if(t>=o)e=n;else break;return e}function o(){const e=i();if(n.forEach(e=>{e.classList.remove("active")}),e){const t=document.querySelector(`.toc a[href="#${e}"]`);t&&t.classList.add("active")}}let e=!1;window.addEventListener("scroll",function(){e||(window.requestAnimationFrame(function(){o(),e=!1}),e=!0)}),o()})</script><meta property="og:url" content="https://pillumina.github.io/"><meta property="og:site_name" content="CctoctoFX"><meta property="og:title" content="CctoctoFX"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://pillumina.github.io/imgs/icon_head.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://pillumina.github.io/imgs/icon_head.png"><meta name=twitter:title content="CctoctoFX"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"CctoctoFX","url":"https://pillumina.github.io/","description":"","logo":"https://pillumina.github.io/favicon.ico","sameAs":["derios1230@gmail.com","https://github.com/pillumina","https://gitee.com/pillumina"]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://pillumina.github.io/ accesskey=h title="CctoctoFX (Alt + H)"><img src=https://pillumina.github.io/apple-touch-icon.png alt aria-label=logo height=30>CctoctoFX</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://pillumina.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://pillumina.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://pillumina.github.io/posts/aiinfra/ title="AI Infra"><span>AI Infra</span></a></li><li><a href=https://pillumina.github.io/posts/llmtheory/ title=Thoery><span>Thoery</span></a></li><li><a href=https://pillumina.github.io/posts/programming/ title=Programming><span>Programming</span></a></li><li><a href=https://pillumina.github.io/social/ title=Social><span>Social</span></a></li><li><a href=https://pillumina.github.io/open_courses/ title=Study><span>Study</span></a></li></ul></nav></header><main class=main><article class="first-entry home-info"><header class=entry-header><h1>CctoctoFX (Yuxiao Huang)</h1></header><div class=entry-content><div class=row><div class=profile-text><p>Hey there! Iâ€™m a software engineer obsessed with untangling complex systems.<br>My playground includes:</p><ul><li><p>âš™ï¸ Software architecture (scaling the unscalable),</p></li><li><p>ğŸ§  LLM training/inference (squeezing speed from silicon),</p></li><li><p>ğŸ“ˆ Economic systems & ğŸŒ geopolitics (decoding money & power).</p></li><li><p>AI Infrastructure (AI Infra) & ML Systems (MLSys) are my battlefield: deep dives on scaling, optimization, and the guts of large models. Beyond the keyboard, I also share spicy takes on geopolitics when the mood strikes.</p></li><li><p>No fluff, just signal. Join the conversation!</p></li></ul></div><div class=profile-img><img draggable=false src=https://pillumina.github.io/imgs/icon_head.png alt=profile title=profile height=150 width=150></div></div></div></div></div><footer class=entry-footer><div class=social-icons><a href=derios1230@gmail.com target=_blank rel="noopener noreferrer me" title=Email><svg viewBox="0 0 24 21" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
</a><a href=https://github.com/pillumina target=_blank rel="noopener noreferrer me" title=Github><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=https://gitee.com/pillumina target=_blank rel="noopener noreferrer me" title=Gitea><svg viewBox="0 0 24 20" fill="currentColor"><path d="M4.209 4.603c-.247.0-.525.02-.84.088-.333.07-1.28.283-2.054 1.027C-.403 7.25.035 9.685.089 10.052c.065.446.263 1.687 1.21 2.768 1.749 2.141 5.513 2.092 5.513 2.092s.462 1.103 1.168 2.119c.955 1.263 1.936 2.248 2.89 2.367 2.406.0 7.212-.004 7.212-.004s.458.004 1.08-.394c.535-.324 1.013-.893 1.013-.893s.492-.527 1.18-1.73c.21-.37.385-.729.538-1.068.0.0 2.107-4.471 2.107-8.823-.042-1.318-.367-1.55-.443-1.627-.156-.156-.366-.153-.366-.153s-4.475.252-6.792.306c-.508.011-1.012.023-1.512.027v4.474l-.634-.301c0-1.39-.004-4.17-.004-4.17-1.107.016-3.405-.084-3.405-.084s-5.399-.27-5.987-.324c-.187-.011-.401-.032-.648-.032zm.354 1.832h.111s.271 2.269.6 3.597C5.549 11.147 6.22 13 6.22 13s-.996-.119-1.641-.348c-.99-.324-1.409-.714-1.409-.714s-.73-.511-1.096-1.52C1.444 8.73 2.021 7.7 2.021 7.7s.32-.859 1.47-1.145c.395-.106.863-.12 1.072-.12zm8.33 2.554c.26.003.509.127.509.127l.868.422-.529 1.075a.686.686.0 00-.614.359.685.685.0 00.072.756l-.939 1.924a.69.69.0 00-.66.527.687.687.0 00.347.763.686.686.0 00.867-.206.688.688.0 00-.069-.882l.916-1.874a.667.667.0 00.237-.02.657.657.0 00.271-.137 8.826 8.826.0 011.016.512.761.761.0 01.286.282c.073.21-.073.569-.073.569-.087.29-.702 1.55-.702 1.55a.692.692.0 00-.676.477.681.681.0 101.157-.252c.073-.141.141-.282.214-.431.19-.397.515-1.16.515-1.16.035-.066.218-.394.103-.814-.095-.435-.48-.638-.48-.638-.467-.301-1.116-.58-1.116-.58s0-.156-.042-.27a.688.688.0 00-.148-.241l.516-1.062 2.89 1.401s.48.218.583.619c.073.282-.019.534-.069.657-.24.587-2.1 4.317-2.1 4.317s-.232.554-.748.588a1.065 1.065.0 01-.393-.045l-.202-.08-4.31-2.1s-.417-.218-.49-.596c-.083-.31.104-.691.104-.691l2.073-4.272s.183-.37.466-.497a.855.855.0 01.35-.077z"/></svg></a></div></footer></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>[VeRL] DataProtoä»‹ç»</h2></header><div class=entry-content><p>Verl DataProto å®ç°åŸç†ä¸æ•°æ®æµåŠ¨åˆ†æ ç›®å½• 1. æ¦‚è¿° 2. DataProto æ ¸å¿ƒæ¶æ„ 3. HybridFlow è®¾è®¡ç†å¿µ 4. æ§åˆ¶æµä¸è®¡ç®—æµåˆ†ç¦» 5. æ•°æ®æµåŠ¨æœºåˆ¶ 6. Dispatch æ¨¡å¼è¯¦è§£ 7. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ 8. æ€»ç»“ 1. æ¦‚è¿° Verl æ˜¯ä¸€ä¸ªåŸºäº HybridFlow è®ºæ–‡çš„å¼€æºå¼ºåŒ–å­¦ä¹ è®­ç»ƒæ¡†æ¶ï¼Œä¸“é—¨ä¸ºå¤§è¯­è¨€æ¨¡å‹çš„åè®­ç»ƒä¼˜åŒ–è€Œè®¾è®¡ã€‚å…¶æ ¸å¿ƒåˆ›æ–°åœ¨äºå°†æ§åˆ¶æµå’Œè®¡ç®—æµåˆ†ç¦»ï¼Œé€šè¿‡ DataProto åè®®å®ç°é«˜æ•ˆçš„æ•°æ®äº¤æ¢ã€‚
2. DataProto æ ¸å¿ƒæ¶æ„ 2.1 æ•°æ®ç»“æ„è®¾è®¡ DataProto æ˜¯ verl æ¡†æ¶ä¸­ç”¨äºæ•°æ®äº¤æ¢çš„æ ¸å¿ƒåè®®ï¼Œæ‰€æœ‰åœ¨ Worker ä¹‹é—´æµè½¬çš„æ•°æ®ï¼Œéƒ½è¢«ç»Ÿä¸€å°è£…åœ¨ä¸€ä¸ªåä¸º DataProto çš„æ•°æ®ç»“æ„ä¸­ã€‚å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œæ›´æ‰¿è½½ç€ RLHF æµç¨‹ä¸­æ‰€æœ‰çš„ä¿¡æ¯æ¼”å˜, åŸºäº PyTorch çš„ TensorDict æ„å»ºï¼š
1 2 3 4 5 @dataclass class DataProto: batch: TensorDict = None # å¼ é‡æ•°æ®å®¹å™¨ non_tensor_batch: dict = field(default_factory=dict) # éå¼ é‡æ•°æ® meta_info: dict = field(default_factory=dict) # å…ƒä¿¡æ¯ æ ¸å¿ƒç‰¹æ€§ï¼š
ç»Ÿä¸€æ¥å£: æä¾›æ ‡å‡†åŒ–çš„æ•°æ®å®¹å™¨ï¼Œæ”¯æŒå¼ é‡å’Œéå¼ é‡æ•°æ® è®¾å¤‡ç®¡ç†: è‡ªåŠ¨å¤„ç† GPU/CPU è®¾å¤‡é—´çš„æ•°æ®ç§»åŠ¨ å†…å­˜ä¼˜åŒ–: æ”¯æŒåˆ†å—å¤„ç†å’Œå†…å­˜å¤ç”¨ åºåˆ—åŒ–: æ”¯æŒé«˜æ•ˆçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ– 2.2 æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 def check_consistency(self): """æ£€æŸ¥ DataProto çš„ä¸€è‡´æ€§""" if self.batch is not None: assert len(self.batch.batch_size) == 1, "åªæ”¯æŒ num_batch_dims=1" if self.non_tensor_batch is not None: for key, val in self.non_tensor_batch.items(): assert isinstance(val, np.ndarray) # æ£€æŸ¥æ‰¹æ¬¡å¤§å°ä¸€è‡´æ€§ if self.batch is not None and self.non_tensor_batch is not None: batch_size = self.batch.batch_size[0] for key, val in self.non_tensor_batch.items(): assert val.shape[0] == batch_size 3. HybridFlow è®¾è®¡ç†å¿µ 3.1 è®¾è®¡åŠ¨æœº ä¼ ç»Ÿ RL ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜ï¼š
...</p></div><footer class=entry-footer><span title='2025-08-25 11:30:12 +0800 CST'>August 25, 2025</span>&nbsp;Â·&nbsp;17 min&nbsp;Â·&nbsp;3513 words&nbsp;Â·&nbsp;Me</footer><a class=entry-link aria-label="post link to [VeRL] DataProtoä»‹ç»" href=https://pillumina.github.io/posts/aiinfra/10-verl-dataproto/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>[VeRL] AgentLoopæºç èµ°è¯»</h2></header><div class=entry-content><p>æœ€è¿‘ RL sys åœˆå­çš„å´é”¡æ–Œè€å¸ˆåœ¨ verl ä¸Šè®¾è®¡äº†å°† rollout ä¸ tool è°ƒç”¨è§£è€¦çš„ AgentLoopï¼Œå®ç°äº†è‡ªç”±çµæ´»çš„ mutli-turn RLã€‚åœ¨æ¯ä¸ª AgentLoop å†…éƒ¨ï¼Œrollout engine åªå¯¹å¤–æä¾›ä¸€ä¸ª token-in-token-out çš„æ¥å£ï¼Œè€Œ tool è°ƒç”¨åˆ™é€šè¿‡ ToolAgentLoop æ¥å®ç°ã€‚æˆ‘ä¸ªäººæ¯”è¾ƒå–œæ¬¢è¿™æ ·è§£è€¦çš„è®¾è®¡ï¼ŒåŒæ—¶ï¼ŒAgentLoop çš„ä»£ç ç»“æ„ä¹Ÿæ¯”è¾ƒæ¸…æ™°ã€‚æˆ‘ä¸ªäººå­¦ä¹ äº†ä¸€æ¬¡æ•´ä¸ªä»£ç åï¼Œè§‰ç€ AgentLoop çš„è®¾è®¡ç”šæ˜¯ä¸é”™ï¼Œä½†æ˜¯ ActorRolloutRefWorker çš„å†å²åŒ…è¢±è¿˜æ˜¯å¾ˆé‡ã€‚
æœ¬æ–‡ç®€å•åˆ†æäº† agent loop çš„æºç ï¼Œå¹¶ç»™å‡ºäº†ä¸€äº›è‡ªå·±çš„çœ‹æ³•ã€‚
å¦‚æœæˆ‘ä»¬æŠŠæ•´ä¸ª ActorRolloutRefWorker å½“åšä¸€ä¸ª sgl.Engine çš„è¯ï¼ŒAgentLoop é‡Œé¢åŒ…è£…çš„ä¸¤å±‚ AsyncSGLangServer å’Œ AsyncLLMServerManagerã€‚AsyncSGLangServer ç›¸å½“äºåœ¨ sgl.Engine ä¸ŠåŒ…è£…äº† fastapi æˆäº† serverï¼Œè€Œ AsyncLLMServerManager æ˜¯åœ¨ server ä¸ŠåŒ…äº†ä¸€å±‚ router åš load balanceï¼Œç›¸å½“äº sglang çš„ routerã€‚è¿™ä¸¤å±‚è®¾è®¡éƒ½æ˜¯åˆç†çš„ï¼Œä¸»è¦éº»çƒ¦çš„æ˜¯ ActorRolloutRefWorkerï¼Œå±‚å±‚è°ƒç”¨ï¼Œæœ€åä¸€å…±ç»è¿‡ 7 ä¸ª class æ‰è°ƒåˆ° sgl.Engineï¼Œæœ€è¿‘ verl å›¢é˜Ÿä¹Ÿåœ¨è‡´åŠ›äºå¯¹è¿™å— worker class çš„é‡æ„ï¼Œæ•¬è¯·æœŸå¾…ã€‚æœ€åï¼ŒAgentLoopManagerï¼ŒAgentLoopWorker å’Œ AgentLoop è¿™ä¸‰å±‚ï¼Œæˆ‘è§‰å¾— AgentLoopWorker å¯èƒ½æœªå¿…æœ‰å¿…è¦ï¼Œå…¶ä»–ä¸¤å±‚æŒºåˆç†çš„ã€‚
...</p></div><footer class=entry-footer><span title='2025-08-14 11:30:12 +0800 CST'>August 14, 2025</span>&nbsp;Â·&nbsp;15 min&nbsp;Â·&nbsp;3051 words&nbsp;Â·&nbsp;Me</footer><a class=entry-link aria-label="post link to [VeRL] AgentLoopæºç èµ°è¯»" href=https://pillumina.github.io/posts/aiinfra/09-verl-agentloop/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>[VeRL] å‚æ•°é€Ÿè§ˆ</h2></header><div class=entry-content><p>VeRLæ¡†æ¶çš„å‚æ•°ä¼—å¤šï¼ŒåŸºäºå½“å‰ï¼ˆ2025.8.5ï¼‰ä¸»çº¿åˆ†æ”¯æ•´ç†ï¼Œé™„å¸¦äº†ç›¸å…³çš„ç†è§£ï¼Œä¸€äº›æè¿°ä¸ä¸€å®šå®Œå…¨æ­£ç¡®ï¼Œä¾›å­¦ä¹ å‚è€ƒã€‚
Batch Size å‚æ•°åç§° è¯¦ç»†è§£é‡Š data.train_batch_size ä½œç”¨ï¼šå®šä¹‰äº†å•æ¬¡è®­ç»ƒå‘é€ç»™ Rollout Engine çš„æ ·æœ¬æ•°é‡ï¼Œä¹Ÿå³è¿™æ˜¯åœ¨æ¯ä¸ª PPO è¿­ä»£å¼€å§‹æ—¶ï¼Œä»è®­ç»ƒæ•°æ®é›†ä¸­é‡‡æ ·çš„æç¤º ï¼ˆPromptï¼‰æ•°é‡ã€‚
è¯¦ç»†è§£é‡Šï¼šè¿™ä¸ªå€¼æ˜¯ RL è®­ç»ƒä¸­çš„åŸºæœ¬æ ·æœ¬æ•°é‡ã€‚ä¾‹å¦‚ï¼Œè®¾ç½®ä¸º 1024 æ„å‘³ç€åœ¨ä¸€æ¬¡è¿­ä»£ä¸­ä¼šï¼š
1. ä»æ•°æ®é›†ä¸­éšæœºæŠ½å– 1024 ä¸ª promptã€‚
2. å°†è¿™ 1024 ä¸ª prompt å‘é€ç»™å½“å‰çš„ Rollout Engine ä¸­ï¼Œä»è€Œå¾—åˆ° 1024 ç»„å®Œæ•´çš„ trajectoriesï¼ˆprompt, responseï¼‰ã€‚
3. æ¥ä¸‹æ¥ï¼Œè¿™ 1024 ä¸ª trajectories è¿›è¡Œç»éªŒè®¡ç®—ï¼ˆmake experienceï¼‰ï¼Œåç»­ç”¨äº Actor å’Œ Critic æ¨¡å‹çš„æ›´æ–°ã€‚
å½±å“ä¸æƒè¡¡ï¼šå½±å“æ€»å…±è®­ç»ƒçš„æ ·æœ¬é‡ã€‚ data.val_batch_size ï¼ˆDeprecated) ä½œç”¨ï¼šåœ¨ Validation é˜¶æ®µä½¿ç”¨çš„æ‰¹æ¬¡å¤§å°ã€‚
è¯¦ç»†è§£é‡Šï¼šè¿™ä¸ train_batch_size ç±»ä¼¼ï¼Œä½†ä»…ç”¨äºè¯„ä¼°æ¨¡å‹æ€§èƒ½ï¼Œä¸å‚ä¸è®­ç»ƒã€‚å¦‚æœè®¾ç½®ä¸º nullï¼Œä¼šä½¿ç”¨éªŒè¯é›†çš„å¤§å°ä½œä¸ºé»˜è®¤å€¼ã€‚Note: å·²ç»deprecatedï¼Œæ¨èè®¾ç½®ä¸º nullã€‚æ­¤æ—¶ï¼Œæ•´ä¸ª validation dataset ä¸€æ¬¡æ€§å‘ç»™ SGLang enginesï¼Œè‡ªè¡Œè¿›è¡Œå†…å­˜ç®¡ç†ã€‚ actor_rollout_ref.actor.ppo_mini_batch_size critic.ppo_mini_batch_size ä½œç”¨ï¼šå®šä¹‰äº† PPO è®­ç»ƒæ›´æ–°ä¸­çš„ mini-batch å¤§å°ã€‚
è¯¦ç»†è§£é‡Šï¼šdata.train_batch_size æ”¶é›†åˆ°çš„å…¨éƒ¨ç»éªŒæ•°æ®å°†è¢«åˆ†å‰²æˆå¤šä¸ª mini-batchï¼Œæ¯å—çš„å¤§å°å°±æ˜¯ ppo_mini_batch_sizeã€‚æ¨¡å‹æ¯å¤„ç†å®Œä¸€ä¸ª mini-batchï¼Œæ‰ä¼šè¿›è¡Œä¸€æ¬¡å‚æ•°æ›´æ–°ã€‚
ä¾‹å¦‚ï¼Œå¦‚æœ train_batch_size = 1024ï¼Œppo_mini_batch_size = 256ï¼Œé‚£ä¹ˆåœ¨ä¸€ä¸ª PPO Epoch ä¸­ï¼Œæ¨¡å‹ä¼šè¿›è¡Œ 1024 / 256 = 4 æ¬¡å‚æ•°æ›´æ–°ã€‚
å½±å“ä¸æƒè¡¡ï¼šå¢å¤§ mini-batchï¼Œå•æ¬¡æ›´æ–°çš„æ¢¯åº¦æ›´ç¨³å®šï¼Œä½†æ›´æ–°é¢‘ç‡æ›´ä½ï¼Œæ›´æ–°æ¬¡æ•°å‡å°‘ã€‚ actor_rollout_ref.actor.ppo_micro_batch_size_per_gpu critic.ppo_micro_batch_size_per_gpu ä½œç”¨ï¼šå®šä¹‰äº†åœ¨å•ä¸ª GPU ä¸Šè¿›è¡Œä¸€æ¬¡ forward/backward çš„æ•°æ®å¤§å°ã€‚
è¯¦ç»†è§£é‡Šï¼šè¿™æ˜¯å®ç°æ¢¯åº¦ç´¯ç§¯çš„æ ¸å¿ƒå‚æ•°ã€‚mini-batch ä¼šè¢«å†æ¬¡åˆ‡åˆ†ä¸ºè‹¥å¹²ä¸ª micro-batchã€‚ä¾‹å¦‚ï¼Œåœ¨å•å¡ä¸Šï¼Œppo_mini_batch_size = 256ï¼Œppo_micro_batch_size_per_gpu = 32ï¼Œé‚£ä¹ˆæ¢¯åº¦ç´¯ç§¯çš„æ­¥æ•°å°±æ˜¯ 256 / 32 = 8ã€‚è¿™æ„å‘³ç€æ¨¡å‹ä¼šè¿è¡Œ 8 æ¬¡ forward å¾—åˆ° lossï¼Œç„¶å backward çš„åˆ° gradientã€‚æ¯æ¬¡å¤„ç† 32 ä¸ªæ ·æœ¬ï¼Œç›´åˆ°ç´¯ç§¯å®Œæ•´ä¸ª mini-batch è®¡ç®—å‡ºçš„æ¢¯åº¦ã€‚æ­¤æ—¶ï¼Œä½¿ç”¨ç´¯ç§¯çš„æ€»æ¢¯åº¦ï¼Œå¯¹æ¨¡å‹å‚æ•°è¿›è¡Œä¸€æ¬¡æ›´æ–°ï¼ˆoptimizer.step()ï¼‰ã€‚è¿™ä¸ªå€¼å¿…é¡»æ ¹æ®æ˜¾å­˜å¤§å°æ¥ä¸¥æ ¼è°ƒæ•´ï¼Œæ˜¯é˜²æ­¢ OOM çš„å…³é”®ã€‚
å½±å“ä¸æƒè¡¡ï¼šå¢å¤§æ­¤å€¼ï¼Œå‡å°‘äº†æ¢¯åº¦ç´¯ç§¯çš„æ¬¡æ•°ï¼Œå¯ä»¥æé«˜è®­ç»ƒçš„ååé‡ï¼Œå¢å¤§æ˜¾å­˜æ¶ˆè€—ã€‚ actor_rollout_ref.actor.ppo_micro_batch_size critic.ppo_micro_batch_sizeï¼ˆDeprecated) ä½œç”¨ï¼šå·²å¼ƒç”¨ï¼Œè¢« per_gpu ç‰ˆæœ¬å–ä»£ï¼Œå› ä¸ºå®ƒèƒ½æ›´å¥½åœ°é€‚åº”åˆ†å¸ƒå¼è®­ç»ƒç¯å¢ƒã€‚ Dynamic Batch Size å½“æ ·æœ¬é•¿åº¦å·®å¼‚å¾ˆå¤§æ—¶ï¼ŒæŒ‰æ ·æœ¬æ•°é‡åˆ’åˆ†æ‰¹æ¬¡å¯èƒ½å¯¼è‡´ä¸åŒæ‰¹æ¬¡çš„è®¡ç®—é‡æä¸å‡è¡¡ï¼Œè€ŒåŸºäº token æ€»æ•°æ¥æ§åˆ¶ batch size æ˜¯ä¸€ç§å¹³è¡¡æ¯ä¸ª batch è®­ç»ƒæ—¶é—´çš„æ–¹æ¡ˆã€‚
...</p></div><footer class=entry-footer><span title='2025-08-14 10:20:12 +0800 CST'>August 14, 2025</span>&nbsp;Â·&nbsp;6 min&nbsp;Â·&nbsp;1133 words&nbsp;Â·&nbsp;Me</footer><a class=entry-link aria-label="post link to [VeRL] å‚æ•°é€Ÿè§ˆ" href=https://pillumina.github.io/posts/aiinfra/05-verl-params/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>[SGLang] åç«¯ä»£ç é€Ÿè§ˆ</h2></header><div class=entry-content><p>æœ¬æ–‡æ¡£ä¸ºå¼€å‘è€…æä¾› SGLang åç«¯ä»£ç çš„ä»£ç æ¢³ç†ï¼ŒæŒ‰ç…§ä¸€ä¸ªè¯·æ±‚ä»è¾“å…¥åˆ°æœ€åè¾“å‡ºçš„é¡ºåºè¿›è¡Œè®²è§£ã€‚ä¸‹å›¾ç®€è¦ä»‹ç»äº†è¿™ä¸€æµç¨‹ï¼š
å…·ä½“è€Œè¨€ï¼Œè¯·æ±‚çš„å¤„ç†è¿‡ç¨‹å¦‚ä¸‹ï¼š
ç”¨æˆ·å¯åŠ¨ Server ï¼Œåˆå§‹åŒ– FastAPI Appã€TokenizerManagerã€DetokenizerManager å’Œ Schedulerï¼Œæ¯ä¸ªç»„ä»¶è¿è¡Œå„è‡ªçš„æ— é™äº‹ä»¶å¾ªç¯ï¼ˆinfinite event loopï¼‰ã€‚
ç”¨æˆ·å‘ FastAPI Server å‘é€ /v1/chat/completions è¯·æ±‚ï¼ŒServer é€šè¿‡ v1_chat_completions endpoint å°†è¯·æ±‚è½¬å‘åˆ° TokenizerManagerã€‚
v1_chat_completions å‡½æ•°å°†è¯·æ±‚è½¬æ¢ä¸º ChatCompletionRequestï¼Œå†è½¬æ¢ä¸º GenerateReqInputï¼Œå¹¶è°ƒç”¨ TokenizerManager çš„ generate_request æ–¹æ³•ã€‚
TokenizerManager å¯¹è¯·æ±‚è¿›è¡Œ tokenizationï¼Œå¹¶ä»¥ Python å¯¹è±¡ï¼ˆpyobjï¼‰å½¢å¼å°†å…¶è½¬å‘ç»™ Schedulerï¼ŒåŒæ—¶è°ƒç”¨ TokenizerManager çš„ _wait_one_response æ–¹æ³•ã€‚
Scheduler åœ¨äº‹ä»¶å¾ªç¯ event_loop_normal ä¸­å¤„ç†è¯·æ±‚ï¼š
Scheduler é€šè¿‡ recv_requests æ¥æ”¶è¯·æ±‚ï¼Œè°ƒç”¨ process_input_requests å¤„ç†è¾“å…¥ï¼Œé€šè¿‡ handle_generate_request ç®¡ç†ç”Ÿæˆè¯·æ±‚çš„é€»è¾‘ï¼Œå¹¶å°†å…¶åŠ å…¥ waiting_queueã€‚ ä» waiting_queue ä¸­ï¼ŒScheduler ä½¿ç”¨ get_next_batch_to_run ä¸ºå³å°†å¤„ç†çš„è¯·æ±‚åˆ›å»º ScheduleBatchã€‚ Scheduler æ‰§è¡Œ run_batch å‡½æ•°ï¼Œå°† ScheduleBatch è½¬æ¢ä¸º ModelWorkerBatchã€‚ Scheduler è°ƒç”¨ TpModelWorker çš„ forward_batch_generationï¼Œç­‰å¾… logits_output å’Œ next_token_idsã€‚ TpModelWorker åˆå§‹åŒ– ForwardBatchï¼Œå°†å…¶è½¬å‘è‡³ ModelRunnerï¼Œå¹¶ç­‰å¾… logits_outputã€‚ ModelRunner å¤„ç† ForwardBatchï¼Œè°ƒç”¨ forward_extend æ‰§è¡Œæ¨¡å‹çš„å‰å‘è®¡ç®—ï¼ˆforward passï¼‰ã€‚ æ¨¡å‹é€šè¿‡ AttentionBackend åŠ é€Ÿç”Ÿæˆ logitsï¼Œè¿”å›ç»™ ModelRunnerï¼Œè¿›è€Œè¿”å›ç»™ TpModelWorkerã€‚ TpModelWorker ä» ModelRunner æ¥æ”¶ logits_outputï¼Œè°ƒç”¨ ModelRunner çš„ sample æ–¹æ³•ç”Ÿæˆ next_token_idsï¼Œå¹¶å°†å…¶å‘é€å› Schedulerã€‚ Scheduler é€šè¿‡ process_batch_result å¤„ç†æ‰¹æ¬¡ç»“æœï¼Œä½¿ç”¨ tree_cache.cache_finished_req(req) ç¼“å­˜è¯·æ±‚ï¼Œå¹¶é€šè¿‡ check_finished éªŒè¯å®ŒæˆçŠ¶æ€ã€‚å¯¹äºæœªå®Œæˆçš„è¯·æ±‚ï¼ŒScheduler ç»§ç»­å…¶äº‹ä»¶å¾ªç¯ï¼Œç›´åˆ°è¿™ä¸ªè¯·æ±‚æ»¡è¶³ç»“æŸæ¡ä»¶ï¼›å¯¹äºå·²å®Œæˆçš„è¯·æ±‚ï¼Œåˆ™è½¬å‘åˆ° Scheduler çš„ stream_outputã€‚ åœ¨ stream_output å‡½æ•°ä¸­ï¼ŒScheduler å¤„ç†è¾“å‡ºï¼Œå°†å…¶åŒ…è£…æˆ BatchTokenIDOutï¼Œå¹¶å‘é€ç»™ DetokenizerManagerã€‚ DetokenizerManager åœ¨å…¶äº‹ä»¶å¾ªç¯ä¸­æ¥æ”¶ BatchTokenIDOutï¼Œå¤„ç†åç”Ÿæˆ BatchStrOut å¹¶è¿”å›ç»™ TokenizerManagerã€‚
...</p></div><footer class=entry-footer><span title='2025-08-13 10:30:12 +0800 CST'>August 13, 2025</span>&nbsp;Â·&nbsp;5 min&nbsp;Â·&nbsp;885 words&nbsp;Â·&nbsp;Me</footer><a class=entry-link aria-label="post link to [SGLang] åç«¯ä»£ç é€Ÿè§ˆ" href=https://pillumina.github.io/posts/aiinfra/06-sglang-backend/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>MoEç¯æ¸¸è®°ï¼š2ã€æ·±å…¥è´Ÿè½½å‡è¡¡</h2></header><div class=entry-content><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†MoEçš„ä¸€ä¸ªå‡ ä½•è¯ é‡Šï¼Œæ—¨åœ¨é€šè¿‡Denseæ¨¡å‹çš„æœ€ä½³é€¼è¿‘å‡ºå‘æ¥æ¨å¯¼å’Œç†è§£MoEã€‚åŒæ—¶åœ¨æ–‡æœ«æˆ‘ä»¬ä¹Ÿè¯´äº†ï¼Œç»™å‡ºMoEçš„è®¡ç®—å…¬å¼ä»…ä»…æ˜¯å¼€å§‹ï¼Œè®­ç»ƒä¸€ä¸ªå®é™…æœ‰æ•ˆçš„MoEæ¨¡å‹è¿˜æœ‰å¾ˆå¤šç»†èŠ‚è¡¥ï¼Œæ¯”å¦‚æœ¬æ–‡è¦è®¨è®ºçš„è´Ÿè½½å‡è¡¡ï¼ˆLoad Balanceï¼‰é—®é¢˜ã€‚
è´Ÿè½½å‡è¡¡ï¼Œå³"ä¸æ‚£å¯¡è€Œæ‚£ä¸å‡"ï¼Œè¯´ç™½äº†å°±æ˜¯è®©æ¯ä¸ªExpertéƒ½åœ¨å¹²æ´»ï¼Œå¹¶ä¸”éƒ½åœ¨å¹²å°½å¯èƒ½ä¸€æ ·å¤šçš„æ´»ï¼Œé¿å…æŸäº›Expertæµªè´¹ç®—åŠ›ã€‚è´Ÿè½½å‡è¡¡æ—¢æ˜¯å……åˆ†åˆ©ç”¨è®­ç»ƒç®—åŠ›çš„éœ€æ±‚ï¼Œä¹Ÿæ˜¯å°½å¯èƒ½å‘æŒ¥MoEå¤§å‚æ•°é‡æ½œåŠ›çš„éœ€æ±‚ã€‚
é—®é¢˜åˆ†æ æˆ‘ä»¬çŸ¥é“ï¼ŒMoEçš„åŸºæœ¬å½¢å¼æ˜¯ $$ \boldsymbol{y} = \sum_{i\in \mathop{\text{argtop}}_k \boldsymbol{\rho}} \rho_i \boldsymbol{e}_i $$ å¯¹äºä¼ ç»ŸMoEï¼Œ$\boldsymbol{\rho}$æ˜¯ä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒï¼ˆRouterï¼‰ï¼Œ$\boldsymbol{e}_i=\boldsymbol{v}_i$ï¼Œ$\boldsymbol{v}_i$æ˜¯ä¸€ä¸ªå°å‹FFNï¼ˆExpertï¼‰çš„è¾“å‡ºï¼›è€Œå¯¹äºæˆ‘ä»¬ä¸Šä¸€ç¯‡æ¨å¯¼çš„å‡ ä½•MoEï¼Œ$\boldsymbol{\rho}$æ²¡æœ‰å½’ä¸€åŒ–çš„è¦æ±‚ï¼Œå®ƒé¢„æµ‹çš„æ˜¯Expertçš„æ¨¡é•¿ï¼Œè€Œ$\boldsymbol{e}_i=\boldsymbol{v}_i/\Vert\boldsymbol{v}_i\Vert$é¢„æµ‹çš„æ˜¯Expertçš„æ–¹å‘ã€‚
ä¸ç®¡å“ªç§æ ¼å¼çš„MoEï¼Œå®é™…è¡¨ç°éƒ½å·®ä¸å¤šï¼Œåªæ˜¯ç†è§£è§†è§’çš„ä¸åŒã€‚ä½†è¦æ³¨æ„ï¼Œè™½ç„¶MoEçš„å…¬å¼ç»™äººçš„æ„Ÿè§‰æ˜¯"æ¯é‡åˆ°ä¸€ä¸ªTokenï¼Œå°±å»æ‰¾ç›¸åº”çš„Expertæ¥è®¡ç®—"ï¼Œä½†å®é™…è®­ç»ƒæ—¶å…¶å®æ˜¯åè¿‡æ¥çš„ï¼šå…ˆç»™æ¯ä¸ªExpertåˆ†é…å¥½ç›¸åº”çš„ç®—åŠ›ï¼Œç„¶åå°†Tokenåˆ†é…ï¼ˆRouteï¼‰åˆ°æ‰€å±çš„Expertä¸­å¹¶è¡Œè®¡ç®—ï¼Œè¿™ä¹Ÿå°±ä¸ºä»€ä¹ˆè´Ÿè´£æ‰“åˆ†çš„$\boldsymbol{\rho}$è¢«ç§°ä¸ºRouterã€‚
è¿™æ ·ä¸€æ¥ï¼Œå¦‚æœExpertçš„åˆ†é…ä¸å‡è¡¡ï¼Œå°±å¯èƒ½å‡ºç°å¦‚ä¸‹å±€é¢ï¼šæŸäº›Expertï¼ˆDead Expertï¼‰å‡ ä¹ä¸€ç›´é—²ç½®ï¼Œæµªè´¹ç®—åŠ›ï¼›æŸäº›Expertè¦å¤„ç†çš„Tokenå¤ªå¤šï¼Œæ ¹æœ¬å¿™ä¸è¿‡æ¥ï¼Œåªèƒ½Token Dropï¼ˆå³æ”¾å¼ƒå¤„ç†éƒ¨åˆ†Tokenï¼‰ã€‚ä»ç†è®ºä¸Šæ¥è¯´ï¼Œå‡ºç°Dead Expertæ„å‘³ç€MoEæ²¡æœ‰è¾¾åˆ°é¢„æœŸçš„å‚æ•°é‡ï¼Œå³èŠ±äº†å¤§å‚æ•°é‡çš„æ˜¾å­˜ï¼Œç»“æœåªè®­å‡ºæ¥å°å‚æ•°é‡çš„æ•ˆæœã€‚
æ‰€ä»¥ï¼Œä¸ç®¡æ˜¯ä»è®­ç»ƒè¿˜æ˜¯æ€§èƒ½è§’åº¦çœ‹ï¼Œæˆ‘ä»¬éƒ½å¸Œæœ›ä¿è¯Expertçš„è´Ÿè½½å‡è¡¡ã€‚
è¾…åŠ©æŸå¤±ï¼ˆAuxiliary Lossï¼‰ ä¿ƒè¿›è´Ÿè½½å‡è¡¡çš„å¸¸è§„æ€è·¯æ˜¯æ·»åŠ ä¸ä¹‹ç›¸å…³çš„æŸå¤±å‡½æ•°ï¼Œæˆ‘ä»¬é€šå¸¸ç§°ä¹‹ä¸º"Aux Lossï¼ˆAuxiliary Lossï¼‰"ï¼Œç›®å‰ä¸»æµç”¨çš„Aux Lossæœ€æ—©å¯ä»¥è¿½æº¯åˆ°2020å¹´çš„ã€ŠGShard: Scaling Giant Models with Conditional Computation and Automatic Shardingã€‹ã€‚
ä»‹ç»Aux Lossä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¼•å…¥ä¸€äº›æ–°æ¦‚å¿µã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å·²ç»æåˆ°å¯¹äºä¸€èˆ¬çš„MoEæ¥è¯´ï¼Œ$\boldsymbol{\rho}$æœªå¿…æ˜¯æ¦‚ç‡åˆ†å¸ƒï¼Œæˆ‘ä»¬å°†å½’ä¸€åŒ–çš„$\boldsymbol{\rho}$è®°ä¸º$\boldsymbol{p}=[p_1,p_2,\cdots,p_n]$ï¼Œä»¥åŠå®ƒTop-$k$ç‰ˆä¸º$\boldsymbol{f}=[f_1,f_2,\cdots,f_n]$ï¼Œå…¶ä¸­ $$ p_i = \frac{\rho_i}{\sum_{i=1}^n \rho_i},\qquad f_i = \begin{cases}1/k, & i\in \mathop{\text{argtop}}_k \boldsymbol{\rho} \ 0, & i\not\in \mathop{\text{argtop}}_k \boldsymbol{\rho}\end{cases} $$ æ¥ç€æˆ‘ä»¬å®šä¹‰$\boldsymbol{P}=\mathbb{E}[\boldsymbol{p}],\boldsymbol{F}=\mathbb{E}[\boldsymbol{f}]$ï¼Œè¿™é‡Œçš„$\mathbb{E}$æ˜¯æŒ‡å¯¹æ‰€æœ‰æ ·æœ¬çš„æ‰€æœ‰Tokenåšå¹³å‡ã€‚ä¸éš¾çœ‹å‡ºï¼Œ$\boldsymbol{F}$å°±æ˜¯Expertå½“å‰çš„è´Ÿè½½åˆ†å¸ƒï¼Œè€Œ$\boldsymbol{P}$åˆ™ç›¸å½“äº$\boldsymbol{F}$çš„ä¸€ä¸ªå…‰æ»‘è¿‘ä¼¼ã€‚
æœ‰äº†è¿™äº›è®°å·ï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™å‡ºAux Lossä¸ºï¼š
$$ \mathcal{L}_{\text{aux}} = \boldsymbol{F}\cdot \boldsymbol{P} = \sum_{i=1}^n F_i P_i \tag{1} $$ ...</p></div><footer class=entry-footer><span title='2025-08-10 15:05:12 +0800 CST'>August 10, 2025</span>&nbsp;Â·&nbsp;5 min&nbsp;Â·&nbsp;1055 words&nbsp;Â·&nbsp;Me</footer><a class=entry-link aria-label="post link to MoEç¯æ¸¸è®°ï¼š2ã€æ·±å…¥è´Ÿè½½å‡è¡¡" href=https://pillumina.github.io/posts/llmtheory/2-moe/></a></article><footer class=page-footer><nav class=pagination><a class=next href=https://pillumina.github.io/page/2/>Next&nbsp;2/10&nbsp;Â»</a></nav></footer></main><footer class=footer><span>&copy; 2025 <a href=https://pillumina.github.io/>CctoctoFX</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg></a><div class=reading-progress-bar></div><script src=https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){const t=document.querySelector(".reading-progress-bar");if(!t)return;const n=document.querySelector(".post-single");if(!n)return;function s(){const e=n.getBoundingClientRect(),s=e.height,o=window.innerHeight,i=window.scrollY||window.pageYOffset,a=i/(s-o)*100;t.style.width=`${Math.min(100,Math.max(0,a))}%`}let e=!1;window.addEventListener("scroll",function(){e||(window.requestAnimationFrame(function(){s(),e=!1}),e=!0)}),s()}),document.addEventListener("DOMContentLoaded",function(){mediumZoom("article img:not(.nozoom)",{margin:24,background:"var(--theme)",scrollOffset:0})})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>