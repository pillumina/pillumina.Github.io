<!doctype html><html lang=en dir=auto><head><meta name=generator content="Hugo 0.148.2"><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>CctoctoFX</title><meta name=description content><meta name=author content="Me"><link rel=canonical href=https://pillumina.github.io/><link crossorigin=anonymous href=/assets/css/stylesheet.9d388901283682bb45dd422fcaa0d0a2054a3c8ff47c9cc6b2baab15508b1b90.css integrity="sha256-nTiJASg2grtF3UIvyqDQogVKPI/0fJzGsrqrFVCLG5A=" rel="preload stylesheet" as=style><link rel=icon href=https://pillumina.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://pillumina.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://pillumina.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://pillumina.github.io/apple-touch-icon.png><link rel=mask-icon href=https://pillumina.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://pillumina.github.io/index.xml><link rel=alternate type=application/json href=https://pillumina.github.io/index.json><link rel=alternate hreflang=en href=https://pillumina.github.io/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js crossorigin=anonymous></script><script>(function(){function t(){return document.querySelector(".post-content")||document.querySelector(".post-single")||document.body}function n(e){return/\$\$[\s\S]+?\$\$|\\\(|\\\)|\\\[|\\\]/.test(e)}function s(e){if(window.__mathjaxLoaded)return;window.__mathjaxLoaded=!0,window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre","code","tt"],ignoreHtmlClass:"no-math"}};var t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js",t.defer=!0,t.onload=function(){window.MathJax&&window.MathJax.typesetPromise&&window.MathJax.typesetPromise([e]).catch(function(e){console.warn("MathJax typeset error",e)})},document.head.appendChild(t)}function e(){try{if(typeof renderMathInElement=="function"){const e=t();renderMathInElement(e,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\[",right:"\\]",display:!0},{left:"\\(",right:"\\)",display:!1}],throwOnError:!1,strict:!1,trust:!0,ignoredTags:["script","noscript","style","textarea","pre","code","tt"],ignoredClasses:["no-math"],macros:{"\\boldsymbol":"\\mathbf{#1}","\\bm":"\\mathbf{#1}"}}),setTimeout(function(){n(e.innerHTML)&&s(e)},200)}}catch(e){console.warn("KaTeX render error:",e)}}document.addEventListener("DOMContentLoaded",function(){e(),setTimeout(e,200)}),window.addEventListener("load",function(){setTimeout(e,0)})})()</script><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script><script>const config={startOnLoad:!0,theme:"neutral",themeVariables:{lineColor:"#0f0f0f"},flowchart:{useMaxWidth:!1,htmlLabels:!0}};mermaid.initialize(config),window.onload=()=>{window.mermaid.init(0[0],document.querySelectorAll(".language-mermaid"))}</script><link rel=stylesheet href=/css/custom.min.bda7229c4269a242639e058fb11a4782f02f8d77071ba16609befee67cc41c49.css integrity="sha256-vacinEJpokJjngWPsRpHgvAvjXcHG6FmCb7+5nzEHEk="><script>document.addEventListener("DOMContentLoaded",function(){const t=document.querySelectorAll("h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]"),n=document.querySelectorAll(".toc a");if(t.length===0||n.length===0)return;const s={};t.forEach(e=>{s[e.id]=e.offsetTop});function i(){const t=window.scrollY+100;let e="";for(const[n,o]of Object.entries(s))if(t>=o)e=n;else break;return e}function o(){const e=i();if(n.forEach(e=>{e.classList.remove("active")}),e){const t=document.querySelector(`.toc a[href="#${e}"]`);t&&t.classList.add("active")}}let e=!1;window.addEventListener("scroll",function(){e||(window.requestAnimationFrame(function(){o(),e=!1}),e=!0)}),o()})</script><meta property="og:url" content="https://pillumina.github.io/"><meta property="og:site_name" content="CctoctoFX"><meta property="og:title" content="CctoctoFX"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://pillumina.github.io/imgs/icon_head.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://pillumina.github.io/imgs/icon_head.png"><meta name=twitter:title content="CctoctoFX"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"CctoctoFX","url":"https://pillumina.github.io/","description":"","logo":"https://pillumina.github.io/favicon.ico","sameAs":["derios1230@gmail.com","https://github.com/pillumina","https://gitee.com/pillumina"]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://pillumina.github.io/ accesskey=h title="CctoctoFX (Alt + H)"><img src=https://pillumina.github.io/apple-touch-icon.png alt aria-label=logo height=30>CctoctoFX</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://pillumina.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://pillumina.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://pillumina.github.io/posts/aiinfra/ title="AI Infra"><span>AI Infra</span></a></li><li><a href=https://pillumina.github.io/posts/llmtheory/ title=Thoery><span>Thoery</span></a></li><li><a href=https://pillumina.github.io/posts/programming/ title=Programming><span>Programming</span></a></li><li><a href=https://pillumina.github.io/social/ title=Social><span>Social</span></a></li><li><a href=https://pillumina.github.io/open_courses/ title=Study><span>Study</span></a></li></ul></nav></header><main class=main><article class="first-entry home-info"><header class=entry-header><h1>CctoctoFX (Yuxiao Huang)</h1></header><div class=entry-content><div class=row><div class=profile-text><p>Hey there! I‚Äôm a software engineer obsessed with untangling complex systems.<br>My playground includes:</p><ul><li><p>‚öôÔ∏è Software architecture (scaling the unscalable),</p></li><li><p>üß† LLM training/inference (squeezing speed from silicon),</p></li><li><p>üìà Economic systems & üåç geopolitics (decoding money & power).</p></li><li><p>AI Infrastructure (AI Infra) & ML Systems (MLSys) are my battlefield: deep dives on scaling, optimization, and the guts of large models. Beyond the keyboard, I also share spicy takes on geopolitics when the mood strikes.</p></li><li><p>No fluff, just signal. Join the conversation!</p></li></ul></div><div class=profile-img><img draggable=false src=https://pillumina.github.io/imgs/icon_head.png alt=profile title=profile height=150 width=150></div></div></div></div></div><footer class=entry-footer><div class=social-icons><a href=derios1230@gmail.com target=_blank rel="noopener noreferrer me" title=Email><svg viewBox="0 0 24 21" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
</a><a href=https://github.com/pillumina target=_blank rel="noopener noreferrer me" title=Github><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=https://gitee.com/pillumina target=_blank rel="noopener noreferrer me" title=Gitea><svg viewBox="0 0 24 20" fill="currentColor"><path d="M4.209 4.603c-.247.0-.525.02-.84.088-.333.07-1.28.283-2.054 1.027C-.403 7.25.035 9.685.089 10.052c.065.446.263 1.687 1.21 2.768 1.749 2.141 5.513 2.092 5.513 2.092s.462 1.103 1.168 2.119c.955 1.263 1.936 2.248 2.89 2.367 2.406.0 7.212-.004 7.212-.004s.458.004 1.08-.394c.535-.324 1.013-.893 1.013-.893s.492-.527 1.18-1.73c.21-.37.385-.729.538-1.068.0.0 2.107-4.471 2.107-8.823-.042-1.318-.367-1.55-.443-1.627-.156-.156-.366-.153-.366-.153s-4.475.252-6.792.306c-.508.011-1.012.023-1.512.027v4.474l-.634-.301c0-1.39-.004-4.17-.004-4.17-1.107.016-3.405-.084-3.405-.084s-5.399-.27-5.987-.324c-.187-.011-.401-.032-.648-.032zm.354 1.832h.111s.271 2.269.6 3.597C5.549 11.147 6.22 13 6.22 13s-.996-.119-1.641-.348c-.99-.324-1.409-.714-1.409-.714s-.73-.511-1.096-1.52C1.444 8.73 2.021 7.7 2.021 7.7s.32-.859 1.47-1.145c.395-.106.863-.12 1.072-.12zm8.33 2.554c.26.003.509.127.509.127l.868.422-.529 1.075a.686.686.0 00-.614.359.685.685.0 00.072.756l-.939 1.924a.69.69.0 00-.66.527.687.687.0 00.347.763.686.686.0 00.867-.206.688.688.0 00-.069-.882l.916-1.874a.667.667.0 00.237-.02.657.657.0 00.271-.137 8.826 8.826.0 011.016.512.761.761.0 01.286.282c.073.21-.073.569-.073.569-.087.29-.702 1.55-.702 1.55a.692.692.0 00-.676.477.681.681.0 101.157-.252c.073-.141.141-.282.214-.431.19-.397.515-1.16.515-1.16.035-.066.218-.394.103-.814-.095-.435-.48-.638-.48-.638-.467-.301-1.116-.58-1.116-.58s0-.156-.042-.27a.688.688.0 00-.148-.241l.516-1.062 2.89 1.401s.48.218.583.619c.073.282-.019.534-.069.657-.24.587-2.1 4.317-2.1 4.317s-.232.554-.748.588a1.065 1.065.0 01-.393-.045l-.202-.08-4.31-2.1s-.417-.218-.49-.596c-.083-.31.104-.691.104-.691l2.073-4.272s.183-.37.466-.497a.855.855.0 01.35-.077z"/></svg></a></div></footer></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>[VeRL] ÂèÇÊï∞ÈÄüËßà</h2></header><div class=entry-content><p>VeRLÊ°ÜÊû∂ÁöÑÂèÇÊï∞‰ºóÂ§öÔºåÂü∫‰∫éÂΩìÂâçÔºà2025.8.5Ôºâ‰∏ªÁ∫øÂàÜÊîØÊï¥ÁêÜÔºåÈôÑÂ∏¶‰∫ÜÁõ∏ÂÖ≥ÁöÑÁêÜËß£Ôºå‰∏Ä‰∫õÊèèËø∞‰∏ç‰∏ÄÂÆöÂÆåÂÖ®Ê≠£Á°ÆÔºå‰æõÂ≠¶‰π†ÂèÇËÄÉ„ÄÇ
Batch Size ÂèÇÊï∞ÂêçÁß∞ ËØ¶ÁªÜËß£Èáä data.train_batch_size ‰ΩúÁî®ÔºöÂÆö‰πâ‰∫ÜÂçïÊ¨°ËÆ≠ÁªÉÂèëÈÄÅÁªô Rollout Engine ÁöÑÊ†∑Êú¨Êï∞ÈáèÔºå‰πüÂç≥ËøôÊòØÂú®ÊØè‰∏™ PPO Ëø≠‰ª£ÂºÄÂßãÊó∂Ôºå‰ªéËÆ≠ÁªÉÊï∞ÊçÆÈõÜ‰∏≠ÈááÊ†∑ÁöÑÊèêÁ§∫ ÔºàPromptÔºâÊï∞Èáè„ÄÇ
ËØ¶ÁªÜËß£ÈáäÔºöËøô‰∏™ÂÄºÊòØ RL ËÆ≠ÁªÉ‰∏≠ÁöÑÂü∫Êú¨Ê†∑Êú¨Êï∞Èáè„ÄÇ‰æãÂ¶ÇÔºåËÆæÁΩÆ‰∏∫ 1024 ÊÑèÂë≥ÁùÄÂú®‰∏ÄÊ¨°Ëø≠‰ª£‰∏≠‰ºöÔºö
1. ‰ªéÊï∞ÊçÆÈõÜ‰∏≠ÈöèÊú∫ÊäΩÂèñ 1024 ‰∏™ prompt„ÄÇ
2. Â∞ÜËøô 1024 ‰∏™ prompt ÂèëÈÄÅÁªôÂΩìÂâçÁöÑ Rollout Engine ‰∏≠Ôºå‰ªéËÄåÂæóÂà∞ 1024 ÁªÑÂÆåÊï¥ÁöÑ trajectoriesÔºàprompt, responseÔºâ„ÄÇ
3. Êé•‰∏ãÊù•ÔºåËøô 1024 ‰∏™ trajectories ËøõË°åÁªèÈ™åËÆ°ÁÆóÔºàmake experienceÔºâÔºåÂêéÁª≠Áî®‰∫é Actor Âíå Critic Ê®°ÂûãÁöÑÊõ¥Êñ∞„ÄÇ
ÂΩ±Âìç‰∏éÊùÉË°°ÔºöÂΩ±ÂìçÊÄªÂÖ±ËÆ≠ÁªÉÁöÑÊ†∑Êú¨Èáè„ÄÇ data.val_batch_size ÔºàDeprecated) ‰ΩúÁî®ÔºöÂú® Validation Èò∂ÊÆµ‰ΩøÁî®ÁöÑÊâπÊ¨°Â§ßÂ∞è„ÄÇ
ËØ¶ÁªÜËß£ÈáäÔºöËøô‰∏é train_batch_size Á±ª‰ººÔºå‰ΩÜ‰ªÖÁî®‰∫éËØÑ‰º∞Ê®°ÂûãÊÄßËÉΩÔºå‰∏çÂèÇ‰∏éËÆ≠ÁªÉ„ÄÇÂ¶ÇÊûúËÆæÁΩÆ‰∏∫ nullÔºå‰ºö‰ΩøÁî®È™åËØÅÈõÜÁöÑÂ§ßÂ∞è‰Ωú‰∏∫ÈªòËÆ§ÂÄº„ÄÇNote: Â∑≤ÁªèdeprecatedÔºåÊé®ËçêËÆæÁΩÆ‰∏∫ null„ÄÇÊ≠§Êó∂ÔºåÊï¥‰∏™ validation dataset ‰∏ÄÊ¨°ÊÄßÂèëÁªô SGLang enginesÔºåËá™Ë°åËøõË°åÂÜÖÂ≠òÁÆ°ÁêÜ„ÄÇ actor_rollout_ref.actor.ppo_mini_batch_size critic.ppo_mini_batch_size ‰ΩúÁî®ÔºöÂÆö‰πâ‰∫Ü PPO ËÆ≠ÁªÉÊõ¥Êñ∞‰∏≠ÁöÑ mini-batch Â§ßÂ∞è„ÄÇ
ËØ¶ÁªÜËß£ÈáäÔºödata.train_batch_size Êî∂ÈõÜÂà∞ÁöÑÂÖ®ÈÉ®ÁªèÈ™åÊï∞ÊçÆÂ∞ÜË¢´ÂàÜÂâ≤ÊàêÂ§ö‰∏™ mini-batchÔºåÊØèÂùóÁöÑÂ§ßÂ∞èÂ∞±ÊòØ ppo_mini_batch_size„ÄÇÊ®°ÂûãÊØèÂ§ÑÁêÜÂÆå‰∏Ä‰∏™ mini-batchÔºåÊâç‰ºöËøõË°å‰∏ÄÊ¨°ÂèÇÊï∞Êõ¥Êñ∞„ÄÇ
‰æãÂ¶ÇÔºåÂ¶ÇÊûú train_batch_size = 1024Ôºåppo_mini_batch_size = 256ÔºåÈÇ£‰πàÂú®‰∏Ä‰∏™ PPO Epoch ‰∏≠ÔºåÊ®°Âûã‰ºöËøõË°å 1024 / 256 = 4 Ê¨°ÂèÇÊï∞Êõ¥Êñ∞„ÄÇ
ÂΩ±Âìç‰∏éÊùÉË°°ÔºöÂ¢ûÂ§ß mini-batchÔºåÂçïÊ¨°Êõ¥Êñ∞ÁöÑÊ¢ØÂ∫¶Êõ¥Á®≥ÂÆöÔºå‰ΩÜÊõ¥Êñ∞È¢ëÁéáÊõ¥‰ΩéÔºåÊõ¥Êñ∞Ê¨°Êï∞ÂáèÂ∞ë„ÄÇ actor_rollout_ref.actor.ppo_micro_batch_size_per_gpu critic.ppo_micro_batch_size_per_gpu ‰ΩúÁî®ÔºöÂÆö‰πâ‰∫ÜÂú®Âçï‰∏™ GPU ‰∏äËøõË°å‰∏ÄÊ¨° forward/backward ÁöÑÊï∞ÊçÆÂ§ßÂ∞è„ÄÇ
ËØ¶ÁªÜËß£ÈáäÔºöËøôÊòØÂÆûÁé∞Ê¢ØÂ∫¶Á¥ØÁßØÁöÑÊ†∏ÂøÉÂèÇÊï∞„ÄÇmini-batch ‰ºöË¢´ÂÜçÊ¨°ÂàáÂàÜ‰∏∫Ëã•Âπ≤‰∏™ micro-batch„ÄÇ‰æãÂ¶ÇÔºåÂú®ÂçïÂç°‰∏äÔºåppo_mini_batch_size = 256Ôºåppo_micro_batch_size_per_gpu = 32ÔºåÈÇ£‰πàÊ¢ØÂ∫¶Á¥ØÁßØÁöÑÊ≠•Êï∞Â∞±ÊòØ 256 / 32 = 8„ÄÇËøôÊÑèÂë≥ÁùÄÊ®°Âûã‰ºöËøêË°å 8 Ê¨° forward ÂæóÂà∞ lossÔºåÁÑ∂Âêé backward ÁöÑÂà∞ gradient„ÄÇÊØèÊ¨°Â§ÑÁêÜ 32 ‰∏™Ê†∑Êú¨ÔºåÁõ¥Âà∞Á¥ØÁßØÂÆåÊï¥‰∏™ mini-batch ËÆ°ÁÆóÂá∫ÁöÑÊ¢ØÂ∫¶„ÄÇÊ≠§Êó∂Ôºå‰ΩøÁî®Á¥ØÁßØÁöÑÊÄªÊ¢ØÂ∫¶ÔºåÂØπÊ®°ÂûãÂèÇÊï∞ËøõË°å‰∏ÄÊ¨°Êõ¥Êñ∞Ôºàoptimizer.step()Ôºâ„ÄÇËøô‰∏™ÂÄºÂøÖÈ°ªÊ†πÊçÆÊòæÂ≠òÂ§ßÂ∞èÊù•‰∏•Ê†ºË∞ÉÊï¥ÔºåÊòØÈò≤Ê≠¢ OOM ÁöÑÂÖ≥ÈîÆ„ÄÇ
ÂΩ±Âìç‰∏éÊùÉË°°ÔºöÂ¢ûÂ§ßÊ≠§ÂÄºÔºåÂáèÂ∞ë‰∫ÜÊ¢ØÂ∫¶Á¥ØÁßØÁöÑÊ¨°Êï∞ÔºåÂèØ‰ª•ÊèêÈ´òËÆ≠ÁªÉÁöÑÂêûÂêêÈáèÔºåÂ¢ûÂ§ßÊòæÂ≠òÊ∂àËÄó„ÄÇ actor_rollout_ref.actor.ppo_micro_batch_size critic.ppo_micro_batch_sizeÔºàDeprecated) ‰ΩúÁî®ÔºöÂ∑≤ÂºÉÁî®ÔºåË¢´ per_gpu ÁâàÊú¨Âèñ‰ª£ÔºåÂõ†‰∏∫ÂÆÉËÉΩÊõ¥Â•ΩÂú∞ÈÄÇÂ∫îÂàÜÂ∏ÉÂºèËÆ≠ÁªÉÁéØÂ¢É„ÄÇ Dynamic Batch Size ÂΩìÊ†∑Êú¨ÈïøÂ∫¶Â∑ÆÂºÇÂæàÂ§ßÊó∂ÔºåÊåâÊ†∑Êú¨Êï∞ÈáèÂàíÂàÜÊâπÊ¨°ÂèØËÉΩÂØºËá¥‰∏çÂêåÊâπÊ¨°ÁöÑËÆ°ÁÆóÈáèÊûÅ‰∏çÂùáË°°ÔºåËÄåÂü∫‰∫é token ÊÄªÊï∞Êù•ÊéßÂà∂ batch size ÊòØ‰∏ÄÁßçÂπ≥Ë°°ÊØè‰∏™ batch ËÆ≠ÁªÉÊó∂Èó¥ÁöÑÊñπÊ°à„ÄÇ
...</p></div><footer class=entry-footer><span title='2025-08-14 10:20:12 +0800 CST'>August 14, 2025</span>&nbsp;¬∑&nbsp;6 min&nbsp;¬∑&nbsp;1133 words&nbsp;¬∑&nbsp;Me</footer><a class=entry-link aria-label="post link to [VeRL] ÂèÇÊï∞ÈÄüËßà" href=https://pillumina.github.io/posts/aiinfra/05-verl-params/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>AI InfraÔºöÈ¢†Ë¶ÜÊÄßÂàõÊñ∞ÔºåËøòÊòØÁªèÂÖ∏Â∑•Á®ãËåÉÂºèÁöÑÂçé‰∏ΩËΩ¨Ë∫´Ôºü</h2></header><div class=entry-content><p>ËøëÊúüÁúãÂà∞‰∏Ä‰∫õÂÖ≥‰∫é‰º†ÁªüÂü∫Á°ÄËÆæÊñΩÔºàTraditional InfrastructureÔºâ‰∏é‰∫∫Â∑•Êô∫ËÉΩÂü∫Á°ÄËÆæÊñΩÔºàAI InfrastructureÔºåÂ∞§ÂÖ∂Â§ßÊ®°ÂûãÈ¢ÜÂüüÔºâÂ∑ÆÂºÇÁöÑËØÑËÆ∫„ÄÇÂÖ∂Ê†∏ÂøÉËßÇÁÇπÁõ¥Êåá‰∏§ËÄÖÈó¥ÁöÑÂ∑®Â§ßÈ∏øÊ≤üÔºöËÆ∏Â§öÁ≤æ‰∫éÁΩëÁªú„ÄÅËÆ°ÁÆó„ÄÅÂ≠òÂÇ®Á≠â‰º†ÁªüÈ¢ÜÂüüÁöÑÂ∑•Á®ãÂ∏àÔºåÂú®Èù¢ÂØπGPUÈõÜÁæ§„ÄÅKV CacheÁÆ°ÁêÜ„ÄÅ3DÂπ∂Ë°åÁ≠âÂÖ®Êñ∞Ê¶ÇÂøµÊó∂ÔºåÂ∏∏ÊÑüËøáÂæÄÁªèÈ™åÈöæ‰ª•Áõ¥Êé•Â•óÁî®ÔºåÁîöËá≥‰∫ßÁîüË∏èÂÖ•‰∏Ä‰∏™ÂÖ®ÁÑ∂‰∏çÂêåÊäÄÊúØ‰ΩìÁ≥ªÁöÑ‚ÄúÂâ≤Ë£ÇÊÑü‚Äù„ÄÇ
Ëøô‰∫õÁúãÊ≥ïÈ¢áÂÖ∑‰ª£Ë°®ÊÄßÔºåÁ≤æÂáÜÊçïÊçâ‰∫ÜÂ∑•Á®ãÂ∏àÂàùÊé¢AI InfraÊó∂ÁöÑÊôÆÈÅçÂç∞Ë±°ÔºöÈôåÁîü„ÄÅÈ´òÈó®Êßõ„ÄÅËåÉÂºèËø•ÂºÇ„ÄÇÊú¨ÊñáÊó®Âú®ÂàÜ‰∫´ÊàëÂØπÊ≠§ÁöÑ‰∏Ä‰∫õÂàùÊ≠•ÊÄùËÄÉÔºöAI InfraÁ©∂Á´üÊòØÈ¢†Ë¶Ü‰º†ÁªüÁöÑÂÖ®Êñ∞‰ΩìÁ≥ªÔºåÊäëÊàñÊòØÊó¢ÊúâInfraÁªèÈ™åÂú®Êô∫ËÉΩÊó∂‰ª£ÁöÑ‰∏ÄÊ¨°Ê∑±Â∫¶ÊºîÂåñÔºü
ÔºàÂÖçË¥£Â£∞ÊòéÔºöÊú¨ÊñáÁ∫ØÂ±û‰∏™‰∫∫ËßÇÁÇπÔºåÊó®Âú®ÊäõÁ†ñÂºïÁéâÔºåÊ¨¢ËøéÊåáÊ≠£Ë∞¨ËØØÔºÅÔºâ
ÊàëÁöÑÊ†∏ÂøÉËÆ∫ÁÇπÔºöAI InfraÂπ∂ÈùûÂπ≥Âú∞Ëµ∑È´òÊ•ºÔºåÂÆÉÂÆûË¥®‰∏äÊòØ‰º†ÁªüInfraÂ∑•Á®ãÊô∫ÊÖßÂú®Êñ∞Âú∫ÊôØ‰∏ãÁöÑÈáçÊûÑ‰∏éÁ≥ªÁªüÊÄßÂª∂Â±ï„ÄÇ
Ë°®Ë±°Â∑ÆÂºÇÔºöÊñ∞ÊúØËØ≠‰∏éÊñ∞ÊåëÊàòÂ∏¶Êù•ÁöÑ‚ÄúËßÜËßâÂÜ≤Âáª‚Äù ‰πçÁúã‰πã‰∏ãÔºåAI Infra‰∏é‰º†ÁªüInfraÁ°ÆÂÆûÂàÜÈáéÊòéÊòæÔºö
Ê†∏ÂøÉ‰ªªÂä°‰∏çÂêåÔºö¬†‰º†ÁªüInfraËÅöÁÑ¶‰∫éÂ§ÑÁêÜÊµ∑ÈáèWebËØ∑Ê±ÇÔºàÊØ´ÁßíÁ∫ß„ÄÅÊó†Áä∂ÊÄÅÔºâ„ÄÅ‰øùÈöúÊï∞ÊçÆÊåÅ‰πÖÂåñÂ≠òÂÇ®„ÄÅÂÆûÁé∞ÂàÜÂ∏ÉÂºèÊúçÂä°ÂçèË∞É„ÄÇËÄåAI InfraÔºàÂ∞§‰ª•Â§ßÊ®°Âûã‰∏∫ÁîöÔºâÂàôÂõ¥ÁªïGPUÈ©±Âä®ÁöÑÊ®°ÂûãËÆ≠ÁªÉ/Êé®ÁêÜ„ÄÅKV CacheÁöÑÈ´òÊïàÁÆ°ÁêÜ„ÄÅÁôæ‰∫ø/ÂçÉ‰∫øÁ∫ßÂèÇÊï∞ÁöÑÂàÜÂ∏ÉÂºèÊâßË°åÊ°ÜÊû∂Â±ïÂºÄ„ÄÇ ËØ∑Ê±ÇÂΩ¢ÊÄÅËø•ÂºÇÔºö¬†WebËØ∑Ê±ÇËøΩÊ±ÇÁû¨Êó∂ÂìçÂ∫îÔºàÊØ´ÁßíÁ∫ßÔºâ„ÄÅÂ§©ÁÑ∂Êó†Áä∂ÊÄÅ„ÄÇÂ§ßÊ®°ÂûãÔºàLLMÔºâÊé®ÁêÜÂàôÂ∏∏ÊâøËΩΩÊåÅÁª≠ÁöÑ‰ºöËØù‰∫§‰∫íÔºàÁßíÁ∫ß‰πÉËá≥Êõ¥ÈïøÔºåÈöè‰∏ä‰∏ãÊñáÁ™óÂè£Êâ©Â±ïËÄåÈÄíÂ¢ûÔºâÔºåÈúÄÂä®ÊÄÅÁª¥Êä§ÁªÜÁ≤íÂ∫¶ÁöÑTokenÁ∫ßÁä∂ÊÄÅÔºàKV CacheÔºâ„ÄÇ ÊäÄÊúØÊ†àËø≠‰ª£Ôºö¬†ÁÜüÊÇâÁöÑKubernetes + DockerÂ†ÜÊ†àÊóÅÔºåÊ∂åÁé∞Âá∫GPUÁ°¨‰ª∂ÊäΩË±°„ÄÅvLLM„ÄÅDeepSpeed„ÄÅFlashAttention„ÄÅTriton„ÄÅNCCLÁ≠â‰∏ì‰∏∫AIËÆæËÆ°„ÄÅÂêçÂè∑‚ÄúÈ´òÊ∑±‚ÄùÁöÑÁªÑ‰ª∂„ÄÇ Áî±Ê≠§ËßÇ‰πãÔºåËÆ§‰∏∫‰º†ÁªüÁªèÈ™åÈöæ‰ª•Áõ¥Êé•ËøÅÁßªÔºåÁ°ÆÊúâÂÖ∂Ë°®Ë±°‰æùÊçÆ„ÄÇ‰ΩÜËøô‰ªÖ‰ªÖÊòØ‚ÄúÊ∞¥Èù¢‰πã‰∏äÁöÑÂÜ∞Â±±‚ÄùÔºåËøúÈùûÂÖ∂Â∫ïÂ±ÇÂü∫Áü≥„ÄÇ
Êú¨Ë¥®ÂÖ±ÊÄßÔºöÂ∑•Á®ãÊ†∏ÂøÉÊåëÊàòÁöÑÊ∞∏ÊÅíÂõûÂΩí Êã®ÂºÄ‚ÄúAI‰∏ìÂ±û‚ÄùÁöÑÈù¢Á∫±ÔºåÂ∑•Á®ãÂÆûË∑µÁöÑÊ†∏ÂøÉÂëΩÈ¢ò‰æùÁÑ∂Â¶ÇÊïÖÔºöÁ≥ªÁªüËÆæËÆ°‰∏éËµÑÊ∫êË∞ÉÂ∫¶ÁöÑÁ≤æÂ¶ôËâ∫ÊúØ„ÄÇ Êàë‰ª¨Èù¢‰∏¥ÁöÑÔºå‰ªçÊòØÈÇ£‰∫õ‰º†ÁªüInfraÈ¢ÜÂüü‰∏≠ÂèçÂ§çÈî§ÁÇºÁöÑÂêåÁ±ªÈóÆÈ¢òÔºåÂè™ÊòØÁ∫¶ÊùüÊù°‰ª∂Âíå‰ºòÂåñÁõÆÊ†áÂèëÁîü‰∫ÜÂèòÂåñÔºö
ËµÑÊ∫êË∞ÉÂ∫¶Ôºö¬†Ê†∏ÂøÉËµÑÊ∫ê‰ªéCPU/ÂÜÖÂ≠ò/Á£ÅÁõòIOÔºåËΩ¨Âêë‰∫ÜÊõ¥Á®ÄÁº∫„ÄÅÊõ¥ÊòÇË¥µÁöÑGPUÊòæÂ≠ò‰∏éÁÆóÂäõ„ÄÇ Ë¥üËΩΩÂ§ÑÁêÜÔºö¬†ÊâøËΩΩÂØπË±°‰ªéHTTPËµÑÊ∫êËØ∑Ê±ÇÔºåÂèò‰∏∫ÂØÜÈõÜÁöÑPromptËØ∑Ê±Ç‰∏éÂ§ßËßÑÊ®°ËÆ≠ÁªÉ‰ªªÂä°„ÄÇ Ê†∏ÂøÉÁõÆÊ†áÔºö¬†È´òÊïà„ÄÅÁ®≥ÂÆö„ÄÅ‰ΩéÊàêÊú¨Âú∞ÂçèË∞ÉË∑®ËäÇÁÇπËµÑÊ∫êÁöÑÊ†∏ÂøÉËØâÊ±Ç‰∏ùÊØ´Êú™Âèò„ÄÇ Ê¶ÇÂøµÁöÑÊò†Â∞ÑÔºöÁªèÂÖ∏ËåÉÂºèÁöÑAIÂÆûË∑µ
ËøôÁßçÂª∂Áª≠ÊÄßÔºåÊ∏ÖÊô∞Âú∞‰ΩìÁé∞Âú®ÂÖ≥ÈîÆÊ¶ÇÂøµÁöÑÂØπÂ∫îÂÖ≥Á≥ª‰∏äÔºö
‰º†Áªü Infra Ê¶ÇÂøµ AI Infra ÂØπÂ∫îÂÆûË∑µ Ê†∏ÂøÉÊÄùÊÉ≥Â∫îÁî® Êï∞ÊçÆÂàÜÁâá (Data Sharding) Êï∞ÊçÆÂπ∂Ë°å (Data Parallelism) Êï∞ÊçÆÈõÜÊãÜÂàÜÔºåÂ§öÂâØÊú¨Âπ∂Ë°åÂ§ÑÁêÜ Ë¥üËΩΩÂùáË°° (Load Balancer) MoE Router (Mixture of Experts) Âä®ÊÄÅÂàÜÈÖçËØ∑Ê±ÇÔºàTokenÔºâËá≥‰∏ìÂÆ∂ÁΩëÁªúÔºåÈÅøÂÖçÁÉ≠ÁÇπ Êìç‰ΩúÁ≥ªÁªüÂàÜÈ°µ (OS Paging) vLLM KV Cache Paging ËôöÊãüÂåñÊòæÂ≠òÁ©∫Èó¥ÔºåÈ´òÊïàÁÆ°ÁêÜËØ∑Ê±ÇÁä∂ÊÄÅ ‰ª•vLLM‰∏∫‰æãÔºö ÂÖ∂Ê†∏ÂøÉÂàõÊñ∞Âú®‰∫éÂ∞ÜÊìç‰ΩúÁ≥ªÁªüÁªèÂÖ∏ÁöÑÂÜÖÂ≠òÁÆ°ÁêÜÊú∫Âà∂ÔºàÂàÜÈ°µ„ÄÅ‰∫§Êç¢ÔºâÔºåÂàõÈÄ†ÊÄßÂú∞Â∫îÁî®‰∫éÁÆ°ÁêÜLLMÊé®ÁêÜ‰∏≠ÂÖ≥ÈîÆÁöÑKV CacheÁä∂ÊÄÅ„ÄÇÂÆÉÂ¶ÇÂêå‰∏∫LLMÂÆöÂà∂‰∫Ü‰∏Ä‰∏™‚ÄúÊòæÂ≠òÊìç‰ΩúÁ≥ªÁªü‚ÄùÔºåÁÆ°ÁêÜ‚ÄúËøõÁ®ã‚ÄùÔºàÊé®ÁêÜËØ∑Ê±ÇÔºâÂíå‚ÄúÂÜÖÂ≠òÈ°µ‚ÄùÔºàKV Cache BlocksÔºâÔºåÊûÅËá¥‰ºòÂåñÊòÇË¥µÊòæÂ≠òÁöÑÂà©Áî®Áéá„ÄÇËøôÁªùÈùûÂá≠Á©∫ÂàõÈÄ†ÔºåËÄåÊòØÁªèÂÖ∏Á≥ªÁªüÂéüÁêÜÂú®ÁâπÂÆöÁ∫¶Êùü‰∏ãÁöÑÂçìË∂äÂ∫îÁî®„ÄÇ
...</p></div><footer class=entry-footer><span title='2025-08-14 10:05:12 +0800 CST'>August 14, 2025</span>&nbsp;¬∑&nbsp;1 min&nbsp;¬∑&nbsp;200 words&nbsp;¬∑&nbsp;Me</footer><a class=entry-link aria-label="post link to AI InfraÔºöÈ¢†Ë¶ÜÊÄßÂàõÊñ∞ÔºåËøòÊòØÁªèÂÖ∏Â∑•Á®ãËåÉÂºèÁöÑÂçé‰∏ΩËΩ¨Ë∫´Ôºü" href=https://pillumina.github.io/posts/aiinfra/04-aiinfra-thinking/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>MoEÁéØÊ∏∏ËÆ∞Ôºö2„ÄÅÊ∑±ÂÖ•Ë¥üËΩΩÂùáË°°</h2></header><div class=entry-content><p>Âú®‰∏ä‰∏ÄÁØáÊñáÁ´†‰∏≠ÔºåÊàë‰ª¨‰ªãÁªç‰∫ÜMoEÁöÑ‰∏Ä‰∏™Âá†‰ΩïËØ†ÈáäÔºåÊó®Âú®ÈÄöËøáDenseÊ®°ÂûãÁöÑÊúÄ‰Ω≥ÈÄºËøëÂá∫ÂèëÊù•Êé®ÂØºÂíåÁêÜËß£MoE„ÄÇÂêåÊó∂Âú®ÊñáÊú´Êàë‰ª¨‰πüËØ¥‰∫ÜÔºåÁªôÂá∫MoEÁöÑËÆ°ÁÆóÂÖ¨Âºè‰ªÖ‰ªÖÊòØÂºÄÂßãÔºåËÆ≠ÁªÉ‰∏Ä‰∏™ÂÆûÈôÖÊúâÊïàÁöÑMoEÊ®°ÂûãËøòÊúâÂæàÂ§öÁªÜËäÇË°•ÔºåÊØîÂ¶ÇÊú¨ÊñáË¶ÅËÆ®ËÆ∫ÁöÑË¥üËΩΩÂùáË°°ÔºàLoad BalanceÔºâÈóÆÈ¢ò„ÄÇ
Ë¥üËΩΩÂùáË°°ÔºåÂç≥"‰∏çÊÇ£ÂØ°ËÄåÊÇ£‰∏çÂùá"ÔºåËØ¥ÁôΩ‰∫ÜÂ∞±ÊòØËÆ©ÊØè‰∏™ExpertÈÉΩÂú®Âπ≤Ê¥ªÔºåÂπ∂‰∏îÈÉΩÂú®Âπ≤Â∞ΩÂèØËÉΩ‰∏ÄÊ†∑Â§öÁöÑÊ¥ªÔºåÈÅøÂÖçÊüê‰∫õExpertÊµ™Ë¥πÁÆóÂäõ„ÄÇË¥üËΩΩÂùáË°°Êó¢ÊòØÂÖÖÂàÜÂà©Áî®ËÆ≠ÁªÉÁÆóÂäõÁöÑÈúÄÊ±ÇÔºå‰πüÊòØÂ∞ΩÂèØËÉΩÂèëÊå•MoEÂ§ßÂèÇÊï∞ÈáèÊΩúÂäõÁöÑÈúÄÊ±Ç„ÄÇ
ÈóÆÈ¢òÂàÜÊûê Êàë‰ª¨Áü•ÈÅìÔºåMoEÁöÑÂü∫Êú¨ÂΩ¢ÂºèÊòØ $$ \boldsymbol{y} = \sum_{i\in \mathop{\text{argtop}}_k \boldsymbol{\rho}} \rho_i \boldsymbol{e}_i $$ ÂØπ‰∫é‰º†ÁªüMoEÔºå$\boldsymbol{\rho}$ÊòØ‰∏Ä‰∏™Ê¶ÇÁéáÂàÜÂ∏ÉÔºàRouterÔºâÔºå$\boldsymbol{e}_i=\boldsymbol{v}_i$Ôºå$\boldsymbol{v}_i$ÊòØ‰∏Ä‰∏™Â∞èÂûãFFNÔºàExpertÔºâÁöÑËæìÂá∫ÔºõËÄåÂØπ‰∫éÊàë‰ª¨‰∏ä‰∏ÄÁØáÊé®ÂØºÁöÑÂá†‰ΩïMoEÔºå$\boldsymbol{\rho}$Ê≤°ÊúâÂΩí‰∏ÄÂåñÁöÑË¶ÅÊ±ÇÔºåÂÆÉÈ¢ÑÊµãÁöÑÊòØExpertÁöÑÊ®°ÈïøÔºåËÄå$\boldsymbol{e}_i=\boldsymbol{v}_i/\Vert\boldsymbol{v}_i\Vert$È¢ÑÊµãÁöÑÊòØExpertÁöÑÊñπÂêë„ÄÇ
‰∏çÁÆ°Âì™ÁßçÊ†ºÂºèÁöÑMoEÔºåÂÆûÈôÖË°®Áé∞ÈÉΩÂ∑Æ‰∏çÂ§öÔºåÂè™ÊòØÁêÜËß£ËßÜËßíÁöÑ‰∏çÂêå„ÄÇ‰ΩÜË¶ÅÊ≥®ÊÑèÔºåËôΩÁÑ∂MoEÁöÑÂÖ¨ÂºèÁªô‰∫∫ÁöÑÊÑüËßâÊòØ"ÊØèÈÅáÂà∞‰∏Ä‰∏™TokenÔºåÂ∞±ÂéªÊâæÁõ∏Â∫îÁöÑExpertÊù•ËÆ°ÁÆó"Ôºå‰ΩÜÂÆûÈôÖËÆ≠ÁªÉÊó∂ÂÖ∂ÂÆûÊòØÂèçËøáÊù•ÁöÑÔºöÂÖàÁªôÊØè‰∏™ExpertÂàÜÈÖçÂ•ΩÁõ∏Â∫îÁöÑÁÆóÂäõÔºåÁÑ∂ÂêéÂ∞ÜTokenÂàÜÈÖçÔºàRouteÔºâÂà∞ÊâÄÂ±ûÁöÑExpert‰∏≠Âπ∂Ë°åËÆ°ÁÆóÔºåËøô‰πüÂ∞±‰∏∫‰ªÄ‰πàË¥üË¥£ÊâìÂàÜÁöÑ$\boldsymbol{\rho}$Ë¢´Áß∞‰∏∫Router„ÄÇ
ËøôÊ†∑‰∏ÄÊù•ÔºåÂ¶ÇÊûúExpertÁöÑÂàÜÈÖç‰∏çÂùáË°°ÔºåÂ∞±ÂèØËÉΩÂá∫Áé∞Â¶Ç‰∏ãÂ±ÄÈù¢ÔºöÊüê‰∫õExpertÔºàDead ExpertÔºâÂá†‰πé‰∏ÄÁõ¥Èó≤ÁΩÆÔºåÊµ™Ë¥πÁÆóÂäõÔºõÊüê‰∫õExpertË¶ÅÂ§ÑÁêÜÁöÑTokenÂ§™Â§öÔºåÊ†πÊú¨Âøô‰∏çËøáÊù•ÔºåÂè™ËÉΩToken DropÔºàÂç≥ÊîæÂºÉÂ§ÑÁêÜÈÉ®ÂàÜTokenÔºâ„ÄÇ‰ªéÁêÜËÆ∫‰∏äÊù•ËØ¥ÔºåÂá∫Áé∞Dead ExpertÊÑèÂë≥ÁùÄMoEÊ≤°ÊúâËææÂà∞È¢ÑÊúüÁöÑÂèÇÊï∞ÈáèÔºåÂç≥Ëä±‰∫ÜÂ§ßÂèÇÊï∞ÈáèÁöÑÊòæÂ≠òÔºåÁªìÊûúÂè™ËÆ≠Âá∫Êù•Â∞èÂèÇÊï∞ÈáèÁöÑÊïàÊûú„ÄÇ
ÊâÄ‰ª•Ôºå‰∏çÁÆ°ÊòØ‰ªéËÆ≠ÁªÉËøòÊòØÊÄßËÉΩËßíÂ∫¶ÁúãÔºåÊàë‰ª¨ÈÉΩÂ∏åÊúõ‰øùËØÅExpertÁöÑË¥üËΩΩÂùáË°°„ÄÇ
ËæÖÂä©ÊçüÂ§±ÔºàAuxiliary LossÔºâ ‰øÉËøõË¥üËΩΩÂùáË°°ÁöÑÂ∏∏ËßÑÊÄùË∑ØÊòØÊ∑ªÂä†‰∏é‰πãÁõ∏ÂÖ≥ÁöÑÊçüÂ§±ÂáΩÊï∞ÔºåÊàë‰ª¨ÈÄöÂ∏∏Áß∞‰πã‰∏∫"Aux LossÔºàAuxiliary LossÔºâ"ÔºåÁõÆÂâç‰∏ªÊµÅÁî®ÁöÑAux LossÊúÄÊó©ÂèØ‰ª•ËøΩÊ∫ØÂà∞2020Âπ¥ÁöÑ„ÄäGShard: Scaling Giant Models with Conditional Computation and Automatic Sharding„Äã„ÄÇ
‰ªãÁªçAux Loss‰πãÂâçÔºåÊàë‰ª¨ÈúÄË¶ÅÂÖàÂºïÂÖ•‰∏Ä‰∫õÊñ∞Ê¶ÇÂøµ„ÄÇÈ¶ñÂÖàÔºåÊàë‰ª¨Â∑≤ÁªèÊèêÂà∞ÂØπ‰∫é‰∏ÄËà¨ÁöÑMoEÊù•ËØ¥Ôºå$\boldsymbol{\rho}$Êú™ÂøÖÊòØÊ¶ÇÁéáÂàÜÂ∏ÉÔºåÊàë‰ª¨Â∞ÜÂΩí‰∏ÄÂåñÁöÑ$\boldsymbol{\rho}$ËÆ∞‰∏∫$\boldsymbol{p}=[p_1,p_2,\cdots,p_n]$Ôºå‰ª•ÂèäÂÆÉTop-$k$Áâà‰∏∫$\boldsymbol{f}=[f_1,f_2,\cdots,f_n]$ÔºåÂÖ∂‰∏≠ $$ p_i = \frac{\rho_i}{\sum_{i=1}^n \rho_i},\qquad f_i = \begin{cases}1/k, & i\in \mathop{\text{argtop}}_k \boldsymbol{\rho} \ 0, & i\not\in \mathop{\text{argtop}}_k \boldsymbol{\rho}\end{cases} $$ Êé•ÁùÄÊàë‰ª¨ÂÆö‰πâ$\boldsymbol{P}=\mathbb{E}[\boldsymbol{p}],\boldsymbol{F}=\mathbb{E}[\boldsymbol{f}]$ÔºåËøôÈáåÁöÑ$\mathbb{E}$ÊòØÊåáÂØπÊâÄÊúâÊ†∑Êú¨ÁöÑÊâÄÊúâTokenÂÅöÂπ≥Âùá„ÄÇ‰∏çÈöæÁúãÂá∫Ôºå$\boldsymbol{F}$Â∞±ÊòØExpertÂΩìÂâçÁöÑË¥üËΩΩÂàÜÂ∏ÉÔºåËÄå$\boldsymbol{P}$ÂàôÁõ∏ÂΩì‰∫é$\boldsymbol{F}$ÁöÑ‰∏Ä‰∏™ÂÖâÊªëËøë‰ºº„ÄÇ
Êúâ‰∫ÜËøô‰∫õËÆ∞Âè∑ÔºåÊàë‰ª¨Â∞±ÂèØ‰ª•ÂÜôÂá∫Aux Loss‰∏∫Ôºö
$$ \mathcal{L}_{\text{aux}} = \boldsymbol{F}\cdot \boldsymbol{P} = \sum_{i=1}^n F_i P_i \tag{1} $$ ...</p></div><footer class=entry-footer><span title='2025-08-10 15:05:12 +0800 CST'>August 10, 2025</span>&nbsp;¬∑&nbsp;5 min&nbsp;¬∑&nbsp;1055 words&nbsp;¬∑&nbsp;Me</footer><a class=entry-link aria-label="post link to MoEÁéØÊ∏∏ËÆ∞Ôºö2„ÄÅÊ∑±ÂÖ•Ë¥üËΩΩÂùáË°°" href=https://pillumina.github.io/posts/llmtheory/2-moe/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>MoEÁéØÊ∏∏ËÆ∞Ôºö1„ÄÅ‰ªéÂá†‰ΩïÊÑè‰πâÂá∫Âèë</h2></header><div class=entry-content><p>MoEÔºàMixture of ExpertsÔºâÊû∂ÊûÑÁöÑÊµÅË°åËá™‰∏çÂøÖÂ§öËØ¥ÔºåËøëÊù•ÁÅ´Âá∫ÂúàÁöÑDeepSeek-V3‰æøÊòØMoEÊû∂ÊûÑÔºå‰º†Ë®ÄGPT-5‰πüÊòØMoEÊû∂ÊûÑÔºåÂõΩÂÜÖÊúÄËøëÂá∫ÁöÑ‰∏Ä‰∫õÊ®°ÂûãÔºàQwen3Á≥ªÂàóÁõ∏ÂÖ≥Ôºâ‰πüÊúâ‰∏çÂ∞ëÁî®‰∏ä‰∫ÜMoE„ÄÇÁÑ∂ËÄåÔºåËôΩÁÑ∂MoEÁöÑÁ†îÁ©∂Áî±Êù•Â∑≤‰πÖÔºå‰ΩÜÂÖ∂Â∫îÁî®ÈïøÊó∂Èó¥ÂÜÖÈÉΩ‰∏çÊÑ†‰∏çÁÅ´ÔºåÂ§ßËá¥‰∏äÊòØ‰ªéÂéªÂπ¥ÂàùÁöÑ„ÄäMixtral of Experts„ÄãÂºÄÂßãÔºåMoEÊâçÈÄêÊ∏êÂê∏ÂºïÂ§ßÂÆ∂ÁöÑÊ≥®ÊÑèÂäõÔºåÂÖ∂ÊòæËëó‰ºòÁÇπÊòØÂèÇÊï∞ÈáèÂ§ßÔºå‰ΩÜËÆ≠ÁªÉÂíåÊé®ÁêÜÊàêÊú¨ÈÉΩÊòæËëó‰Ωé„ÄÇ
‰ΩÜÂêåÊó∂MoE‰πüÊúâ‰∏Ä‰∫õÈöæÈ¢òÔºåÂ¶ÇËÆ≠ÁªÉ‰∏çÁ®≥ÂÆö„ÄÅË¥üËΩΩ‰∏çÂùáË°°„ÄÅÊïàÊûú‰∏çÂ§üÂ•ΩÁ≠âÔºåËøô‰πüÊòØÂÆÉÊó©Âπ¥Ê≤°ÊúâÊµÅË°åËµ∑Êù•ÁöÑ‰∏ªË¶ÅÂéüÂõ†„ÄÇ‰∏çËøáÈöèÁùÄËøô‰∏§Âπ¥ÂÖ≥Ê≥®Â∫¶ÁöÑÊèêÂçáÔºåËøô‰∫õÈóÆÈ¢òÂú®ÂæàÂ§ßÁ®ãÂ∫¶‰∏äÂ∑≤ÁªèÂæóÂà∞Ëß£ÂÜ≥ÔºåÊàë‰ª¨Âú®Êé•‰∏ãÊù•ÁöÑ‰ªãÁªç‰∏≠‰ºöÈÄê‰∏ÄË∞àÂà∞Ëøô‰∫õÂÜÖÂÆπ„ÄÇ
ÈóÆÈ¢òÂÆö‰πâ Êàë‰ª¨Áü•ÈÅìÔºåTransformerÊ®°ÂûãÁî±AttentionÂ±ÇÂíåMLPÂ±ÇÁªÑÊàêÔºåMoEÊõøÊç¢ÁöÑÊòØÊ®°Âûã‰∏≠MLPÂ±Ç„ÄÇMLPÂ±ÇÂèàÂàÜFFNÔºàFeedForward NetworkÔºâÂíåGLUÔºàGated Linear UnitÔºâ‰∏§ÁßçÔºå‰∏ªÊµÅÁöÑÊòØGLUÔºå‰ΩÜÁÆÄÂçïËµ∑ËßÅÊàë‰ª¨ËøòÊòØ‰ª•FFN‰∏∫‰æãÔºö$$y=f(xW^{(A)})W^{(B)}$$ÂÖ∂‰∏≠$x\in\mathbb{R}^d$ ÊòØËæìÂÖ•ÂêëÈáèÔºàË°åÂêëÈáèÔºâÔºå$W^{(A)}\in\mathbb{R}^{d\times{D}}$, $W^{(B)}\in\mathbb{R}^{D\times{d}}$ ÊòØ‰∏§‰∏™ÂèÇÊï∞Áü©ÈòµÔºå$f$ÊòØElement-wiseÁöÑÊøÄÊ¥ªÂáΩÊï∞ÔºåËÆæ$n$ÊòØ‰∏Ä‰∏™ËÉΩÊï¥Èô§$D$ÁöÑÊï¥Êï∞ÔºåÈÇ£‰πà‰∏äÈù¢ÁöÑFFNÂèØ‰ª•Áî®ÂàÜÂùóÁü©ÈòµÁ≠â‰ª∑Ôºö
$$ \begin{equation}\boldsymbol{y} = f\big(\boldsymbol{x}\begin{bmatrix}\boldsymbol{W}^{(A)}_1 & \boldsymbol{W}^{(A)}_2 & \cdots & \boldsymbol{W}^{(A)}_n\end{bmatrix}\big)\begin{bmatrix}\boldsymbol{W}^{(B)}_1 \\ \boldsymbol{W}^{(B)}_2 \\ \vdots \\ \boldsymbol{W}^{(B)}_n\end{bmatrix} = \sum_{i=1}^n \underbrace{f(\boldsymbol{x}\boldsymbol{W}^{(A)}_i)\boldsymbol{W}^{(B)}_i}_{\boldsymbol{v}_i}\end{equation} $$ ÂÖ∂‰∏≠
$W^{(A)}_i = W^{(A)}_{[:,(i-1)c:ic]}$, $W^{(B)}_i = W^{(B)}_{[(i-1)c:ic,:]}$, $c= D/n$ÔºåËøôÈáåÁöÑÂàáÁâáÊåâÁÖßPythonËßÑÂàôÊù•„ÄÇÁî±Ê≠§ÂèØËßÅÔºåFFNÂèØ‰ª•Á≠â‰ª∑Ë°®Á§∫Êàên‰∏™ÂêëÈáè
$\boldsymbol{v}_1,\boldsymbol{v}_2,\cdots,\boldsymbol{v}_n$
‰πãÂíåÔºåÊØè‰∏™ÂêëÈáè‰ª£Ë°®‰∫Ü‰∏Ä‰∏™Â∞èÊ®°Âûã$f(\boldsymbol{x}\boldsymbol{W}^{(A)}_i)\boldsymbol{W}^{(B)}_i$ÁöÑËæìÂá∫ÔºåÊØè‰∏™Â∞èÊ®°ÂûãËÆ°ÁÆóÈáèÁõ∏ÂêåÔºåËøô‰∫õÂ∞èÊ®°ÂûãÂ∞±ÊòØMoE‰∏≠ÁöÑ‚ÄúExpert‚Äù„ÄÇ
MoEÊèêÂá∫ÁöÑÈóÆÈ¢òÊòØÔºö
ËÉΩÂê¶Âè™Êåëk‰∏™ÂêëÈáèÁöÑÂíåÊù•ÈÄºËøën‰∏™ÂêëÈáèÁöÑÂíåÂë¢ÔºüËøôÊ†∑Â∞±ÂèØ‰ª•Â∞ÜËÆ°ÁÆóÈáèÈôç‰ΩéÂà∞k/n‰∫Ü„ÄÇ
Ê®°ÈïøÊéíÂ∫è Ë¶ÅËß£ÂÜ≥‰∏äËø∞ÁöÑÈóÆÈ¢òÔºåÂÆûË¥®‰∏äÊòØË¶ÅËß£ÂÜ≥‰ΩéÁß©Ëøë‰ººÁöÑÈóÆÈ¢òÔºåÊï∞Â≠¶ÂÖ¨ÂºèÂ∞±ÊòØ:
$$\begin{equation}\mathop{\text{argmin}}_{\lambda_1,\lambda_2,\cdots,\lambda_n\in\{0,1\}}\left\Vert\sum_{i=1}^n \lambda_i \boldsymbol{v}_i - \sum_{i=1}^n\boldsymbol{v}_i\right\Vert^2\quad\text{s.t.}\quad \sum_{i=1}^n \lambda_i = k\end{equation}$$ ËÆ∞$\gamma_i = 1 - \lambda_i$ÔºåÈÇ£‰πàÂÆÉÂèàÂèØ‰ª•ÂÜôÊàêÔºö
$$\begin{equation}\mathop{\text{argmin}}_{\gamma_1,\gamma_2,\cdots,\gamma_n\in\{0,1\}}\left\Vert\sum_{i=1}^n \gamma_i \boldsymbol{v}_i\right\Vert^2\quad\text{s.t.}\quad \sum_{i=1}^n \gamma_i = n - k\end{equation}$$ Ëøô‰∏™ÈóÆÈ¢òÁöÑÁ≤æÁ°ÆÊ±ÇËß£ÊòØÊØîËæÉÂõ∞ÈöæÁöÑÔºàNP HardÔºâÔºå‰ΩÜÊúâ‰∏Ä‰∏™ÁÆÄÂçïÁöÑËøë‰ººËß£ÔºöÂΩì$v_i$‰∏§‰∏§Ê≠£‰∫§Êó∂ÔºåÊàë‰ª¨Êúâ
$$\begin{equation}\left\Vert\sum_{i=1}^n \gamma_i \boldsymbol{v}_i\right\Vert^2 = \sum_{i=1}^n \gamma_i^2 \Vert\boldsymbol{v}_i\Vert^2 = \sum_{i=1}^n \gamma_i \Vert\boldsymbol{v}_i\Vert^2\end{equation}$$ ‰∏äÂºèÊúÄ‰ºòËß£ÊòæÁÑ∂Â∞±ÊòØËÆ©Ê®°Èïø$\Vert\boldsymbol{v}_i\Vert$ÊúÄÂ∞èÁöÑ$n-k$‰∏™$\gamma_i$Á≠â‰∫é1ÔºåËøôÂèàÁ≠â‰ª∑‰∫éËØ¥ÊåëÂá∫Ê®°ÈïøÊúÄÂ§ßÁöÑ$k$‰∏™ÂêëÈáèÊù•ÈÄºËøë$n$‰∏™ÂêëÈáè‰πãÂíå„ÄÇÂΩì$v_i$‰∏çÊª°Ë∂≥‰∏§‰∏§Ê≠£‰∫§ÁöÑÊù°‰ª∂Êó∂ÔºåÊàë‰ª¨‰æùÁÑ∂Áî®ÂÆÉÊù•‰Ωú‰∏∫‰∏Ä‰∏™Ëøë‰ººËß£„ÄÇÂÆÉÁöÑÂá†‰ΩïÊÑè‰πâ‰πüÂæàÁõ¥ËßÇÔºåÊ®°ÈïøË∂äÂ§ßÁöÑÂêëÈáèÔºåÂú®Ê±ÇÂíåËøáÁ®ã‰∏≠Ë∂ä‰∏çÂÆπÊòìË¢´ÊäµÊ∂àÔºå‰ªéËÄå‰ΩúÁî®Ë∂äÁ™ÅÂá∫„ÄÇ
...</p></div><footer class=entry-footer><span title='2025-08-08 15:05:12 +0800 CST'>August 8, 2025</span>&nbsp;¬∑&nbsp;1 min&nbsp;¬∑&nbsp;146 words&nbsp;¬∑&nbsp;Me</footer><a class=entry-link aria-label="post link to MoEÁéØÊ∏∏ËÆ∞Ôºö1„ÄÅ‰ªéÂá†‰ΩïÊÑè‰πâÂá∫Âèë" href=https://pillumina.github.io/posts/llmtheory/1-moe/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>[RL4LLM] ÂºÇÊ≠•RLÊ°ÜÊû∂: Slime</h2></header><div class=entry-content><p>https://github.com/THUDM/slime
‰∏Ä‰∏™ÂºÇÊ≠•ÂÆûÁé∞‰ΩÜÊòØÈùûÂÆåÂÖ®ÂºÇÊ≠•ÁöÑRLÊ°ÜÊû∂
ÊÄª‰ΩìÊû∂ÊûÑ ‰ªéÊ∫êÁ†ÅÊ®°ÂùóÂàíÂàÜÔºåÊúâ‰∏âÂ§ßÊ†∏ÂøÉÊ®°ÂùóÔºö trainingÔºàMegatronÔºâÔºö‰∏ªËÆ≠ÁªÉÊµÅÁ®ãÔºåË¥üË¥£Ê®°ÂûãÂèÇÊï∞Êõ¥Êñ∞„ÄÇ rolloutÔºàSGLang + routerÔºâÔºöË¥üË¥£ÈááÊ†∑„ÄÅÂ•ñÂä±/È™åËØÅÁîüÊàêÔºå‰∫ßÁîüËÆ≠ÁªÉÊï∞ÊçÆ„ÄÇ data bufferÔºöÊ°•Êé•ËÆ≠ÁªÉ‰∏éÈááÊ†∑ÔºåÁÆ°ÁêÜÊï∞ÊçÆÊµÅ„ÄÅÁºìÂ≠ò‰∏éÁîüÊàêÊñπÂºè„ÄÇ ÂàÜÂ∏ÉÂºèË∞ÉÂ∫¶ÔºöÂÖ≥‰∫éËµÑÊ∫êÂàÜÈÖç„ÄÅactorÂêØÂä®„ÄÅ‰ªªÂä°Ë∞ÉÂ∫¶ÈÉΩÁî±‰∫éRayÁÆ°ÁêÜÔºåÊîØÊåÅÂºÇÊ≠•ËÆ≠ÁªÉÂíåÈááÊ†∑ Êèí‰ª∂Êú∫Âà∂ÔºöÊîØÊåÅËá™ÂÆö‰πâbuffer„ÄÅÊ®°Âûã„ÄÅÊ®°ÂûãÊ†ºÂºèËΩ¨Êç¢ÔºàmbridgeÔºâ flowchart LR subgraph Ray[Ray ÂàÜÂ∏ÉÂºèË∞ÉÂ∫¶] A1[Actor Group&lt;br>ËÆ≠ÁªÉ Actor] A2[Rollout Group&lt;br>ÈááÊ†∑/ÁîüÊàê Actor] A3[Placement Group&lt;br>ËµÑÊ∫êÂàÜÈÖç] end subgraph Training[Training &lt;Megatron>] T1[Ê®°ÂûãËÆ≠ÁªÉ] T2[ÊùÉÈáçÂêåÊ≠•] T3[ËØÑ‰º∞/‰øùÂ≠ò] end subgraph Rollout[Rollout &lt;SGLang+Router>] R1[ÈááÊ†∑/ÁîüÊàê] R2[Â•ñÂä±Ê®°Âûã] R3[ËøáÊª§Âô®] end subgraph Buffer[Data Buffer] B1[Êï∞ÊçÆÁºìÂ≠ò] B2[Êï∞ÊçÆÊµÅËΩ¨] B3[Offload/Onload] end subgraph Plugins[Êèí‰ª∂Êú∫Âà∂] P1[Buffer Êèí‰ª∂] P2[Model Êèí‰ª∂] P3[mbridge Ê†ºÂºèËΩ¨Êç¢] end A1-->|ËÆ≠ÁªÉÊï∞ÊçÆ|B1 A2-->|ÁîüÊàêÊï∞ÊçÆ|B1 B1-->|Êï∞ÊçÆÊµÅ|A1 B1-->|Êï∞ÊçÆÊµÅ|A2 A1-->|ÊùÉÈáçÂêåÊ≠•|A2 A1-->|ËØÑ‰º∞/‰øùÂ≠ò|T3 A2-->|ÈááÊ†∑/Â•ñÂä±/ËøáÊª§|R1 R1-->|Â•ñÂä±|R2 R1-->|ËøáÊª§|R3 B1-->|Êèí‰ª∂Êâ©Â±ï|P1 A1-->|Ê®°ÂûãÊâ©Â±ï|P2 A1-->|Ê†ºÂºèËΩ¨Êç¢|P3 A3-->|ËµÑÊ∫êÂàÜÈÖç|A1 A3-->|ËµÑÊ∫êÂàÜÈÖç|A2 ÂêÑÊ®°ÂùóËßÜËßíÁöÑÂÖ≥Á≥ªÂõæ slime/rollout ÁªÑ‰ª∂Âõæ rollout Ë¥üË¥£ÈááÊ†∑„ÄÅÂ•ñÂä±„ÄÅËøáÊª§ÔºåÊîØÊåÅÂ§öÁßçÈááÊ†∑/Â•ñÂä±/ËøáÊª§Á≠ñÁï•„ÄÇ
...</p></div><footer class=entry-footer><span title='2025-08-07 17:10:12 +0800 CST'>August 7, 2025</span>&nbsp;¬∑&nbsp;15 min&nbsp;¬∑&nbsp;3119 words&nbsp;¬∑&nbsp;Me</footer><a class=entry-link aria-label="post link to [RL4LLM] ÂºÇÊ≠•RLÊ°ÜÊû∂: Slime" href=https://pillumina.github.io/posts/aiinfra/02-slime/></a></article><footer class=page-footer><nav class=pagination><a class=next href=https://pillumina.github.io/page/2/>Next&nbsp;2/9&nbsp;¬ª</a></nav></footer></main><footer class=footer><span>&copy; 2025 <a href=https://pillumina.github.io/>CctoctoFX</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg></a><div class=reading-progress-bar></div><script src=https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){const t=document.querySelector(".reading-progress-bar");if(!t)return;const n=document.querySelector(".post-single");if(!n)return;function s(){const e=n.getBoundingClientRect(),s=e.height,o=window.innerHeight,i=window.scrollY||window.pageYOffset,a=i/(s-o)*100;t.style.width=`${Math.min(100,Math.max(0,a))}%`}let e=!1;window.addEventListener("scroll",function(){e||(window.requestAnimationFrame(function(){s(),e=!1}),e=!0)}),s()}),document.addEventListener("DOMContentLoaded",function(){mediumZoom("article img:not(.nozoom)",{margin:24,background:"var(--theme)",scrollOffset:0})})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>